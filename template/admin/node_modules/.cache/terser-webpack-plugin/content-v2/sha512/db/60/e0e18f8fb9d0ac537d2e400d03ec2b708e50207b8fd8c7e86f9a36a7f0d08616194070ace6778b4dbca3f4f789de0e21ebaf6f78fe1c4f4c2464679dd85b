{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[\"chunk-a7c34c58\"],{\"42b4\":function(t,e,i){i(\"443f\")},\"443f\":function(t,e,i){},\"4f7b\":function(t,e,i){i(\"b3bf\")},7624:function(t,e,i){e.a=[\"em-tlj-1\",\"em-tlj-2\",\"em-tlj-3\",\"em-tlj-4\",\"em-tlj-5\",\"em-tlj-6\",\"em-tlj-7\",\"em-tlj-8\",\"em-tlj-9\",\"em-tlj-10\",\"em-tlj-11\",\"em-tlj-12\",\"em-tlj-13\",\"em-tlj-14\",\"em-tlj-15\",\"em-tlj-16\",\"em-tlj-17\",\"em-tlj-18\",\"em-tlj-19\",\"em-tlj-20\",\"em-tlj-21\",\"em-tlj-22\",\"em-tlj-23\",\"em-tlj-24\",\"em-tlj-25\",\"em-tlj-26\",\"em-tlj-27\",\"em-tlj-28\",\"em-tlj-29\",\"em-tlj-30\",\"em-tlj-31\",\"em-tlj-32\",\"em-tlj-33\",\"em-tlj-34\",\"em-tlj-35\",\"em-tlj-36\",\"em-tlj-37\",\"em-tlj-38\",\"em-tlj-39\",\"em-tlj-40\",\"em-tlj-41\",\"em-tlj-42\",\"em-tlj-43\",\"em-tlj-44\",\"em-tlj-45\",\"em-tlj-46\",\"em-tlj-47\",\"em-tlj-48\",\"em-tlj-49\",\"em-tlj-50\",\"em-tlj-51\",\"em-tlj-52\",\"em-tlj-53\",\"em-tlj-54\",\"em-tlj-55\",\"em-tlj-56\",\"em-tlj-57\",\"em-tlj-58\",\"em-tlj-59\",\"em-tlj-60\",\"em-tlj-61\",\"em-tlj-62\",\"em-tlj-63\",\"em-tlj-64\",\"em-tlj-65\",\"em-tlj-66\",\"em-tlj-67\",\"em-tlj-68\",\"em-tlj-69\",\"em-tlj-70\",\"em-tlj-71\",\"em-tlj-72\",\"em-tlj-73\",\"em-tlj-74\",\"em-tlj-75\",\"em-tlj-76\",\"em-tlj-77\",\"em-tlj-78\",\"em-tlj-79\",\"em-tlj-80\",\"em-tlj-81\",\"em-tlj-82\",\"em-tlj-83\",\"em-tlj-84\",\"em-tlj-85\",\"em-tlj-86\",\"em-tlj-87\",\"em-tlj-88\",\"em-tlj-89\",\"em-tlj-90\",\"em-tlj-91\",\"em-tlj-92\",\"em-tlj-93\",\"em-tlj-94\",\"em-tlj-95\",\"em-tlj-96\"]},b3bf:function(t,e){throw new Error(\"Module build failed (from ./node_modules/mini-css-extract-plugin/dist/loader.js):\\nModuleBuildError: Module build failed (from ./node_modules/stylus-loader/index.js):\\nTypeError: Class constructor Visitor cannot be invoked without 'new'\\n    at new ImportVisitor (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/stylus-loader/lib/listimports.js:10:11)\\n    at listImports (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/stylus-loader/lib/listimports.js:72:23)\\n    at /Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/stylus-loader/lib/pathcache.js:295:15\\n    at tryCatchReject (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/when/lib/makePromise.js:840:30)\\n    at runContinuation1 (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/when/lib/makePromise.js:799:4)\\n    at Fulfilled.when (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/when/lib/makePromise.js:590:4)\\n    at Pending.run (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/when/lib/makePromise.js:481:13)\\n    at Scheduler._drain (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/when/lib/Scheduler.js:62:19)\\n    at Scheduler.drain (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/when/lib/Scheduler.js:27:9)\\n    at processTicksAndRejections (node:internal/process/task_queues:78:11)\\n    at /Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/webpack/lib/NormalModule.js:316:20\\n    at /Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/loader-runner/lib/LoaderRunner.js:367:11\\n    at /Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/loader-runner/lib/LoaderRunner.js:233:18\\n    at context.callback (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/loader-runner/lib/LoaderRunner.js:111:13)\\n    at tryCatchReject (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/when/lib/makePromise.js:840:30)\\n    at runContinuation1 (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/when/lib/makePromise.js:799:4)\\n    at Rejected.when (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/when/lib/makePromise.js:623:4)\\n    at Pending.run (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/when/lib/makePromise.js:481:13)\\n    at Scheduler._drain (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/when/lib/Scheduler.js:62:19)\\n    at Scheduler.drain (/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/when/lib/Scheduler.js:27:9)\\n    at processTicksAndRejections (node:internal/process/task_queues:78:11)\")},c168:function(t,e,i){i.r(e);var s=i(\"2909\"),n=(i(\"99af\"),i(\"d81d\"),i(\"14d9\"),i(\"d3b7\"),i(\"ac1f\"),i(\"5319\"),i(\"159b\"),i(\"d708\")),o=i(\"49ea\"),a=i(\"c276\"),r=i(\"7624\"),d=i(\"42e3\"),l=(i(\"ed08\"),{name:\"chat_mobile\",data:function(){return{ops:{vuescroll:{mode:\"slide\",enable:!1,auto:!1,autoLoadDistance:0,pullRefresh:{enable:!0,auto:!1,autoLoadDistance:0,tips:{deactive:\"\",active:\"上拉加载更多\",start:\"Loading...\",beforeDeactive:\" \"}},pushLoad:{enable:!1}},bar:{background:\"#393232\",opacity:\".5\",size:\"2px\"}},swiperOptions:{},status:!1,loading:!1,isTool:!1,isSwiper:!1,isWords:!1,autoplay:!1,circular:!0,interval:3e3,duration:500,emojiGroup:(t=r.a,e=+(e=21)||1,i=[],t.forEach((function(t,s){s%e==0&&i.push([]),i[i.length-1].push(t)})),i),con:\"\",toUid:\"\",limit:15,upperId:0,chatList:[],kefuInfo:{},scrollTop:0,active:!0,isScroll:!0,oldHeight:0,selector:\"\",transferList:[],isTransfer:!1,uploadData:{},header:{},fileUrl:\"\",userToken:\"\",tourist_uid:\"\",orderId:\"\",orderInfo:\"\",cartInfo:\"\",productId:\"\",productInfo:\"\",tourist_avatar:\"\"};var t,e,i},computed:{isSend:function(){return 0!=this.con.length},records:function(){var t=this;return this.chatList.map((function(e,i){return e.time=t.$moment(1e3*e.add_time).format(\"MMMDo h:mm\"),!i||300<=e.add_time-t.chatList[i-1].add_time?e.show=!0:e.show=!1,e}))}},created:function(){var t=localStorage.getItem(\"LOGIN_STATUS_TOKEN\")||\"\";this.fileUrl=n.a.apiBaseURL.replace(\"adminapi\",\"kefuapi\")+\"/tourist/upload\",this.userToken=t,this.toUid=this.$route.query.toUid||\"\",this.nickname=this.$route.query.nickname||\"\",this.orderId=this.$route.query.orderId||\"\",this.productId=this.$route.query.product_id||\"\"},mounted:function(){var t=this,e=(this.$wechat._isMobile()||this.$router.replace(\"/kefu/appChat\"),this);this.getServiceList(),this.userToken&&(this.getOrderInfo(),this.getGoodsInfo()),this.header[\"Authori-zation\"]=\"Bearer \"+Object(a.c)(\"kefu_token\"),o.a.then((function(i){t.userToken&&i.send({type:\"login\",data:t.userToken}),i.$on([\"reply\",\"chat\"],(function(e){1!=e.msn_type&&2!=e.msn_type||(e.msn=t.replace_em(e.msn)),t.chatList.push(e),t.$nextTick((function(){t.$refs.scrollBox.refresh(),t.scrollBom()})),setTimeout((function(e){t.$refs.scrollBox.refresh()}),300)})),i.$on(\"socket_error\",(function(){t.$message.error(\"连接失败\")})),i.$on(\"error\",(function(){t.$message.error(\"连接失败\")})),i.$on(\"to_transfer\",(function(t){i.send({data:{id:t.toUid},type:\"to_chat\"})})),i.$on(\"online\",(function(t){0==t.online&&t.uid==e.toUid&&e.$Modal.confirm({title:\"提示\",content:\"客服已离线，是否需要反馈？\",okText:\"确定\",cancelText:\"取消\",onOk:function(){e.$router.replace({path:\"/kefu/mobile_feedback\"})}})}))})),this.$nextTick((function(){}))},methods:{goBack:function(){this.$router.go(-1)},handleFormatError:function(t){this.$message.error(\"上传图片只能是 jpg、jpg、jpeg、gif 格式!\")},getGoodsInfo:function(){var t=this;this.productId&&Object(d.A)(this.productId).then((function(e){t.productInfo=e.data})).catch((function(e){t.$message.error(e.msg)}))},getOrderInfo:function(){var t=this;this.orderId&&Object(d.k)(this.orderId,{token:this.userToken}).then((function(e){t.orderInfo=e.data,t.orderInfo.add_time_h&&(t.orderInfo.add_time_h=t.orderInfo.add_time_h.substring(0,t.orderInfo.add_time_h.lastIndexOf(\":\"))),t.orderInfo.cartInfo.length&&(t.cartInfo=t.orderInfo.cartInfo[0])}))},getServiceList:function(){var t=this;Object(d.L)({token:this.userToken}).then((function(e){t.toUid=e.data.uid,t.tourist_uid=e.data.tourist_uid,document.title=e.data.nickname,t.tourist_avatar=e.data.tourist_avatar,t.userToken&&t.getChatList();var i={data:{id:e.data.uid,tourist_uid:t.tourist_uid},type:\"to_chat\"};o.a.then((function(t){t.send(i)}))})).catch((function(e){t.$message.error(e.msg),setTimeout((function(e){t.$router.replace({path:\"/kefu/mobile_feedback\"})}),2e3)}))},beforeUpload:function(t){var e=this;return\"image/jpeg\"===t.type||\"image/png\"===t.type||this.$message.error(\"上传图片只能是 JPG、PNG 格式!\"),this.uploadData={filename:t,token:this.userToken},new Promise((function(t){e.$nextTick((function(){t(!0)}))}))},handleSuccess:function(t,e,i){200===t.status?(this.$message.success(t.msg),this.sendMsg(t.data.url,3)):this.$message.error(t.msg)},scrollBom:function(){var t=this;setTimeout((function(e){var i=parseFloat(document.getElementById(\"chatBox\").offsetHeight);t.$refs.scrollBox&&t.$refs.scrollBox.scrollTo({y:i},300)}),300)},goOrderDetail:function(t){this.$router.push({path:\"/kefu/orderDetail/\".concat(t.orderInfo.id)})},openBox:function(t){var e=this;1==t?(this.isTool=!1,this.isSwiper=!this.isSwiper):(this.isSwiper=!1,this.isTool=!this.isTool),this.$refs.scrollBox.refresh(),this.$nextTick((function(){e.scrollBom()}))},showWords:function(){this.isWords=!0},goTransfer:function(){this.isTransfer=!0},closeTransfer:function(){this.transferList.forEach((function(t,e){t.isCheck=!1})),this.isTransfer=!1},goodsInfo:function(){this.$router.push({path:\"/kefu/goods/list?toUid=\"+this.toUid})},addEmoji:function(t){t=\"[\".concat(t,\"]\"),this.con+=t},replace_em:function(t){return t.replace(/\\[em-([\\s\\S]*)\\]/g,\"<span class='em em-$1'/></span>\")},getChatList:function(){var t=this;Object(d.e)({limit:this.limit,uid:this.toUid,upperId:this.upperId,token:this.userToken}).then((function(e){e.data.forEach((function(e){1!=e.msn_type&&2!=e.msn_type||(e.msn=t.replace_em(e.msn))}));var i=\"\";i=0==t.upperId?\"chat_\".concat(e.data[e.data.length-1].id):\"chat_\".concat(t.chatList[0].id);t.selector=i,t.chatList=[].concat(Object(s.a)(e.data),Object(s.a)(t.chatList)),t.loading=!1,t.isScroll=e.data.length>=t.limit,t.$refs.scrollBox.refresh(),t.$nextTick((function(){t.$emit(\"change\",!0);var e=parseFloat(document.getElementById(i).offsetTop)-60;t.$refs.scrollBox.scrollTo({y:e},0)}))}))},sendOrder:function(){this.sendMsg(this.orderId,6),this.orderId=0,this.orderInfo={}},sendProduct:function(){this.sendMsg(this.productId,5),this.productId=0,this.productInfo={}},sendText:function(){this.isSend||this.$message.error(\"请输入内容\"),this.sendMsg(this.con,1),this.con=\"\"},sendMsg:function(t,e){var i={type:\"chat\",data:{msn:t,type:e,is_tourist:this.userToken?0:1,to_uid:this.toUid,tourist_uid:this.tourist_uid,form_type:this.$wechat.isWeixin()?1:3,tourist_avatar:this.userToken?\"\":this.tourist_avatar}};o.a.then((function(t){t.send(i)}))},uploadImg:function(){var t=this;t.$util.uploadImageOne(\"upload/image\",(function(e){200==e.code&&t.sendMsg(e.data,3)}))},goProduct:function(t){t=window.location.protocol+\"//\"+window.location.host+\"/pages/goods_details/index?id=\"+t.msn,window.open(t,\"_blank\")},goAdminOrder:function(){var t=window.location.protocol+\"//\"+window.location.host+\"/pages/goods/order_details/index?order_id=\"+item.msn;window.open(t,\"_blank\")},height:function(){var t,e=this,i=uni.createSelectorQuery().select(\".chat\");setTimeout((function(s){i.boundingClientRect((function(i){t=i.height,e.active?e.scrollTop=parseInt(t)+500:e.scrollTop=parseInt(t)+100})).exec()}),1e3)},handleActivate:function(t,e){this.upperId=this.chatList[0].id},handleStart:function(t,e,i){setTimeout((function(){i()}),2e3)},handleBeforeDeactivate:function(t,e,i){this.userToken?(this.getChatList(),this.$on(\"change\",(function(t){t&&i()}))):i()},handleDeactivate:function(t,e){var i=parseFloat(document.getElementById(this.selector).offsetTop)-60;this.$refs.scrollBox.scrollTo({y:i},0)}}});i(\"4f7b\"),i(\"42b4\"),i=i(\"2877\"),i=Object(i.a)(l,(function(){var t=this,e=t._self._c;return e(\"div\",{staticClass:\"chat-box\"},[e(\"div\",{staticClass:\"head-box\"},[e(\"div\",{staticClass:\"back\",on:{click:t.goBack}},[e(\"span\",{staticClass:\"iconfont iconfanhui\"})]),e(\"div\",{staticClass:\"title\"},[t._v(t._s(t.nickname?t.nickname+\"-\":\"\")+\"对话详情\")])]),t.productId&&t.productInfo.id?e(\"div\",{staticClass:\"broadcast-details_box\"},[e(\"div\",{staticClass:\"broadcast_details_img\"},[e(\"img\",{attrs:{src:t.productInfo.image}})]),e(\"div\",{staticClass:\"broadcast_details_picBox\"},[e(\"div\",{staticClass:\"broadcast_details_tit\",domProps:{textContent:t._s(t.productInfo.store_name)}}),e(\"div\",{staticClass:\"acea-row row-between\"},[e(\"div\",{staticClass:\"broadcast_details_pic\"},[t._v(\"\\n          ￥\"+t._s(t.productInfo.price)),e(\"span\",{staticClass:\"broadcast_details_pic_num\"},[t._v(\"￥\"+t._s(t.productInfo.ot_price))])]),e(\"div\",{staticClass:\"broadcast_details_btn\",on:{click:t.sendProduct}},[t._v(\"发送客服\")])])])]):t._e(),t.orderId&&t.orderInfo.id?e(\"div\",{staticClass:\"broadcast_box\"},[e(\"div\",{staticClass:\"broadcast-details_num broadcast_num\"},[e(\"span\",[t._v(\"订单号：\"+t._s(t.orderInfo.order_id))]),e(\"span\",[t._v(t._s(t.orderInfo.add_time_y)+\" \"+t._s(t.orderInfo.add_time_h))])]),e(\"div\",{staticClass:\"broadcast-details_box\"},[e(\"div\",{staticClass:\"broadcast_details_img\"},[e(\"img\",{attrs:{src:t.cartInfo.productInfo.image}}),e(\"div\",{staticClass:\"broadcast_details_model\"},[t._v(t._s(t.orderInfo.cartInfo?t.orderInfo.cartInfo.length:0)+\"件商品\")])]),e(\"div\",{staticClass:\"broadcast_details_picBox\"},[e(\"div\",{staticClass:\"broadcast_details_tit\"},[t._v(\"\\n          \"+t._s(t.cartInfo.productInfo.store_name)+\"\\n        \")]),e(\"div\",{staticClass:\"acea-row row-between\"},[e(\"div\",{staticClass:\"broadcast_details_pic\"},[t._v(\"\\n            ￥\"+t._s(t.cartInfo.productInfo.price)),e(\"text\",{staticClass:\"broadcast_details_pic_num\"},[t._v(\"￥\"+t._s(t.cartInfo.productInfo.ot_price))])]),e(\"div\",{staticClass:\"broadcast_details_btn\",on:{click:t.sendOrder}},[t._v(\"发送客服\")])])])])]):t._e(),e(\"div\",{staticClass:\"chat-scroll-box\"},[e(\"vue-scroll\",{ref:\"scrollBox\",attrs:{ops:t.ops},on:{\"refresh-activate\":t.handleActivate,\"refresh-start\":t.handleStart,\"refresh-before-deactivate\":t.handleBeforeDeactivate,\"refresh-deactivate\":t.handleDeactivate}},[e(\"div\",{staticClass:\"slot-refresh\",attrs:{slot:\"refresh-deactive\"},slot:\"refresh-deactive\"}),e(\"div\",{staticClass:\"slot-refresh\",attrs:{slot:\"refresh-beforeDeactive\"},slot:\"refresh-beforeDeactive\"}),e(\"div\",{ref:\"chat\",staticClass:\"chat\",staticStyle:{padding:\"0.3rem\"},attrs:{id:\"chatBox\"}},t._l(t.records,(function(i,s){return e(\"div\",{key:s,attrs:{id:\"chat_\".concat(i.id)}},[i.show?e(\"div\",{staticClass:\"day-box\"},[t._v(t._s(i.time))]):t._e(),e(\"div\",{staticClass:\"chat-item\",class:{\"right-box\":i.to_uid==t.toUid}},[e(\"img\",{staticClass:\"avatar\",attrs:{src:i.avatar,mode:\"\"}}),1==i.msn_type?e(\"div\",{staticClass:\"msg-box\",domProps:{innerHTML:t._s(i.msn)}}):t._e(),3==i.msn_type?e(\"div\",{directives:[{name:\"viewer\",rawName:\"v-viewer\"}],staticClass:\"img-box\"},[e(\"img\",{directives:[{name:\"lazy\",rawName:\"v-lazy\",value:i.msn,expression:\"item.msn\"}],attrs:{mode:\"widthFix\"}})]):t._e(),5==i.msn_type?e(\"div\",{staticClass:\"product-box\",on:{click:function(e){return t.goProduct(i)}}},[e(\"img\",{attrs:{src:i.productInfo.image}}),e(\"div\",{staticClass:\"info\"},[e(\"div\",{staticClass:\"price\"},[e(\"span\",[t._v(\"￥\")]),t._v(t._s(i.productInfo.price))]),e(\"div\",{staticClass:\"name line2\"},[t._v(t._s(i.productInfo.store_name))])])]):t._e(),6==i.msn_type?e(\"div\",{staticClass:\"order-box\",on:{click:function(e){return t.goOrderDetail(i)}}},[e(\"div\",{staticClass:\"title\"},[t._v(\"订单ID: \"+t._s(i.orderInfo.order_id))]),e(\"div\",{staticClass:\"info\"},[e(\"img\",{attrs:{src:i.orderInfo.cartInfo[0].productInfo.image}}),e(\"div\",{staticClass:\"product-info\"},[e(\"div\",{staticClass:\"name line2\"},[t._v(t._s(i.orderInfo.cartInfo[0].productInfo.store_name))]),e(\"div\",{staticClass:\"price\"},[t._v(\"¥\"+t._s(i.orderInfo.cartInfo[0].productInfo.price))])])])]):t._e()])])})),0)])],1),e(\"div\",{staticClass:\"footer-box\"},[t.userToken?e(\"div\",{staticClass:\"words\",on:{click:t.showWords}},[e(\"el-upload\",{staticStyle:{\"margin-top\":\"1px\",display:\"inline-block\"},attrs:{\"show-file-list\":!1,action:t.fileUrl,\"before-upload\":t.beforeUpload,data:t.uploadData,headers:t.header,multiple:!0,\"on-success\":t.handleSuccess,accept:\"image/*\",\"on-format-error\":t.handleFormatError}},[e(\"span\",{staticClass:\"iconfont icontupian3\"})])],1):t._e(),e(\"div\",{staticClass:\"input-box\"},[e(\"el-input\",{attrs:{placeholder:\"请输入内容\"},model:{value:t.con,callback:function(e){t.con=e},expression:\"con\"}}),e(\"span\",{staticClass:\"iconfont iconfasong\",class:{isSend:t.isSend},on:{click:t.sendText}})],1),e(\"div\",{staticClass:\"emoji\",on:{click:function(e){return t.openBox(1)}}},[e(\"span\",{staticClass:\"iconfont iconbiaoqing2\"})])]),e(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.isSwiper,expression:\"isSwiper\"}],staticClass:\"banner slider-banner\"},[e(\"swiper\",{ref:\"mySwiper\",staticClass:\"swiper-wrapper\",attrs:{options:t.swiperOptions}},t._l(t.emojiGroup,(function(i,s){return e(\"swiper-slide\",{key:s},t._l(i,(function(i){return e(\"i\",{key:i,staticClass:\"em\",class:i,on:{click:function(e){return t.addEmoji(i)}}})})),0)})),1)],1)])}),[],!1,null,\"4de64448\",null);e.default=i.exports}}]);","extractedComments":[]}