{"remainingRequest":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/pages/app/upload/index.vue?vue&type=style&index=0&id=3ffc8814&lang=scss&scoped=true","dependencies":[{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/pages/app/upload/index.vue","mtime":1719467759000},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/css-loader/index.js","mtime":1746465018503},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1746465020031},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/postcss-loader/src/index.js","mtime":1746465019371},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/sass-loader/dist/cjs.js","mtime":1746465018452},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":1746465018509},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js","mtime":1746465019530}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci51cGxvYWQtYnRuIHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KLmltZy1saXN0IHsKICBwYWRkaW5nOiAxMHB4OwogIG92ZXJmbG93OiBzY3JvbGw7CiAgaGVpZ2h0OiBjYWxjKDEwMHZoIC0gNTBweCk7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKfQoKOjp2LWRlZXAgLmVsLXVwbG9hZC1saXN0LS1waWN0dXJlLWNhcmQgLmVsLXVwbG9hZC1saXN0X19pdGVtIHsKICAvLyB3aWR0aDogMTEzcHg7CiAgLy8gaGVpZ2h0OiAxMTNweDsKICAvLyBsaW5lLWhlaWdodDogMTEzcHg7CiAgLy8gb3ZlcmZsb3c6IGluaGVyaXQ7CiAgbWFyZ2luOiAxJSAxJSAwcHggMSU7CiAgd2lkdGg6IDMxLjMlOwogIGhlaWdodDogMzEuMyU7CiAgcGFkZGluZy10b3A6IDMxLjMlOwogIGFzcGVjdC1yYXRpbzogMSAvIDE7Cn0KOjp2LWRlZXAgLmVsLXVwbG9hZC1saXN0LS1waWN0dXJlLWNhcmQgLmVsLXVwbG9hZC1saXN0X19pdGVtID4gZGl2IHsKICAvLyBwb3NpdGlvbjogcmVsYXRpdmU7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAxMDAlOwp9Cjo6di1kZWVwIC5lbC11cGxvYWQtLXBpY3R1cmUtY2FyZCB7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAxMDAlOwogIGRpc3BsYXk6IGZsZXg7CiAgaGVpZ2h0OiAxNDZweDsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGJhY2tncm91bmQ6ICNmOWY5Zjk7Cn0KOjp2LWRlZXAgLmVsLXVwbG9hZC1saXN0LS1waWN0dXJlLWNhcmQgLmVsLXVwbG9hZC1saXN0X19pdGVtIGltZyB7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAxMDAlOwogIGJvcmRlci1yYWRpdXM6IDZweDsKICBvYmplY3QtZml0OiBjb3ZlcjsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgbGVmdDogMDsKICB0b3A6IDA7Cn0KLmJ0bmRlbCB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHotaW5kZXg6IDE7CiAgZm9udC1zaXplOiAxOHB4OwogIHJpZ2h0OiAtMXB4OwogIHRvcDogLTFweDsKICBjb2xvcjogIzI4MjgyODsKICBvcGFjaXR5OiAwLjU7Cn0KOjp2LWRlZXAgLmVsLXVwbG9hZC0tcGljdHVyZS1jYXJkOmhvdmVyLAouZWwtdXBsb2FkOmZvY3VzIHsKICBib3JkZXItY29sb3I6ICNjMGNjZGE7Cn0KLmltZy1ib3ggewogIGRpc3BsYXk6IGZsZXg7CiAgcGFkZGluZy1sZWZ0OiAxMDBweDsKICBmbGV4LXdyYXA6IHdyYXA7Cn0KLm5vbmUtY2FyZCA6OnYtZGVlcCAuZWwtdXBsb2FkLS1waWN0dXJlLWNhcmQgewogIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKfQouZm9vdGVyIHsKICBwYWRkaW5nOiAwIDEwcHggMCAxNXB4OwogIHBvc2l0aW9uOiBmaXhlZDsKICBib3R0b206IDA7CiAgd2lkdGg6IDEwMCU7CiAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuODUpOwogIGJhY2tkcm9wLWZpbHRlcjogYmx1cigxMHB4KTsKICB6LWluZGV4OiAyNzc7CiAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNmMGYwZjA7CiAgaGVpZ2h0OiA1MHB4OwogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgLmJ0biB7CiAgICBib3JkZXI6IDFweCBzb2xpZCAjY2NjY2NjOwogICAgd2lkdGg6IDg4cHg7CiAgICBoZWlnaHQ6IDMwcHg7CiAgICBib3JkZXItcmFkaXVzOiAxNXB4OwogICAgY29sb3I6ICMwMDA7CiAgICBmb250LXNpemU6IDE0cHg7CiAgICBmb250LWZhbWlseTogUGluZ0ZhbmcgU0MtUmVndWxhciwgUGluZ0ZhbmcgU0M7CiAgICBmb250LXdlaWdodDogNDAwOwogICAgY29sb3I6ICM2NjY2NjY7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogIH0KICAudXBsb2FkIHsKICAgIGJhY2tncm91bmQtY29sb3I6ICNlOTMzMjM7CiAgICBjb2xvcjogI2ZmZjsKICAgIG1hcmdpbi1sZWZ0OiAxMHB4OwogIH0KICAudXBsb2FkLm5vLXBpYyB7CiAgICBiYWNrZ3JvdW5kOiAjZTkzMzIzOwogICAgb3BhY2l0eTogMC4zOwogIH0KfQoudXBsb2FkLWNhcmQgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBsaW5lLWhlaWdodDogMTZweDsKICAuZWwtaWNvbi1wbHVzIHsKICAgIGZvbnQtc2l6ZTogMjhweDsKICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgY29sb3I6ICNiYmJiYmI7CiAgfQogIC50ZXh0IHsKICAgIGZvbnQtc2l6ZTogMTNweDsKICAgIGZvbnQtd2VpZ2h0OiA0MDA7CiAgICBjb2xvcjogIzk5OTk5OTsKICAgIG1hcmdpbi10b3A6IDE4cHg7CiAgfQp9Ci51cGxvYWQtc3VjY2VzcyB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogY2VudGVyOwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgaGVpZ2h0OiA4MHZoOwogIC5zdWNjZXNzIHsKICAgIHdpZHRoOiA1MHB4OwogICAgaGVpZ2h0OiA1MHB4OwogICAgYmFja2dyb3VuZDogIzRiYmMxMjsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgLmltYWdlIHsKICAgICAgd2lkdGg6IDYwJTsKICAgIH0KICB9CiAgLnRleHQgewogICAgZm9udC1zaXplOiAxNnB4OwogICAgZm9udC1mYW1pbHk6IFBpbmdGYW5nIFNDLU1lZGl1bSwgUGluZ0ZhbmcgU0M7CiAgICBmb250LXdlaWdodDogNTAwOwogICAgY29sb3I6ICMyODI4Mjg7CiAgICBtYXJnaW4tYm90dG9tOiA0MHB4OwogIH0KICAuYWdhaW4gewogICAgd2lkdGg6IDE1MHB4OwogICAgaGVpZ2h0OiA0M3B4OwogICAgYm9yZGVyLXJhZGl1czogMjFweDsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIGxpbmUtaGVpZ2h0OiA0MXB4OwogICAgZm9udC1zaXplOiAxNXB4OwogICAgZm9udC13ZWlnaHQ6IDQwMDsKICAgIGNvbG9yOiAjMzMzMzMzOwogICAgYm9yZGVyOiAxcHggc29saWQgI2NjY2NjYzsKICB9Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAkMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/app/upload","sourcesContent":["<template>\n  <div class=\"main\" v-loading=\"loading\">\n    <div v-if=\"uploading\">\n      <div class=\"img-list\" :class=\"{ 'none-card': imgList.length }\">\n        <el-upload\n          ref=\"upload\"\n          :action=\"fileUrl\"\n          list-type=\"picture-card\"\n          :on-change=\"fileChange\"\n          :on-error=\"fileError\"\n          :before-upload=\"beforeUpload\"\n          :file-list=\"imgList\"\n          :auto-upload=\"false\"\n          :multiple=\"true\"\n          :limit=\"limit\"\n          accept=\"image/*\"\n        >\n          <div slot=\"default\" class=\"upload-card\" v-if=\"!imgList.length\">\n            <i class=\"el-icon-plus\"></i>\n            <p class=\"text\">点击选择图片</p>\n          </div>\n          <div slot=\"file\" slot-scope=\"{ file }\">\n            <img class=\"el-upload-list__item-thumbnail\" :src=\"file.url\" alt=\"\" />\n            <i class=\"el-icon-error btndel\" @click=\"handleRemove(file)\" />\n          </div>\n        </el-upload>\n      </div>\n\n      <div class=\"footer\">\n        <div v-if=\"imgList.length\">共{{ imgList.length }}/{{ limit }}张，{{ (allSize / 1000000).toFixed(2) }} M</div>\n        <div v-else></div>\n        <div class=\"upload-btn\">\n          <div v-if=\"imgList.length < limit\" class=\"btn\" @click=\"selectImgs\">\n            {{ imgList.length ? '继续选择' : '选择图片' }}\n          </div>\n          <div class=\"btn upload\" :class=\"{ 'no-pic': !imgList.length }\" @click=\"submitUpload\">确认上传</div>\n        </div>\n      </div>\n    </div>\n    <div v-else class=\"upload-success\">\n      <div class=\"success\">\n        <img class=\"image\" src=\"@/assets/images/success.jpg\" alt=\"\" />\n      </div>\n      <div class=\"text\">图片上传成功</div>\n      <div class=\"again\" @click=\"again\">继续上传</div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Setting from '@/setting';\nimport { scanUpload } from '@/api/setting';\nimport compressImg from '@/utils/compressImg.js';\nimport { isPicUpload } from '@/utils';\n\nexport default {\n  name: 'app_upload_file',\n  data() {\n    return {\n      fileUrl: Setting.apiBaseURL + '/image/scan_upload',\n      imgList: [],\n      allSize: 0,\n      token: '',\n      uploading: true,\n      limit: 20,\n      loading: false,\n      pid: 0,\n    };\n  },\n  created() {\n    this.token = this.$route.query.token;\n    this.pid = this.$route.query.pid;\n    document.title = '手机端扫码上传';\n  },\n  methods: {\n    selectImgs() {\n      if (this.loading) return;\n      this.$refs['upload'].$refs['upload-inner'].handleClick();\n    },\n    again() {\n      this.uploading = true;\n      this.imgList = [];\n      this.allSize = 0;\n    },\n    async submitUpload() {\n      if (this.imgList.length) {\n        if (this.loading) return;\n        this.loading = true;\n        for (let i = 0; i < this.imgList.length; i++) {\n          const file = this.imgList[i].raw;\n          await this.uploadItem(file);\n          if (i == this.imgList.length - 1) {\n            this.uploading = false;\n            this.loading = false;\n          }\n        }\n      } else {\n        this.$message.warning('请先选择图片');\n      }\n    },\n    handleRemove(file) {\n      let index = this.imgList.findIndex((e) => {\n        return e.url == file.url;\n      });\n      this.imgList.splice(index, 1);\n      this.$nextTick((e) => {\n        let s = 0;\n        if (this.imgList.length) {\n          this.imgList.map((e) => {\n            s += e.raw.size;\n          });\n          this.allSize = s;\n        } else {\n          this.allSize = 0;\n        }\n      });\n    },\n\n    uploadItem(file) {\n      return new Promise((resolve, reject) => {\n        const formData = new FormData();\n        formData.append('file', file);\n        formData.append('uploadToken', this.token);\n        formData.append('pid', this.pid);\n        scanUpload(formData)\n          .then((res) => {\n            if (res.status == 200) {\n              resolve();\n            } else {\n              this.loading = false;\n              this.$message({\n                message: '上传失败',\n                type: 'error',\n                duration: 1000,\n              });\n            }\n          })\n          .catch((err) => {\n            this.loading = false;\n            this.$message.error(err.msg);\n          });\n      });\n    },\n    fileError(err, file, fileList) {\n      console.log(err, file, fileList);\n    },\n    beforeUpload(file) {\n      return isPicUpload(file);\n    },\n    async fileChange(file, fileList) {\n      if (file.size >= 2097152) {\n        await this.comImg(file.raw).then((res) => {\n          fileList.map((e) => {\n            if (e.uid === file.uid) {\n              this.allSize += res.size;\n              e.raw = res;\n            }\n          });\n          this.imgList = fileList;\n        });\n      } else {\n        this.imgList = fileList;\n        let s = 0;\n        if (this.imgList.length) {\n          this.imgList.map((e) => {\n            s += e.raw.size;\n          });\n          this.allSize = s;\n        } else {\n          this.allSize = 0;\n        }\n      }\n    },\n    comImg(file) {\n      return new Promise((resolve, reject) => {\n        compressImg(file).then((res) => {\n          resolve(res);\n        });\n      });\n    },\n    loadData(item, callback) {\n      getCategoryListApi({\n        pid: item.value,\n      })\n        .then(async (res) => {\n          const data = res.data.list;\n          callback(data);\n        })\n        .catch((res) => {});\n    },\n  },\n};\n</script>\n<style lang=\"scss\" scoped>\n.upload-btn {\n  display: flex;\n  align-items: center;\n}\n.img-list {\n  padding: 10px;\n  overflow: scroll;\n  height: calc(100vh - 50px);\n  background-color: #fff;\n}\n\n::v-deep .el-upload-list--picture-card .el-upload-list__item {\n  // width: 113px;\n  // height: 113px;\n  // line-height: 113px;\n  // overflow: inherit;\n  margin: 1% 1% 0px 1%;\n  width: 31.3%;\n  height: 31.3%;\n  padding-top: 31.3%;\n  aspect-ratio: 1 / 1;\n}\n::v-deep .el-upload-list--picture-card .el-upload-list__item > div {\n  // position: relative;\n  width: 100%;\n  height: 100%;\n}\n::v-deep .el-upload--picture-card {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  height: 146px;\n  justify-content: center;\n  align-items: center;\n  background: #f9f9f9;\n}\n::v-deep .el-upload-list--picture-card .el-upload-list__item img {\n  width: 100%;\n  height: 100%;\n  border-radius: 6px;\n  object-fit: cover;\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n.btndel {\n  position: absolute;\n  z-index: 1;\n  font-size: 18px;\n  right: -1px;\n  top: -1px;\n  color: #282828;\n  opacity: 0.5;\n}\n::v-deep .el-upload--picture-card:hover,\n.el-upload:focus {\n  border-color: #c0ccda;\n}\n.img-box {\n  display: flex;\n  padding-left: 100px;\n  flex-wrap: wrap;\n}\n.none-card ::v-deep .el-upload--picture-card {\n  display: none !important;\n}\n.footer {\n  padding: 0 10px 0 15px;\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  box-sizing: border-box;\n  background-color: rgba(255, 255, 255, 0.85);\n  backdrop-filter: blur(10px);\n  z-index: 277;\n  border-top: 1px solid #f0f0f0;\n  height: 50px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  .btn {\n    border: 1px solid #cccccc;\n    width: 88px;\n    height: 30px;\n    border-radius: 15px;\n    color: #000;\n    font-size: 14px;\n    font-family: PingFang SC-Regular, PingFang SC;\n    font-weight: 400;\n    color: #666666;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  .upload {\n    background-color: #e93323;\n    color: #fff;\n    margin-left: 10px;\n  }\n  .upload.no-pic {\n    background: #e93323;\n    opacity: 0.3;\n  }\n}\n.upload-card {\n  display: flex;\n  flex-direction: column;\n  line-height: 16px;\n  .el-icon-plus {\n    font-size: 28px;\n    font-weight: bold;\n    color: #bbbbbb;\n  }\n  .text {\n    font-size: 13px;\n    font-weight: 400;\n    color: #999999;\n    margin-top: 18px;\n  }\n}\n.upload-success {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n  height: 80vh;\n  .success {\n    width: 50px;\n    height: 50px;\n    background: #4bbc12;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    margin-bottom: 20px;\n    .image {\n      width: 60%;\n    }\n  }\n  .text {\n    font-size: 16px;\n    font-family: PingFang SC-Medium, PingFang SC;\n    font-weight: 500;\n    color: #282828;\n    margin-bottom: 40px;\n  }\n  .again {\n    width: 150px;\n    height: 43px;\n    border-radius: 21px;\n    text-align: center;\n    line-height: 41px;\n    font-size: 15px;\n    font-weight: 400;\n    color: #333333;\n    border: 1px solid #cccccc;\n  }\n}\n</style>\n"]}]}