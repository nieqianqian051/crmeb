{"remainingRequest":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/pages/kefu/index.vue?vue&type=style&index=1&id=6f59cb20&lang=css","dependencies":[{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/pages/kefu/index.vue","mtime":1719467759000},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/css-loader/index.js","mtime":1746465018503},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1746465020031},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/postcss-loader/src/index.js","mtime":1746465019371},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":1746465018509},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js","mtime":1746465019530}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CkBtZWRpYSBzY3JlZW4gYW5kIChtaW4td2lkdGg6IDMyMHB4KSBhbmQgKG1heC13aWR0aDogOTYwcHgpIHsKICAucGFnZS1hY2NvdW50IHsKICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgnfkAvYXNzZXRzL2ltYWdlcy9tX2JnLnBuZycpICFpbXBvcnRhbnQ7CiAgICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgYXV0byAhaW1wb3J0YW50OwogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICAgIGJhY2tncm91bmQtcG9zaXRpb246IGxlZnQgdG9wICFpbXBvcnRhbnQ7CiAgICBkaXNwbGF5OiBmbGV4OwogIH0KICAud3JhcHBlci1ib3ggLmZvb3QtYm94IHsKICAgIHRleHQtYWxpZ246IGNlbnRlciAhaW1wb3J0YW50OwogIH0KICAuY29udGVudCB7CiAgICBkaXNwbGF5OiBub25lOwogIH0KICAuaW5kZXhfZnJvbSB7CiAgICBib3gtc2hhZG93OiAwcHggM3B4IDIwcHggcmdiYSgwLCAyMCwgNDEsIDAuMDYpOwogICAgYmFja2dyb3VuZDogI2ZmZjsKICB9CiAgLndyYXBwZXItYm94IC5mb290LWJveCB7CiAgICBwYWRkaW5nOiAyMHB4IDY2cHggIWltcG9ydGFudDsKICAgIGNvbG9yOiAjYWRhZGFkICFpbXBvcnRhbnQ7CiAgICBmb250LXNpemU6IDAuMjJyZW0gIWltcG9ydGFudDsKICB9CiAgLmNvbnRhaW5lckJpZyB7CiAgICB3aWR0aDogODYlICFpbXBvcnRhbnQ7CiAgICBib3JkZXItcmFkaXVzOiAwLjJyZW0gIWltcG9ydGFudDsKICAgIG92ZXJmbG93OiBoaWRkZW47CiAgfQogIC5idG4gewogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjMzg3NWVhIDAlLCAjMTg5MGZjIDEwMCUpICFpbXBvcnRhbnQ7CgogICAgYm9yZGVyLXJhZGl1czogMC40MXJlbTsKICB9CiAgLml2dS1pbnB1dCB7CiAgICBib3JkZXI6IDFweCBzb2xpZCAjZGNkZWUyOwogICAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOyAvKuWOu+mZpOmYtOW9sei+ueahhiovCiAgICBvdXRsaW5lOiBub25lOwogICAgLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yOiByZ2JhKDAsIDAsIDAsIDApOyAvKueCueWHu+mrmOS6rueahOminOiJsiovCiAgfQp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA+gBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/kefu","sourcesContent":["<template>\n  <div class=\"wrapper-box\">\n    <div class=\"page-account kf\">\n      <div class=\"content\">\n        <img :src=\"copyrightImg\" alt=\"\" />\n        <div class=\"desc\">\n          <p class=\"tit\">让客户服务如此简单</p>\n          <p class=\"kefu\">专业客服系统<br />助力企业打造一流的服务体验</p>\n        </div>\n      </div>\n      <div class=\"container\" :class=\"[fullWidth > 768 ? 'containerSamll' : 'containerBig']\">\n        <div class=\"index_from page-account-container\">\n          <div :style=\"{ display: !loginType ? 'block' : 'none' }\">\n            <div class=\"page-account-top\">\n              <div class=\"page-account-top-logo\">客服登录</div>\n            </div>\n            <el-form ref=\"formInline\" :model=\"formInline\" :rules=\"ruleInline\" @keyup.enter=\"handleSubmit('formInline')\">\n              <el-form-item class=\"mb20\" prop=\"username\">\n                <el-input type=\"text\" v-model=\"formInline.username\" placeholder=\"请输入用户名\" size=\"large\" />\n              </el-form-item>\n              <el-form-item class=\"mb20\" prop=\"password\">\n                <el-input type=\"password\" v-model=\"formInline.password\" placeholder=\"请输入密码\" size=\"large\" />\n              </el-form-item>\n              <el-form-item>\n                <el-button type=\"primary\" size=\"large\" @click=\"handleSubmit('formInline')\" class=\"btn\">登录 </el-button>\n              </el-form-item>\n            </el-form>\n            <div class=\"qh_box\" v-if=\"!isMobile\" @click=\"bindScan\"><span class=\"iconfont iconerweima2\"></span></div>\n          </div>\n          <div :style=\"{ display: loginType ? 'block' : 'none' }\">\n            <div class=\"page-account-top\">\n              <div class=\"page-account-top-logo\">微信扫码登录</div>\n            </div>\n            <div class=\"code-box\">\n              <div class=\"qrcode\" ref=\"qrCodeUrl\"></div>\n              <div class=\"rxpired-box\" v-show=\"rxpired\">\n                <p>已过期</p>\n                <el-button type=\"primary\" @click=\"bindRefresh\">点击刷新</el-button>\n              </div>\n            </div>\n            <div class=\"qh_box\" @click=\"loginType = 0\"><span class=\"iconfont iconzhanghaomima\"></span></div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"foot-box\" v-if=\"copyright\">{{ copyright }}</div>\n    <div class=\"foot-box\" v-else>\n      Copyright © 2014-2024 <a href=\"https://www.crmeb.com\" target=\"_blank\">{{ version }}</a>\n    </div>\n  </div>\n</template>\n<script>\nimport { AccountLogin, loginInfoApi, getSanCodeKey, scanStatus, kefuConfig } from '@/api/kefu';\nimport mixins from '../account/mixins';\nimport Setting from '@/setting';\nimport util from '@/libs/util';\nimport QRCode from 'qrcodejs2';\nimport { getCookies, removeCookies, setCookies } from '@/libs/util';\nexport default {\n  mixins: [mixins],\n  data() {\n    return {\n      fullWidth: document.documentElement.clientWidth,\n      swiperOption: {\n        pagination: '.swiper-pagination',\n        autoplay: true,\n      },\n      modals: false,\n      autoLogin: true,\n      imgcode: '',\n      formInline: {\n        username: '',\n        password: '',\n        code: '',\n      },\n      ruleInline: {\n        username: [{ required: true, message: '请输入用户名', trigger: 'blur' }],\n        password: [{ required: true, message: '请输入密码', trigger: 'blur' }],\n        code: [{ required: true, message: '请输入验证码', trigger: 'blur' }],\n      },\n      errorNum: 0,\n      jigsaw: null,\n      login_logo: '',\n      swiperList: [],\n      defaultSwiperList: require('@/assets/images/sw.jpg'),\n      loginType: 0, // 0 账号 1 扫码\n      codeKey: '',\n      scanTime: '',\n      rxpired: false, // 扫码是否过期\n      isMobile: false,\n      version: '', //版本号\n      isScan: false,\n      timeNum: 0,\n      copyright: '',\n      copyrightImg: require('@/assets/images/logo-dark.png'),\n    };\n  },\n  created() {\n    kefuConfig().then((res) => {\n      this.version = res.data.version;\n      this.copyright = res.data.copyright;\n      if (res.data.site_name) {\n        document.title = res.data.site_name;\n      }\n      if (res.data.copyrightImg) {\n        this.copyrightImg = res.data.copyrightImg;\n      }\n    });\n    this.isMobile = this.$store.state.media.isMobile;\n    var _this = this;\n    top != window && (top.location.href = location.href);\n    document.onkeydown = function (e) {\n      if (_this.$route.name === 'login') {\n        let key = window.event.keyCode;\n        if (key === 13) {\n          _this.handleSubmit('formInline');\n        }\n      }\n    };\n    window.addEventListener('resize', this.handleResize);\n  },\n  watch: {\n    fullWidth(val) {\n      // 为了避免频繁触发resize函数导致页面卡顿，使用定时器\n      if (!this.timer) {\n        // 一旦监听到的screenWidth值改变，就将其重新赋给data里的screenWidth\n        this.screenWidth = val;\n        this.timer = true;\n        let that = this;\n        setTimeout(function () {\n          // 打印screenWidth变化的值\n          that.timer = false;\n        }, 400);\n      }\n    },\n    $route(n) {\n      this.captchas();\n    },\n  },\n  mounted: function () {\n    this.$nextTick(() => {});\n\n    this.captchas();\n  },\n  methods: {\n    // 切换扫码\n    bindScan() {\n      if (!this.isScan) {\n        this.isScan = true;\n        this.getSanCodeKey();\n      }\n      this.loginType = 1;\n    },\n    // 生成二维码\n    creatQrCode() {\n      let url = `${window.location.protocol}//${window.location.host}/pages/users/scan_login/index?key=${this.codeKey}`;\n      var qrcode = new QRCode(this.$refs.qrCodeUrl, {\n        text: url, // 需要转换为二维码的内容\n        width: 160,\n        height: 160,\n        colorDark: '#000000',\n        colorLight: '#ffffff',\n        correctLevel: QRCode.CorrectLevel.H,\n      });\n    },\n    // 关闭模态框\n    closeModel() {\n      AccountLogin({\n        account: this.formInline.username,\n        password: this.formInline.password,\n        imgcode: this.formInline.code,\n      })\n        .then(async (res) => {\n          let expires = this.getExpiresTime(res.data.exp_time);\n          // 记录用户登陆信息\n          setCookies('kefu_uuid', res.data.kefuInfo.uid, expires);\n          setCookies('kefu_token', res.data.token, expires);\n          setCookies('kefu_expires_time', res.data.exp_time, expires);\n          setCookies('kefuInfo', res.data.kefuInfo, expires);\n\n          // 记录用户信息\n          this.$store.commit('kefu/setInfo', res.data.kefuInfo);\n\n          if (this.$store.state.media.isMobile) {\n            //手机页面\n            return this.$router.replace({ path: this.$route.query.redirect || '/kefu/mobile_list' });\n          } else {\n            // pc页面\n            return this.$router.replace({ path: this.$route.query.redirect || '/kefu/pc_list' });\n          }\n        })\n        .catch((res) => {\n          let data = res === undefined ? {} : res;\n          this.errorNum++;\n          this.captchas();\n          this.$message.error(data.msg || '登录失败');\n          if (this.jigsaw) this.jigsaw.reset();\n        });\n    },\n    getExpiresTime(expiresTime) {\n      let nowTimeNum = Math.round(new Date() / 1000);\n      let expiresTimeNum = expiresTime - nowTimeNum;\n      return parseFloat(parseFloat(parseFloat(expiresTimeNum / 60) / 60) / 24);\n    },\n    closefail() {\n      if (this.jigsaw) this.jigsaw.reset();\n      this.$message.error('校验错误');\n    },\n    handleResize(event) {\n      this.fullWidth = document.documentElement.clientWidth;\n    },\n    captchas: function () {\n      this.imgcode = Setting.apiBaseURL + '/captcha_pro?' + Date.parse(new Date());\n    },\n    handleSubmit(name) {\n      this.$refs[name].validate((valid) => {\n        if (valid) {\n          this.closeModel();\n        }\n      });\n    },\n    // 获取客服扫码key\n    getSanCodeKey() {\n      getSanCodeKey()\n        .then((res) => {\n          this.codeKey = res.data.key;\n          this.creatQrCode();\n          this.scanTime = setInterval(() => {\n            this.timeNum++;\n            if (this.timeNum >= 60) {\n              this.timeNum = 0;\n              window.clearInterval(this.scanTime);\n              this.rxpired = true;\n            } else {\n              this.getScanStatus();\n            }\n          }, 1000);\n        })\n        .catch((error) => {\n          this.timeNum = 0;\n          window.clearInterval(this.scanTime);\n          this.rxpired = true;\n          this.$message.error(error.msg);\n        });\n    },\n    // 扫码登录情况\n    getScanStatus() {\n      scanStatus(this.codeKey)\n        .then(async (res) => {\n          // 0 = 二维码过期需要重新获取授权凭证\n          if (res.data.status == 0) {\n            this.timeNum = 0;\n            window.clearInterval(this.scanTime);\n            this.rxpired = true;\n          }\n          // 1=正在扫描\n          if (res.data.status == 1) {\n          }\n          // 3 扫描成功正在登录\n          if (res.data.status == 3) {\n            window.clearInterval(this.scanTime);\n            let expires = this.getExpiresTime(res.data.exp_time);\n            // 记录用户登陆信息\n            setCookies('kefu_uuid', res.data.kefuInfo.uid, expires);\n            setCookies('kefu_token', res.data.token, expires);\n            setCookies('kefu_expires_time', res.data.exp_time, expires);\n            setCookies('kefuInfo', res.data.kefuInfo, expires);\n            // 记录用户信息\n            this.$store.commit('kefu/setInfo', res.data.kefuInfo);\n            if (this.$store.state.media.isMobile) {\n              //手机页面\n              return this.$router.replace({ path: this.$route.query.redirect || '/kefu/mobile_list' });\n            } else {\n              // pc页面\n              return this.$router.replace({ path: this.$route.query.redirect || '/kefu/pc_list' });\n            }\n          }\n        })\n        .catch((error) => {\n          this.$message.error(error.msg);\n          this.timeNum = 0;\n          window.clearInterval(this.scanTime);\n          this.rxpired = true;\n        });\n    },\n    // 刷新二维码\n    bindRefresh() {\n      this.$refs.qrCodeUrl.innerHTML = '';\n      this.rxpired = false;\n      this.getSanCodeKey();\n    },\n  },\n  beforeCreate() {},\n  beforeDestroy: function () {\n    this.timeNum = 0;\n    this.$refs.qrCodeUrl.innerHTML = '';\n    window.clearInterval(this.scanTime);\n    window.removeEventListener('resize', this.handleResize);\n    // document.getElementsByTagName('canvas')[0].removeAttribute('class', 'index_bg');\n  },\n};\n</script>\n<style scoped lang=\"stylus\">\n.page-account {\n  display: flex;\n  width: 100%;\n  background-image: url('~@/assets/images/kfbg_2.jpg');\n  background-size: cover;\n  background-position: center;\n  justify-content: center;\n  align-items: center;\n  height: 100vh;\n  overflow: auto;\n\n  .content {\n    height: 400px;\n    margin-right: 100px;\n\n    .desc {\n      color: #fff;\n\n      .tit {\n        font-size: 40px;\n        font-weight: 600;\n      }\n\n      .kefu {\n        margin-top: 30px;\n        font-weight: 500;\n        font-size: 20px;\n      }\n    }\n\n    img {\n      width: 360px;\n      margin-left: -100px;\n    }\n  }\n}\n\n.code-box {\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  .qrcode {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 180px;\n    height: 180px;\n    border: 1px solid #E5E5E6;\n  }\n\n  .rxpired-box {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    width: 160px;\n    height: 160px;\n    background: rgba(0, 0, 0, 0.6);\n\n    p {\n      margin-bottom: 10px;\n      font-size: 15px;\n      color: #fff;\n    }\n  }\n}\n\n.page-account-top-logo {\n  color: #000000;\n  font-size: 21px;\n}\n\n.wrapper-box {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n\n  .foot-box {\n    padding: 20px 20px;\n    font-size: 14px;\n    color: #666666;\n    text-align: right;\n    box-sizing: border-box;\n\n    a {\n      margin-left: 0;\n      color: #666666;\n    }\n  }\n}\n\n.page-account {\n  display: flex;\n  flex: 1;\n}\n\n.page-account .code {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.page-account .code .pictrue {\n  height: 40px;\n}\n\n.swiperPross {\n  border-radius: 6px 0px 0px 6px;\n}\n\n.swiperPross, .swiperPic, .swiperPic img {\n  width: 510px;\n  height: 100%;\n}\n\n.swiperPic img {\n  width: 100%;\n  height: 100%;\n}\n\n.container {\n  height: 400px !important;\n  padding: 0 !important;\n  /* overflow: hidden; */\n  border-radius: 6px;\n  z-index: 1;\n  display: flex;\n}\n\n.containerSamll {\n  width: 384px !important;\n  // margin-left: 30%;\n  background: #fff !important;\n}\n\n.containerBig {\n  width: 90%;\n  padding-bottom: 20px;\n  margin-top: 84px;\n  background: #f7f7f7 !important;\n  height: auto !important;\n  box-shadow: 0px 3px 20px rgba(0, 20, 41, 0.06);\n}\n\n.index_from {\n  position: relative;\n  padding: 40px 40px 32px 40px;\n  height: 400px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.containerBig .index_from {\n  padding: 20px;\n  height: auto !important;\n}\n\n.index_from .qh_box {\n  position: absolute;\n  right: 12px;\n  top: 0;\n  cursor: pointer;\n\n  .iconfont {\n    color: #265BED;\n    font-size: 36px;\n  }\n}\n\n.page-account-top {\n  padding: 20px 0 50px !important;\n  box-sizing: border-box !important;\n  display: flex;\n  justify-content: center;\n}\n\n.page-account-container {\n  border-radius: 0px 6px 6px 0px;\n}\n\n.btn {\n  width: 100%;\n  background: #265BED;\n}\n\n.captchaBox {\n  width: 310px;\n}\n\ninput {\n  display: block;\n  width: 290px;\n  line-height: 40px;\n  margin: 10px 0;\n  padding: 0 10px;\n  outline: none;\n  border: 1px solid #c8cccf;\n  border-radius: 4px;\n  color: #6a6f77;\n}\n\n#msg {\n  width: 100%;\n  line-height: 40px;\n  font-size: 14px;\n  text-align: center;\n}\n\na:link, a:visited, a:hover, a:active {\n  margin-left: 100px;\n  color: #0366D6;\n}\n\n.index_from ::v-deep .ivu-input-large {\n  font-size: 14px !important;\n}\n</style>\n<style>\n@media screen and (min-width: 320px) and (max-width: 960px) {\n  .page-account {\n    background-image: url('~@/assets/images/m_bg.png') !important;\n    background-size: 100% auto !important;\n    background-repeat: no-repeat;\n    background-position: left top !important;\n    display: flex;\n  }\n  .wrapper-box .foot-box {\n    text-align: center !important;\n  }\n  .content {\n    display: none;\n  }\n  .index_from {\n    box-shadow: 0px 3px 20px rgba(0, 20, 41, 0.06);\n    background: #fff;\n  }\n  .wrapper-box .foot-box {\n    padding: 20px 66px !important;\n    color: #adadad !important;\n    font-size: 0.22rem !important;\n  }\n  .containerBig {\n    width: 86% !important;\n    border-radius: 0.2rem !important;\n    overflow: hidden;\n  }\n  .btn {\n    background: linear-gradient(90deg, #3875ea 0%, #1890fc 100%) !important;\n\n    border-radius: 0.41rem;\n  }\n  .ivu-input {\n    border: 1px solid #dcdee2;\n    -webkit-appearance: none; /*去除阴影边框*/\n    outline: none;\n    -webkit-tap-highlight-color: rgba(0, 0, 0, 0); /*点击高亮的颜色*/\n  }\n}\n</style>\n"]}]}