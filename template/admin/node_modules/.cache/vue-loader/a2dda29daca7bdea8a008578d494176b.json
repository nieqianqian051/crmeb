{"remainingRequest":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/components/couponList/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/components/couponList/index.vue","mtime":1719467759000},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":1746465018509},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/babel-loader/lib/index.js","mtime":1746465024347},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":1746465018509},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js","mtime":1746465019530}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IHJlbGVhc2VkTGlzdEFwaSB9IGZyb20gJ0AvYXBpL21hcmtldGluZyc7CmltcG9ydCB7IGZvcm1hdERhdGUgfSBmcm9tICdAL3V0aWxzL3ZhbGlkYXRlJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnaW5kZXgnLAogIGZpbHRlcnM6IHsKICAgIGZvcm1hdERhdGUodGltZSkgewogICAgICBpZiAodGltZSAhPT0gMCkgewogICAgICAgIGxldCBkYXRlID0gbmV3IERhdGUodGltZSAqIDEwMDApOwogICAgICAgIHJldHVybiBmb3JtYXREYXRlKGRhdGUsICd5eXl5LU1NLWRkIGhoOm1tJyk7CiAgICAgIH0KICAgIH0sCiAgfSwKICBwcm9wczogewogICAgY291cG9uaWRzOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgfSwKICAgIHVwZGF0ZUlkczogewogICAgICB0eXBlOiBBcnJheSwKICAgIH0sCiAgICB1cGRhdGVOYW1lOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgfSwKICAgIGx1Y2tEcmF3OiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgfSwKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB0ZW1wbGF0ZVJhZGlvOiAwLAoKICAgICAgY3VycmVudGlkOiAwLAogICAgICBwcm9kdWN0Um93OiB7fSwKICAgICAgaXNUZW1wbGF0ZTogZmFsc2UsCiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICB0YWJsZUZyb206IHsKICAgICAgICByZWNlaXZlX3R5cGU6IDMsCiAgICAgICAgcGFnZTogMSwKICAgICAgICBsaW1pdDogNSwKICAgICAgfSwKICAgICAgdG90YWw6IDAsCiAgICAgIGlkczogW10sCiAgICAgIHRleHRzOiBbXSwKICAgICAgY291cG9uTGlzdDogW10sCiAgICAgIHNlbGVjdGVkSWRzOiBbXSwKICAgICAgc2VsZWN0ZWROYW1lczogW10sCiAgICAgIG11bHRpcGxlU2VsZWN0aW9uOiBbXSwKICAgIH07CiAgfSwKICBtb3VudGVkKCkge30sCiAgd2F0Y2g6IHsKICAgIHVwZGF0ZUlkczogZnVuY3Rpb24gKG5ld1ZhbCkgewogICAgICB0aGlzLnNlbGVjdGVkSWRzID0gbmV3VmFsOwogICAgfSwKICAgIHVwZGF0ZU5hbWU6IGZ1bmN0aW9uIChuZXdWYWwpIHsKICAgICAgdGhpcy5zZWxlY3RlZE5hbWVzID0gbmV3VmFsOwogICAgICB0aGlzLm11bHRpcGxlU2VsZWN0aW9uID0gbmV3VmFsOwogICAgfSwKICB9LAogIGNyZWF0ZWQoKSB7fSwKICBtZXRob2RzOiB7CiAgICBnZXRSb3dLZXkocm93KSB7CiAgICAgIHJldHVybiByb3cuaWQ7CiAgICB9LAogICAgZ2V0VGVtcGxhdGVSb3cocm93KSB7CiAgICAgIHRoaXMuY3VycmVudGlkID0gcm93LmlkOwogICAgICB0aGlzLnByb2R1Y3RSb3cgPSByb3c7CiAgICB9LAogICAgLy/lr7nosaHmlbDnu4Tljrvph43vvJsKICAgIHVuaXF1ZShhcnIpIHsKICAgICAgY29uc3QgcmVzID0gbmV3IE1hcCgpOwogICAgICByZXR1cm4gYXJyLmZpbHRlcigoYXJyKSA9PiAhcmVzLmhhcyhhcnIuaWQpICYmIHJlcy5zZXQoYXJyLmlkLCAxKSk7CiAgICB9LAogICAgY2hhbmdlQ2hlY2tib3goc2VsZWN0aW9uKSB7CiAgICAgIGxldCB1bmlxdWVBcnIgPSBbXTsKICAgICAgbGV0IGN1cHMgPSBbXTsKICAgICAgbGV0IGlkcyA9IFtdOwogICAgICBsZXQgYXJyID0gdGhpcy51bmlxdWUoc2VsZWN0aW9uKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBpdGVtID0gYXJyW2ldOwogICAgICAgIGlmICghaWRzLmluY2x1ZGVzKGl0ZW0uaWQpKSB7CiAgICAgICAgICBsZXQgb2JqID0gewogICAgICAgICAgICBpZDogaXRlbS5pZCwKICAgICAgICAgICAgdGl0bGU6IGl0ZW0udGl0bGUsCiAgICAgICAgICB9OwogICAgICAgICAgY3Vwcy5wdXNoKG9iaik7CiAgICAgICAgICBpZHMucHVzaChpdGVtLmlkKTsKICAgICAgICAgIHVuaXF1ZUFyci5wdXNoKGl0ZW0pOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnNlbGVjdGVkSWRzID0gaWRzOwogICAgICB0aGlzLnNlbGVjdGVkTmFtZXMgPSBjdXBzOwogICAgICB0aGlzLm11bHRpcGxlU2VsZWN0aW9uID0gdW5pcXVlQXJyOwogICAgfSwKICAgIGNhbmNlbCgpIHsKICAgICAgdGhpcy5pc1RlbXBsYXRlID0gZmFsc2U7CiAgICAgIGlmICh0aGlzLmx1Y2tEcmF3KSB7CiAgICAgICAgdGhpcy5jdXJyZW50aWQgPSAwOwogICAgICB9CiAgICB9LAogICAgdGFibGVMaXN0KCkgewogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICByZWxlYXNlZExpc3RBcGkodGhpcy50YWJsZUZyb20pLnRoZW4oKHJlcykgPT4gewogICAgICAgIGxldCBkYXRhID0gcmVzLmRhdGE7CiAgICAgICAgdGhpcy5jb3Vwb25MaXN0ID0gZGF0YS5saXN0OwogICAgICAgIHRoaXMudG90YWwgPSBkYXRhLmNvdW50OwogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIC8v56Gu5L+dZG9t5Yqg6L295a6M5q+VCiAgICAgICAgICAvLyB0aGlzLnNldENoZWNrZWQoKTsKICAgICAgICAgIHRoaXMuc2hvd1NlbGVjdERhdGEoKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgb2soKSB7CiAgICAgIGlmICh0aGlzLmx1Y2tEcmF3KSB7CiAgICAgICAgdGhpcy4kZW1pdCgnZ2V0Q291cG9uSWQnLCB0aGlzLnByb2R1Y3RSb3cpOwogICAgICAgIHRoaXMuY3VycmVudGlkID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRlbWl0KCduYW1lSWQnLCB0aGlzLnNlbGVjdGVkSWRzLCB0aGlzLnNlbGVjdGVkTmFtZXMpOwogICAgICB9CiAgICAgIHRoaXMuaXNUZW1wbGF0ZSA9IGZhbHNlOwogICAgfSwKICAgIHBhZ2VDaGFuZ2UoaW5kZXgpIHsKICAgICAgdGhpcy50YWJsZUZyb20ucGFnZSA9IGluZGV4OwogICAgICB0aGlzLnRhYmxlTGlzdCgpOwogICAgfSwKICAgIGxpbWl0Q2hhbmdlKGxpbWl0KSB7CiAgICAgIHRoaXMudGFibGVGcm9tLmxpbWl0ID0gbGltaXQ7CiAgICAgIHRoaXMudGFibGVMaXN0KCk7CiAgICB9LAogICAgc2hvd1NlbGVjdERhdGEoKSB7CiAgICAgIGlmICh0aGlzLm11bHRpcGxlU2VsZWN0aW9uLmxlbmd0aCA+IDApIHsKICAgICAgICAvLyDliKTmlq3mmK/lkKblrZjlnKjli77pgInov4fnmoTmlbDmja4KICAgICAgICB0aGlzLmNvdXBvbkxpc3QuZm9yRWFjaCgocm93KSA9PiB7CiAgICAgICAgICAvLyDojrflj5bmlbDmja7liJfooajmjqXlj6Por7fmsYLliLDnmoTmlbDmja4KICAgICAgICAgIHRoaXMubXVsdGlwbGVTZWxlY3Rpb24uZm9yRWFjaCgoaXRlbSkgPT4gewogICAgICAgICAgICAvLyDli77pgInliLDnmoTmlbDmja4KICAgICAgICAgICAgaWYgKHJvdy5pZCA9PT0gaXRlbS5pZCkgewogICAgICAgICAgICAgIC8vIHRoaXMuJHJlZnMudGFibGUudG9nZ2xlUm93U2VsZWN0aW9uKGl0ZW0sIHRydWUpOyAvLyDoi6XmnInph43lkIjvvIzliJnlm57mmL7or6XmnaHmlbDmja4KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA6FA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/couponList","sourcesContent":["<template>\n  <div>\n    <el-dialog :visible.sync=\"isTemplate\" title=\"优惠券列表\" append-to-body width=\"1000px\">\n      <el-table\n        :data=\"couponList\"\n        ref=\"table\"\n        class=\"mt20\"\n        v-loading=\"loading\"\n        highlight-current-row\n        :row-key=\"getRowKey\"\n        no-userFrom-text=\"暂无数据\"\n        no-filtered-userFrom-text=\"暂无筛选结果\"\n        @selection-change=\"changeCheckbox\"\n      >\n        <el-table-column v-if=\"!luckDraw\" type=\"selection\" width=\"55\" :reserve-selection=\"true\"> </el-table-column>\n        <el-table-column v-else width=\"50\">\n          <template slot-scope=\"scope\">\n            <el-radio v-model=\"templateRadio\" :label=\"scope.row.id\" @change.native=\"getTemplateRow(scope.row)\"\n              >&nbsp;</el-radio\n            >\n          </template>\n        </el-table-column>\n        <el-table-column label=\"ID\" width=\"60\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.id }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"优惠券名称\" min-width=\"120\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.title }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"优惠券类型\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span v-if=\"scope.row.type === 1\">品类券</span>\n            <span v-else-if=\"scope.row.type === 2\">商品券</span>\n            <span v-else-if=\"scope.row.type === 3\">会员券</span>\n            <span v-else>通用券</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"面值\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.coupon_price }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"最低消费额\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.use_min_price }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"发布数量\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span v-if=\"scope.row.is_permanent\">不限量</span>\n            <div v-else>\n              <span class=\"fa\">发布：{{ scope.row.total_count }}</span>\n              <span class=\"sheng\">剩余：{{ scope.row.remain_count }}</span>\n            </div>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"有效期限\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <div v-if=\"scope.row.start_time\">\n              {{ scope.row.start_time | formatDate }} - {{ scope.row.end_time | formatDate }}\n            </div>\n            <span v-else>不限时</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"状态\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <el-tag size=\"medium\" v-show=\"scope.row.status === 1\">正常</el-tag>\n            <el-tag size=\"medium\" type=\"danger\" v-show=\"scope.row.status === 0\">未开启</el-tag>\n            <el-tag size=\"medium\" type=\"info\" v-show=\"scope.row.status === -1\">已失效</el-tag>\n          </template>\n        </el-table-column>\n      </el-table>\n      <div class=\"acea-row row-right page\">\n        <pagination\n          v-if=\"total\"\n          :total=\"total\"\n          :page.sync=\"tableFrom.page\"\n          :limit.sync=\"tableFrom.limit\"\n          @pagination=\"tableList\"\n        />\n      </div>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"cancel\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"ok\">确 定</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { releasedListApi } from '@/api/marketing';\nimport { formatDate } from '@/utils/validate';\n\nexport default {\n  name: 'index',\n  filters: {\n    formatDate(time) {\n      if (time !== 0) {\n        let date = new Date(time * 1000);\n        return formatDate(date, 'yyyy-MM-dd hh:mm');\n      }\n    },\n  },\n  props: {\n    couponids: {\n      type: Array,\n    },\n    updateIds: {\n      type: Array,\n    },\n    updateName: {\n      type: Array,\n    },\n    luckDraw: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    return {\n      templateRadio: 0,\n\n      currentid: 0,\n      productRow: {},\n      isTemplate: false,\n      loading: false,\n      tableFrom: {\n        receive_type: 3,\n        page: 1,\n        limit: 5,\n      },\n      total: 0,\n      ids: [],\n      texts: [],\n      couponList: [],\n      selectedIds: [],\n      selectedNames: [],\n      multipleSelection: [],\n    };\n  },\n  mounted() {},\n  watch: {\n    updateIds: function (newVal) {\n      this.selectedIds = newVal;\n    },\n    updateName: function (newVal) {\n      this.selectedNames = newVal;\n      this.multipleSelection = newVal;\n    },\n  },\n  created() {},\n  methods: {\n    getRowKey(row) {\n      return row.id;\n    },\n    getTemplateRow(row) {\n      this.currentid = row.id;\n      this.productRow = row;\n    },\n    //对象数组去重；\n    unique(arr) {\n      const res = new Map();\n      return arr.filter((arr) => !res.has(arr.id) && res.set(arr.id, 1));\n    },\n    changeCheckbox(selection) {\n      let uniqueArr = [];\n      let cups = [];\n      let ids = [];\n      let arr = this.unique(selection);\n      for (let i = 0; i < arr.length; i++) {\n        const item = arr[i];\n        if (!ids.includes(item.id)) {\n          let obj = {\n            id: item.id,\n            title: item.title,\n          };\n          cups.push(obj);\n          ids.push(item.id);\n          uniqueArr.push(item);\n        }\n      }\n      this.selectedIds = ids;\n      this.selectedNames = cups;\n      this.multipleSelection = uniqueArr;\n    },\n    cancel() {\n      this.isTemplate = false;\n      if (this.luckDraw) {\n        this.currentid = 0;\n      }\n    },\n    tableList() {\n      this.loading = true;\n      releasedListApi(this.tableFrom).then((res) => {\n        let data = res.data;\n        this.couponList = data.list;\n        this.total = data.count;\n        this.$nextTick(() => {\n          //确保dom加载完毕\n          // this.setChecked();\n          this.showSelectData();\n        });\n        this.loading = false;\n      });\n    },\n    ok() {\n      if (this.luckDraw) {\n        this.$emit('getCouponId', this.productRow);\n        this.currentid = 0;\n      } else {\n        this.$emit('nameId', this.selectedIds, this.selectedNames);\n      }\n      this.isTemplate = false;\n    },\n    pageChange(index) {\n      this.tableFrom.page = index;\n      this.tableList();\n    },\n    limitChange(limit) {\n      this.tableFrom.limit = limit;\n      this.tableList();\n    },\n    showSelectData() {\n      if (this.multipleSelection.length > 0) {\n        // 判断是否存在勾选过的数据\n        this.couponList.forEach((row) => {\n          // 获取数据列表接口请求到的数据\n          this.multipleSelection.forEach((item) => {\n            // 勾选到的数据\n            if (row.id === item.id) {\n              // this.$refs.table.toggleRowSelection(item, true); // 若有重合，则回显该条数据\n            }\n          });\n        });\n      }\n    },\n  },\n};\n</script>\n\n<style scoped></style>\n"]}]}