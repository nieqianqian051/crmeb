{"remainingRequest":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/pages/product/productAttr/addAttr.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/pages/product/productAttr/addAttr.vue","mtime":1719467759000},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":1746465018509},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/babel-loader/lib/index.js","mtime":1746465024347},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":1746465018509},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js","mtime":1746465019530}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAndnVleCc7CmltcG9ydCB7IHJ1bGVBZGRBcGksIHJ1bGVJbmZvQXBpIH0gZnJvbSAnQC9hcGkvcHJvZHVjdCc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnYWRkQXR0cicsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHNwaW5TaG93OiBmYWxzZSwKICAgICAgbW9kYWxfbG9hZGluZzogZmFsc2UsCiAgICAgIGdyaWQ6IHsKICAgICAgICB4bDogMywKICAgICAgICBsZzogMywKICAgICAgICBtZDogMTIsCiAgICAgICAgc206IDI0LAogICAgICAgIHhzOiAyNCwKICAgICAgfSwKICAgICAgbW9kYWw6IGZhbHNlLAogICAgICBpbmRleDogMSwKICAgICAgcnVsZXM6IHsKICAgICAgICBydWxlX25hbWU6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36L6T5YWl6KeE5qC85ZCN56ewJywgdHJpZ2dlcjogJ2JsdXInIH1dLAogICAgICB9LAogICAgICBmb3JtRHluYW1pYzogewogICAgICAgIHJ1bGVfbmFtZTogJycsCiAgICAgICAgc3BlYzogW10sCiAgICAgIH0sCiAgICAgIGF0dHJzTmFtZTogJycsCiAgICAgIGF0dHJzVmFsOiAnJywKICAgICAgZm9ybUR5bmFtaWNOYW1lRGF0YTogW10sCiAgICAgIGlzQnRuOiBmYWxzZSwKICAgICAgZm9ybUR5bmFtaWNOYW1lOiBbXSwKICAgICAgcmVzdWx0czogW10sCiAgICAgIHJlc3VsdDogW10sCiAgICAgIGlkczogMCwKICAgIH07CiAgfSwKICBjb21wdXRlZDoge30sCiAgbWV0aG9kczogewogICAgb25DYW5jZWwoKSB7CiAgICAgIHRoaXMuaWRzID0gMDsKICAgICAgdGhpcy5jbGVhcigpOwogICAgfSwKICAgIG9uQ2xvc2UoKSB7CiAgICAgIHRoaXMuaWRzID0gMDsKICAgICAgdGhpcy5jbGVhcigpOwogICAgICB0aGlzLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgLy8g5re75Yqg5oyJ6ZKuCiAgICBhZGRCdG4oKSB7CiAgICAgIHRoaXMuaXNCdG4gPSB0cnVlOwogICAgfSwKICAgIC8vIOivpuaDhQogICAgZ2V0SW9mbyhyb3cpIHsKICAgICAgdGhpcy5zcGluU2hvdyA9IHRydWU7CiAgICAgIHRoaXMuaWRzID0gcm93LmlkOwogICAgICBydWxlSW5mb0FwaShyb3cuaWQpCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5mb3JtRHluYW1pYyA9IHJlcy5kYXRhLmluZm87CiAgICAgICAgICB0aGlzLnNwaW5TaG93ID0gZmFsc2U7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKHJlcykgPT4gewogICAgICAgICAgdGhpcy5zcGluU2hvdyA9IGZhbHNlOwogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgICB9KTsKICAgIH0sCiAgICAvLyDmj5DkuqQKICAgIGhhbmRsZVN1Ym1pdChuYW1lKSB7CiAgICAgIHRoaXMuJHJlZnNbbmFtZV0udmFsaWRhdGUoKHZhbGlkKSA9PiB7CiAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICBpZiAodGhpcy5mb3JtRHluYW1pYy5zcGVjLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS53YXJuaW5nKCfor7foh7PlsJHmt7vliqDkuIDmnaHllYblk4Hop4TmoLzvvIEnKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMubW9kYWxfbG9hZGluZyA9IHRydWU7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgcnVsZUFkZEFwaSh0aGlzLmZvcm1EeW5hbWljLCB0aGlzLmlkcykKICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MocmVzLm1zZyk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgdGhpcy5tb2RhbCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB0aGlzLm1vZGFsX2xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnZ2V0TGlzdCcpOwogICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICB9LCA2MDApOwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLmNhdGNoKChyZXMpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMubW9kYWxfbG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0sIDEyMDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjbGVhcigpIHsKICAgICAgdGhpcy4kcmVmc1snZm9ybUR5bmFtaWMnXS5yZXNldEZpZWxkcygpOwogICAgICB0aGlzLmZvcm1EeW5hbWljLnNwZWMgPSBbXTsKICAgICAgdGhpcy5pc0J0biA9IGZhbHNlOwogICAgICB0aGlzLmF0dHJzTmFtZSA9ICcnOwogICAgICB0aGlzLmF0dHJzVmFsID0gJyc7CiAgICAgIHRoaXMuaWRzID0gMDsKICAgIH0sCiAgICAvLyDlj5bmtogKICAgIG9mZkF0dHJOYW1lKCkgewogICAgICB0aGlzLmlzQnRuID0gZmFsc2U7CiAgICB9LAogICAgLy8g5Yig6ZmkCiAgICBoYW5kbGVSZW1vdmUoaW5kZXgpIHsKICAgICAgdGhpcy5mb3JtRHluYW1pYy5zcGVjLnNwbGljZShpbmRleCwgMSk7CiAgICB9LAogICAgLy8g5Yig6Zmk5bGe5oCnCiAgICBoYW5kbGVSZW1vdmUyKGl0ZW0sIGluZGV4KSB7CiAgICAgIGl0ZW0uc3BsaWNlKGluZGV4LCAxKTsKICAgIH0sCiAgICAvLyDmt7vliqDop4TliJnlkI3np7AKICAgIGNyZWF0ZUF0dHJOYW1lKCkgewogICAgICBpZiAodGhpcy5hdHRyc05hbWUgJiYgdGhpcy5hdHRyc1ZhbCkgewogICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgdmFsdWU6IHRoaXMuYXR0cnNOYW1lLAogICAgICAgICAgZGV0YWlsOiBbdGhpcy5hdHRyc1ZhbF0sCiAgICAgICAgfTsKICAgICAgICB0aGlzLmZvcm1EeW5hbWljLnNwZWMucHVzaChkYXRhKTsKICAgICAgICB2YXIgaGFzaCA9IHt9OwogICAgICAgIHRoaXMuZm9ybUR5bmFtaWMuc3BlYyA9IHRoaXMuZm9ybUR5bmFtaWMuc3BlYy5yZWR1Y2UoZnVuY3Rpb24gKGl0ZW0sIG5leHQpIHsKICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlICovCiAgICAgICAgICBoYXNoW25leHQudmFsdWVdID8gJycgOiAoaGFzaFtuZXh0LnZhbHVlXSA9IHRydWUgJiYgaXRlbS5wdXNoKG5leHQpKTsKICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgIH0sIFtdKTsKICAgICAgICB0aGlzLmF0dHJzTmFtZSA9ICcnOwogICAgICAgIHRoaXMuYXR0cnNWYWwgPSAnJzsKICAgICAgICB0aGlzLmlzQnRuID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCfor7fmt7vliqDop4TmoLzlkI3np7DmiJbop4TmoLzlgLwnKTsKICAgICAgfQogICAgfSwKICAgIC8vIOa3u+WKoOWxnuaApwogICAgY3JlYXRlQXR0cihudW0sIGlkeCkgewogICAgICBpZiAobnVtKSB7CiAgICAgICAgdGhpcy5mb3JtRHluYW1pYy5zcGVjW2lkeF0uZGV0YWlsLnB1c2gobnVtKTsKICAgICAgICB2YXIgaGFzaCA9IHt9OwogICAgICAgIHRoaXMuZm9ybUR5bmFtaWMuc3BlY1tpZHhdLmRldGFpbCA9IHRoaXMuZm9ybUR5bmFtaWMuc3BlY1tpZHhdLmRldGFpbC5yZWR1Y2UoZnVuY3Rpb24gKGl0ZW0sIG5leHQpIHsKICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlICovCiAgICAgICAgICBoYXNoW25leHRdID8gJycgOiAoaGFzaFtuZXh0XSA9IHRydWUgJiYgaXRlbS5wdXNoKG5leHQpKTsKICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgIH0sIFtdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoJ+ivt+a3u+WKoOWxnuaApycpOwogICAgICB9CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["addAttr.vue"],"names":[],"mappings":";AA6EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addAttr.vue","sourceRoot":"src/pages/product/productAttr","sourcesContent":["<template>\n  <el-dialog :visible.sync=\"modal\" @closed=\"onCancel\" title=\"商品规格\" width=\"1000px\" v-loading=\"spinShow\">\n    <el-form\n      ref=\"formDynamic\"\n      :model=\"formDynamic\"\n      :rules=\"rules\"\n      class=\"attrFrom\"\n      label-width=\"110px\"\n      label-position=\"right\"\n      @submit.native.prevent\n    >\n      <el-row :gutter=\"24\">\n        <el-col :span=\"24\">\n          <el-col :span=\"8\">\n            <el-form-item label=\"规格模板名称：\" prop=\"rule_name\">\n              <el-input placeholder=\"请输入标题名称\" :maxlength=\"20\" v-model.trim=\"formDynamic.rule_name\" />\n            </el-form-item>\n          </el-col>\n        </el-col>\n        <el-col :span=\"23\" class=\"noForm\" v-for=\"(item, index) in formDynamic.spec\" :key=\"index\">\n          <el-form-item>\n            <div class=\"acea-row row-middle\">\n              <span class=\"mr5\">{{ item.value }}</span>\n              <i class=\"el-icon-close\" style=\"font-size: 14px\" @click=\"handleRemove(index)\"></i>\n            </div>\n            <div class=\"rulesBox\">\n              <el-tag\n                class=\"mr14 mb10\"\n                closable\n                color=\"primary\"\n                v-for=\"(j, indexn) in item.detail\"\n                :key=\"indexn\"\n                @close=\"handleRemove2(item.detail, indexn)\"\n                >{{ j }}</el-tag\n              >\n              <el-input\n                placeholder=\"请输入属性名称\"\n                v-model.trim=\"item.detail.attrsVal\"\n                @keyup.enter.native=\"createAttr(item.detail.attrsVal, index)\"\n                class=\"mb10 form_content_width\"\n              >\n                <template slot=\"append\">\n                  <el-button type=\"primary\" @click=\"createAttr(item.detail.attrsVal, index)\">确定</el-button>\n                </template>\n              </el-input>\n            </div>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"24\" v-if=\"isBtn\" class=\"mt10\">\n          <el-col :span=\"8\" class=\"mr15\">\n            <el-form-item label=\"规格名称：\">\n              <el-input placeholder=\"请输入规格\" v-model=\"attrsName\" />\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"8\" class=\"mr20\">\n            <el-form-item label=\"规格值：\">\n              <el-input v-model=\"attrsVal\" placeholder=\"请输入规格值\" />\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"2\">\n            <el-button type=\"primary\" @click=\"createAttrName\">确定</el-button>\n          </el-col>\n          <el-col :span=\"2\">\n            <el-button @click=\"offAttrName\">取消</el-button>\n          </el-col>\n        </el-col>\n      </el-row>\n      <el-button type=\"primary\" @click=\"addBtn\" v-if=\"!isBtn\" class=\"add\">添加新规格</el-button>\n    </el-form>\n    <span slot=\"footer\" class=\"dialog-footer\">\n      <el-button @click=\"onClose\">取消</el-button>\n      <el-button type=\"primary\" :loading=\"modal_loading\" @click=\"handleSubmit('formDynamic')\">确定</el-button>\n    </span>\n  </el-dialog>\n</template>\n\n<script>\nimport { mapState } from 'vuex';\nimport { ruleAddApi, ruleInfoApi } from '@/api/product';\nexport default {\n  name: 'addAttr',\n  data() {\n    return {\n      spinShow: false,\n      modal_loading: false,\n      grid: {\n        xl: 3,\n        lg: 3,\n        md: 12,\n        sm: 24,\n        xs: 24,\n      },\n      modal: false,\n      index: 1,\n      rules: {\n        rule_name: [{ required: true, message: '请输入规格名称', trigger: 'blur' }],\n      },\n      formDynamic: {\n        rule_name: '',\n        spec: [],\n      },\n      attrsName: '',\n      attrsVal: '',\n      formDynamicNameData: [],\n      isBtn: false,\n      formDynamicName: [],\n      results: [],\n      result: [],\n      ids: 0,\n    };\n  },\n  computed: {},\n  methods: {\n    onCancel() {\n      this.ids = 0;\n      this.clear();\n    },\n    onClose() {\n      this.ids = 0;\n      this.clear();\n      this.modal = false;\n    },\n    // 添加按钮\n    addBtn() {\n      this.isBtn = true;\n    },\n    // 详情\n    getIofo(row) {\n      this.spinShow = true;\n      this.ids = row.id;\n      ruleInfoApi(row.id)\n        .then((res) => {\n          this.formDynamic = res.data.info;\n          this.spinShow = false;\n        })\n        .catch((res) => {\n          this.spinShow = false;\n          this.$message.error(res.msg);\n        });\n    },\n    // 提交\n    handleSubmit(name) {\n      this.$refs[name].validate((valid) => {\n        if (valid) {\n          if (this.formDynamic.spec.length === 0) {\n            return this.$message.warning('请至少添加一条商品规格！');\n          }\n          this.modal_loading = true;\n          setTimeout(() => {\n            ruleAddApi(this.formDynamic, this.ids)\n              .then((res) => {\n                this.$message.success(res.msg);\n                setTimeout(() => {\n                  this.modal = false;\n                  this.modal_loading = false;\n                }, 500);\n                setTimeout(() => {\n                  this.$emit('getList');\n                  this.clear();\n                }, 600);\n              })\n              .catch((res) => {\n                this.modal_loading = false;\n                this.$message.error(res.msg);\n              });\n          }, 1200);\n        } else {\n          return false;\n        }\n      });\n    },\n    clear() {\n      this.$refs['formDynamic'].resetFields();\n      this.formDynamic.spec = [];\n      this.isBtn = false;\n      this.attrsName = '';\n      this.attrsVal = '';\n      this.ids = 0;\n    },\n    // 取消\n    offAttrName() {\n      this.isBtn = false;\n    },\n    // 删除\n    handleRemove(index) {\n      this.formDynamic.spec.splice(index, 1);\n    },\n    // 删除属性\n    handleRemove2(item, index) {\n      item.splice(index, 1);\n    },\n    // 添加规则名称\n    createAttrName() {\n      if (this.attrsName && this.attrsVal) {\n        let data = {\n          value: this.attrsName,\n          detail: [this.attrsVal],\n        };\n        this.formDynamic.spec.push(data);\n        var hash = {};\n        this.formDynamic.spec = this.formDynamic.spec.reduce(function (item, next) {\n          /* eslint-disable */\n          hash[next.value] ? '' : (hash[next.value] = true && item.push(next));\n          return item;\n        }, []);\n        this.attrsName = '';\n        this.attrsVal = '';\n        this.isBtn = false;\n      } else {\n        this.$message.warning('请添加规格名称或规格值');\n      }\n    },\n    // 添加属性\n    createAttr(num, idx) {\n      if (num) {\n        this.formDynamic.spec[idx].detail.push(num);\n        var hash = {};\n        this.formDynamic.spec[idx].detail = this.formDynamic.spec[idx].detail.reduce(function (item, next) {\n          /* eslint-disable */\n          hash[next] ? '' : (hash[next] = true && item.push(next));\n          return item;\n        }, []);\n      } else {\n        this.$message.warning('请添加属性');\n      }\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"stylus\">\n.rulesBox {\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n}\n\n.attrFrom {\n  ::v-deep .ivu-form-item {\n    margin-bottom: 0px !important;\n  }\n}\n\n.add {\n  margin-left: 122px;\n}\n</style>\n"]}]}