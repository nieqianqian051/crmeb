{"remainingRequest":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/pages/kefu/components/PriceChange.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/pages/kefu/components/PriceChange.vue","mtime":1719467759000},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":1746465018509},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/babel-loader/lib/index.js","mtime":1746465024347},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":1746465018509},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js","mtime":1746465019530}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IHJlcXVpcmVkLCBudW0gfSBmcm9tICdAL3V0aWxzL3ZhbGlkYXRlJzsKaW1wb3J0IHsgdmFsaWRhdG9yRGVmYXVsdENhdGNoIH0gZnJvbSAnQC9saWJzL2RpYWxvZyc7CmltcG9ydCB7IG9yZGVyUmVtYXJrLCBlZGl0UHJpY2VBcGksIG9yZGVyUmVmdW5kQXBpIH0gZnJvbSAnQC9hcGkva2VmdSc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnUHJpY2VDaGFuZ2UnLAogIGNvbXBvbmVudHM6IHt9LAogIHByb3BzOiB7CiAgICBjaGFuZ2U6IEJvb2xlYW4sCiAgICBvcmRlckluZm86IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICBkZWZhdWx0OiBudWxsLAogICAgfSwKICAgIHN0YXR1czogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIGRlZmF1bHQ6IDAsCiAgICB9LAogIH0sCiAgZGF0YTogZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgZm9jdXM6IGZhbHNlLAogICAgICBwcmljZTogMCwKICAgICAgcmVmdW5kX3ByaWNlOiAwLAogICAgICByZW1hcms6ICcnLAogICAgfTsKICB9LAogIHdhdGNoOiB7CiAgICBvcmRlckluZm86IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5wcmljZSA9IHRoaXMub3JkZXJJbmZvLnBheV9wcmljZTsKICAgICAgdGhpcy5yZWZ1bmRfcHJpY2UgPSB0aGlzLm9yZGVySW5mby5wYXlfcHJpY2U7CiAgICAgIHRoaXMucmVtYXJrID0gdGhpcy5vcmRlckluZm8ucmVtYXJrOwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIHByaWNlQ2hhbmdlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuZm9jdXMgPSB0cnVlOwogICAgfSwKICAgIGNsb3NlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMucHJpY2UgPSB0aGlzLm9yZGVySW5mby5wYXlfcHJpY2U7CiAgICAgIHRoaXMuJGVtaXQoJ2Nsb3NlQ2hhbmdlJywgZmFsc2UpOwogICAgfSwKICAgIHNhdmUoKSB7CiAgICAgIHRoaXMuc2F2ZVByaWNlKHsKICAgICAgICBwcmljZTogdGhpcy5wcmljZSwKICAgICAgICByZWZ1bmRfcHJpY2U6IHRoaXMucmVmdW5kX3ByaWNlLAogICAgICAgIHR5cGU6IDEsCiAgICAgICAgcmVtYXJrOiB0aGlzLnJlbWFyaywKICAgICAgICBpZDogdGhpcy5vcmRlckluZm8uaWQsCiAgICAgICAgb3JkZXJfaWQ6IHRoaXMub3JkZXJJbmZvLm9yZGVyX2lkLAogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBzYXZlUHJpY2Uob3B0KSB7CiAgICAgIGxldCB0aGF0ID0gdGhpcywKICAgICAgICBkYXRhID0ge30sCiAgICAgICAgcHJpY2UgPSBvcHQucHJpY2UsCiAgICAgICAgcmVmdW5kX3ByaWNlID0gb3B0LnJlZnVuZF9wcmljZSwKICAgICAgICByZWZ1bmRfc3RhdHVzID0gdGhhdC5vcmRlckluZm8ucmVmdW5kX3N0YXR1cywKICAgICAgICByZW1hcmsgPSBvcHQucmVtYXJrOwogICAgICBpZiAodGhhdC5zdGF0dXMgPT0gMCAmJiByZWZ1bmRfc3RhdHVzID09PSAwKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGF3YWl0IHRoaXMuJHZhbGlkYXRvcih7CiAgICAgICAgICAgIHByaWNlOiBbcmVxdWlyZWQocmVxdWlyZWQubWVzc2FnZSgn6YeR6aKdJykpLCBudW0obnVtLm1lc3NhZ2UoJ+mHkeminScpKV0sCiAgICAgICAgICB9KS52YWxpZGF0ZSh7IHByaWNlIH0pOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiB2YWxpZGF0b3JEZWZhdWx0Q2F0Y2goZSk7CiAgICAgICAgfQogICAgICAgIGRhdGEudG90YWxfcHJpY2UgPSB0aGlzLm9yZGVySW5mby50b3RhbF9wcmljZTsKICAgICAgICBkYXRhLnRvdGFsX3Bvc3RhZ2UgPSB0aGlzLm9yZGVySW5mby50b3RhbF9wcmljZTsKICAgICAgICBkYXRhLnBheV9wb3N0YWdlID0gdGhpcy5vcmRlckluZm8ucGF5X3Bvc3RhZ2U7CiAgICAgICAgZGF0YS5nYWluX2ludGVncmFsID0gdGhpcy5vcmRlckluZm8uZ2Fpbl9pbnRlZ3JhbDsKICAgICAgICBkYXRhLnBheV9wcmljZSA9IG9wdC5wcmljZTsKICAgICAgICBkYXRhLm9yZGVyX2lkID0gb3B0Lm9yZGVyX2lkOwogICAgICAgIGVkaXRQcmljZUFwaShvcHQuaWQsIGRhdGEpCiAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2Nsb3NlY2hhbmdlJywgZmFsc2UpOwogICAgICAgICAgICB0aGF0LiRkaWFsb2cuc3VjY2Vzcygn5pS55Lu35oiQ5YqfJyk7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgICB0aGF0LiRkaWFsb2cuZXJyb3IoZXJyb3IubXNnKTsKICAgICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKHRoYXQuc3RhdHVzID09IDAgJiYgcmVmdW5kX3N0YXR1cyA9PT0gMSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBhd2FpdCB0aGlzLiR2YWxpZGF0b3IoewogICAgICAgICAgICByZWZ1bmRfcHJpY2U6IFtyZXF1aXJlZChyZXF1aXJlZC5tZXNzYWdlKCfph5Hpop0nKSksIG51bShudW0ubWVzc2FnZSgn6YeR6aKdJykpXSwKICAgICAgICAgIH0pLnZhbGlkYXRlKHsgcmVmdW5kX3ByaWNlIH0pOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiB2YWxpZGF0b3JEZWZhdWx0Q2F0Y2goZSk7CiAgICAgICAgfQogICAgICAgIGRhdGEucHJpY2UgPSBvcHQucmVmdW5kX3ByaWNlOwogICAgICAgIGRhdGEudHlwZSA9IG9wdC50eXBlOwogICAgICAgIGRhdGEub3JkZXJfaWQgPSBvcHQub3JkZXJfaWQ7CiAgICAgICAgb3JkZXJSZWZ1bmRBcGkoZGF0YSkudGhlbigKICAgICAgICAgIChyZXMpID0+IHsKICAgICAgICAgICAgdGhpcy4kZW1pdCgnY2xvc2VjaGFuZ2UnLCBmYWxzZSk7CiAgICAgICAgICAgIHRoYXQuJGRpYWxvZy5zdWNjZXNzKCfmk43kvZzmiJDlip8nKTsKICAgICAgICAgIH0sCiAgICAgICAgICAoZXJyKSA9PiB7CiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2Nsb3NlY2hhbmdlJywgZmFsc2UpOwogICAgICAgICAgICB0aGF0LiRkaWFsb2cuZXJyb3IoZXJyLm1zZyk7CiAgICAgICAgICB9LAogICAgICAgICk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGF3YWl0IHRoaXMuJHZhbGlkYXRvcih7CiAgICAgICAgICAgIHJlbWFyazogW3JlcXVpcmVkKHJlcXVpcmVkLm1lc3NhZ2UoJ+Wkh+azqCcpKV0sCiAgICAgICAgICB9KS52YWxpZGF0ZSh7IHJlbWFyayB9KTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZXR1cm4gdmFsaWRhdG9yRGVmYXVsdENhdGNoKGUpOwogICAgICAgIH0KICAgICAgICBkYXRhLnJlbWFyayA9IHJlbWFyazsKICAgICAgICBkYXRhLm9yZGVyX2lkID0gb3B0Lm9yZGVyX2lkOwogICAgICAgIG9yZGVyUmVtYXJrKGRhdGEpLnRoZW4oCiAgICAgICAgICAocmVzKSA9PiB7CiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2Nsb3NlY2hhbmdlJywgZmFsc2UpOwogICAgICAgICAgICB0aGF0LiRkaWFsb2cuc3VjY2Vzcygn5o+Q5Lqk5oiQ5YqfJyk7CiAgICAgICAgICB9LAogICAgICAgICAgKGVycikgPT4gewogICAgICAgICAgICB0aGlzLiRlbWl0KCdjbG9zZWNoYW5nZScsIGZhbHNlKTsKICAgICAgICAgICAgdGhhdC4kZGlhbG9nLmVycm9yKGVyci5tc2cpOwogICAgICAgICAgfSwKICAgICAgICApOwogICAgICB9CiAgICB9LAogICAgcmVmdXNlKCkgewogICAgICB0aGlzLnNhdmVQcmljZSh7CiAgICAgICAgcHJpY2U6IHRoaXMucHJpY2UsCiAgICAgICAgcmVmdW5kX3ByaWNlOiB0aGlzLnJlZnVuZF9wcmljZSwKICAgICAgICB0eXBlOiAyLAogICAgICAgIHJlbWFyazogdGhpcy5yZW1hcmssCiAgICAgICAgaWQ6IHRoaXMub3JkZXJJbmZvLmlkLAogICAgICAgIG9yZGVyX2lkOiB0aGlzLm9yZGVySW5mby5vcmRlcl9pZCwKICAgICAgfSk7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["PriceChange.vue"],"names":[],"mappings":";AAiDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PriceChange.vue","sourceRoot":"src/pages/kefu/components","sourcesContent":["<template>\n  <div>\n    <div class=\"priceChange\" :class=\"change === true ? 'on' : ''\">\n      <div class=\"priceTitle\">\n        {{ status === 0 ? (orderInfo.refund_status === 1 ? '立即退款' : '一键改价') : '订单备注' }}\n        <span class=\"iconfontYI icon-guanbi\" @click=\"close\"></span>\n      </div>\n      <div class=\"listChange\" v-if=\"status === 0\">\n        <div class=\"item acea-row row-between-wrapper\" v-if=\"orderInfo.refund_status === 0\">\n          <div>商品总价(¥)</div>\n          <div class=\"money\">{{ orderInfo.total_price }}<span class=\"iconfontYI icon-suozi\"></span></div>\n        </div>\n        <div class=\"item acea-row row-between-wrapper\" v-if=\"orderInfo.refund_status === 0\">\n          <div>原始邮费(¥)</div>\n          <div class=\"money\">{{ orderInfo.pay_postage }}<span class=\"iconfontYI icon-suozi\"></span></div>\n        </div>\n        <div class=\"item acea-row row-between-wrapper\" v-if=\"orderInfo.refund_status === 0\">\n          <div>实际支付(¥)</div>\n          <div class=\"money\">\n            <input type=\"text\" v-model=\"price\" :class=\"focus === true ? 'on' : ''\" @focus=\"priceChange\" />\n          </div>\n        </div>\n        <div class=\"item acea-row row-between-wrapper\" v-if=\"orderInfo.refund_status === 1\">\n          <div>实际支付(¥)</div>\n          <div class=\"money\">{{ orderInfo.pay_price }}<span class=\"iconfontYI icon-suozi\"></span></div>\n        </div>\n        <div class=\"item acea-row row-between-wrapper\" v-if=\"orderInfo.refund_status === 1\">\n          <div>退款金额(¥)</div>\n          <div class=\"money\">\n            <input type=\"text\" v-model=\"refund_price\" :class=\"focus === true ? 'on' : ''\" @focus=\"priceChange\" />\n          </div>\n        </div>\n      </div>\n      <div class=\"listChange\" v-else>\n        <textarea\n          :placeholder=\"orderInfo.remark ? orderInfo.remark : '请填写备注信息...'\"\n          v-model=\"remark\"\n          maxlength=\"100\"\n        ></textarea>\n      </div>\n      <div class=\"modify\" @click=\"save\">\n        {{ orderInfo.refund_status === 0 || status === 1 ? '立即修改' : '确认退款' }}\n      </div>\n      <div class=\"modify1\" @click=\"refuse\" v-if=\"orderInfo.refund_status === 1 && status === 0\">拒绝退款</div>\n    </div>\n    <div class=\"maskModel\" @touchmove.prevent v-show=\"change === true\"></div>\n  </div>\n</template>\n<script>\nimport { required, num } from '@/utils/validate';\nimport { validatorDefaultCatch } from '@/libs/dialog';\nimport { orderRemark, editPriceApi, orderRefundApi } from '@/api/kefu';\nexport default {\n  name: 'PriceChange',\n  components: {},\n  props: {\n    change: Boolean,\n    orderInfo: {\n      type: Object,\n      default: null,\n    },\n    status: {\n      type: Number,\n      default: 0,\n    },\n  },\n  data: function () {\n    return {\n      focus: false,\n      price: 0,\n      refund_price: 0,\n      remark: '',\n    };\n  },\n  watch: {\n    orderInfo: function () {\n      this.price = this.orderInfo.pay_price;\n      this.refund_price = this.orderInfo.pay_price;\n      this.remark = this.orderInfo.remark;\n    },\n  },\n  methods: {\n    priceChange: function () {\n      this.focus = true;\n    },\n    close: function () {\n      this.price = this.orderInfo.pay_price;\n      this.$emit('closeChange', false);\n    },\n    save() {\n      this.savePrice({\n        price: this.price,\n        refund_price: this.refund_price,\n        type: 1,\n        remark: this.remark,\n        id: this.orderInfo.id,\n        order_id: this.orderInfo.order_id,\n      });\n    },\n    async savePrice(opt) {\n      let that = this,\n        data = {},\n        price = opt.price,\n        refund_price = opt.refund_price,\n        refund_status = that.orderInfo.refund_status,\n        remark = opt.remark;\n      if (that.status == 0 && refund_status === 0) {\n        try {\n          await this.$validator({\n            price: [required(required.message('金额')), num(num.message('金额'))],\n          }).validate({ price });\n        } catch (e) {\n          return validatorDefaultCatch(e);\n        }\n        data.total_price = this.orderInfo.total_price;\n        data.total_postage = this.orderInfo.total_price;\n        data.pay_postage = this.orderInfo.pay_postage;\n        data.gain_integral = this.orderInfo.gain_integral;\n        data.pay_price = opt.price;\n        data.order_id = opt.order_id;\n        editPriceApi(opt.id, data)\n          .then(() => {\n            this.$emit('closechange', false);\n            that.$dialog.success('改价成功');\n          })\n          .catch((error) => {\n            that.$dialog.error(error.msg);\n          });\n      } else if (that.status == 0 && refund_status === 1) {\n        try {\n          await this.$validator({\n            refund_price: [required(required.message('金额')), num(num.message('金额'))],\n          }).validate({ refund_price });\n        } catch (e) {\n          return validatorDefaultCatch(e);\n        }\n        data.price = opt.refund_price;\n        data.type = opt.type;\n        data.order_id = opt.order_id;\n        orderRefundApi(data).then(\n          (res) => {\n            this.$emit('closechange', false);\n            that.$dialog.success('操作成功');\n          },\n          (err) => {\n            this.$emit('closechange', false);\n            that.$dialog.error(err.msg);\n          },\n        );\n      } else {\n        try {\n          await this.$validator({\n            remark: [required(required.message('备注'))],\n          }).validate({ remark });\n        } catch (e) {\n          return validatorDefaultCatch(e);\n        }\n        data.remark = remark;\n        data.order_id = opt.order_id;\n        orderRemark(data).then(\n          (res) => {\n            this.$emit('closechange', false);\n            that.$dialog.success('提交成功');\n          },\n          (err) => {\n            this.$emit('closechange', false);\n            that.$dialog.error(err.msg);\n          },\n        );\n      }\n    },\n    refuse() {\n      this.savePrice({\n        price: this.price,\n        refund_price: this.refund_price,\n        type: 2,\n        remark: this.remark,\n        id: this.orderInfo.id,\n        order_id: this.orderInfo.order_id,\n      });\n    },\n  },\n};\n</script>\n<style scoped>\ninput {\n  display: block;\n  height: 100%;\n  background: none;\n  color: inherit;\n  opacity: 1;\n  -webkit-text-fill-color: currentcolor;\n  font: inherit;\n  line-height: inherit;\n  letter-spacing: inherit;\n  text-align: inherit;\n  text-indent: inherit;\n  text-transform: inherit;\n  text-shadow: inherit;\n  border: none;\n}\n/*@import '../../../styles/reset.css';*/\n.priceChange {\n  position: fixed;\n  width: 5.8rem;\n  height: 6.7rem;\n  background-color: #fff;\n  border-radius: 0.1rem;\n  top: 50%;\n  left: 50%;\n  margin-left: -2.9rem;\n  margin-top: -3.35rem;\n  z-index: 99;\n  transition: all 0.3s ease-in-out 0s;\n  -webkit-transition: all 0.3s ease-in-out 0s;\n  -o-transition: all 0.3s ease-in-out 0s;\n  -moz-transition: all 0.3s ease-in-out 0s;\n  -webkit-transform: scale(0);\n  -o-transform: scale(0);\n  -moz-transform: scale(0);\n  -ms-transform: scale(0);\n  transform: scale(0);\n  opacity: 0;\n}\n.priceChange.on {\n  opacity: 1;\n  transform: scale(1);\n  -webkit-transform: scale(1);\n  -o-transform: scale(1);\n  -moz-transform: scale(1);\n  -ms-transform: scale(1);\n}\n.priceChange .priceTitle {\n  background: url('../../../assets/images/pricetitle.jpg') no-repeat;\n  background-size: 100% 100%;\n  width: 100%;\n  height: 1.6rem;\n  border-radius: 0.1rem 0.1rem 0 0;\n  text-align: center;\n  font-size: 0.4rem;\n  color: #fff;\n  line-height: 1.6rem;\n  position: relative;\n}\n.priceChange .priceTitle .iconfontYI {\n  position: absolute;\n  font-size: 0.4rem;\n  right: 0.26rem;\n  top: 0.23rem;\n  width: 0.4rem;\n  height: 0.4rem;\n  line-height: 0.4rem;\n}\n.priceChange .listChange {\n  padding: 0 0.4rem;\n}\n.priceChange .listChange .item {\n  height: 1.03rem;\n  border-bottom: 1px solid #e3e3e3;\n  font-size: 0.32rem;\n  color: #333;\n}\n.priceChange .listChange .item .money {\n  color: #666;\n  width: 3rem;\n  text-align: right;\n}\n.priceChange .listChange .item .money .iconfontYI {\n  font-size: 0.32rem;\n  margin-left: 0.2rem;\n}\n.priceChange .listChange .item .money input {\n  width: 100%;\n  height: 100%;\n  text-align: right;\n  color: #ccc;\n  border: none;\n}\n.priceChange .listChange .item .money input.on {\n  color: #666;\n}\n.priceChange .modify {\n  font-size: 0.32rem;\n  color: #fff;\n  width: 4.9rem;\n  height: 0.9rem;\n  text-align: center;\n  line-height: 0.9rem;\n  border-radius: 0.45rem;\n  background-color: #2291f8;\n  margin: 0.53rem auto 0 auto;\n}\n.priceChange .modify1 {\n  font-size: 0.32rem;\n  color: #312b2b;\n  width: 4.9rem;\n  height: 0.9rem;\n  text-align: center;\n  line-height: 0.9rem;\n  border-radius: 0.45rem;\n  background-color: #eee;\n  margin: 0.3rem auto 0 auto;\n}\n.priceChange .listChange textarea {\n  border: 1px solid #eee;\n  width: 100%;\n  height: 2rem;\n  margin-top: 0.5rem;\n  border-radius: 0.1rem;\n  color: #333;\n  padding: 0.2rem;\n  font-size: 0.3rem;\n}\n</style>\n"]}]}