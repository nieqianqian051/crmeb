{"remainingRequest":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/pages/kefu/pc/components/chatList.vue?vue&type=style&index=0&id=40859aa5&lang=stylus&scoped=true","dependencies":[{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/pages/kefu/pc/components/chatList.vue","mtime":1719467759000},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/css-loader/index.js","mtime":1746465018503},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1746465020031},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/postcss-loader/src/index.js","mtime":1746465019371},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/stylus-loader/index.js","mtime":1746465207601},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":1746465018509},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js","mtime":1746465019530}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5jaGF0TGlzdAogICAgZGlzcGxheSBmbGV4CiAgICBmbGV4LWRpcmVjdGlvbiBjb2x1bW4KICAgIHdpZHRoIDMyMHB4CiAgICBoZWlnaHQgNzQycHgKICAgIGJvcmRlci1yaWdodCAxcHggc29saWQgI0VDRUNFQwogICAgLnRhYi1oZWFkCiAgICAgICAgZGlzcGxheSBmbGV4CiAgICAgICAgYWxpZ24taXRlbXMgY2VudGVyCiAgICAgICAganVzdGlmeS1jb250ZW50IHNwYWNlLWJldHdlZW4KICAgICAgICBoZWlnaHQgNTBweAogICAgICAgIGZsZXgtc2hyaW5rIDAKICAgICAgICBwYWRkaW5nIDAgNTJweAogICAgICAgIGZvbnQtc2l6ZSAxNHB4CiAgICAgICAgY29sb3IgIzAwMDAwMAogICAgICAgIC5pdGVtCiAgICAgICAgICAgIHBvc2l0aW9uIHJlbGF0aXZlCiAgICAgICAgICAgIGN1cnNvciBwb2ludGVyCiAgICAgICAgICAgICY6YWZ0ZXIKICAgICAgICAgICAgICAgIGRpc3BsYXkgbm9uZQogICAgICAgICAgICAgICAgY29udGVudCAnICcKICAgICAgICAgICAgICAgIHBvc2l0aW9uIGFic29sdXRlCiAgICAgICAgICAgICAgICBsZWZ0IDUwJQogICAgICAgICAgICAgICAgYm90dG9tIC0xNXB4CiAgICAgICAgICAgICAgICB0cmFuc2Zvcm0gdHJhbnNsYXRlWCgtNTAlKQogICAgICAgICAgICAgICAgaGVpZ2h0IDJweAogICAgICAgICAgICAgICAgd2lkdGggMTAwJQogICAgICAgICAgICAgICAgYmFja2dyb3VuZCB2YXIoLS1wcmV2LWNvbG9yLXByaW1hcnkpCiAgICAgICAgICAgICYuYWN0aXZlCiAgICAgICAgICAgICAgICBjb2xvciB2YXIoLS1wcmV2LWNvbG9yLXByaW1hcnkpCiAgICAgICAgICAgICAgICAmOmFmdGVyCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheSBibG9jawoKICAgIC5zY3JvbGwtYm94CiAgICAgICAgZmxleCAxCiAgICAgICAgaGVpZ2h0IDUwMHB4CiAgICAgICAgb3ZlcmZsb3cgaGlkZGVuCiAgICAuY2hhdC1pdGVtCiAgICAgICAgZGlzcGxheSBmbGV4CiAgICAgICAgYWxpZ24taXRlbXMgY2VudGVyCiAgICAgICAganVzdGlmeS1jb250ZW50IHNwYWNlLWJldHdlZW4KICAgICAgICBwYWRkaW5nIDEycHggMTBweAogICAgICAgIGhlaWdodCA3NHB4CiAgICAgICAgYm94LXNpemluZyBib3JkZXItYm94CiAgICAgICAgYm9yZGVyLWxlZnQgM3B4IHNvbGlkIHRyYW5zcGFyZW50CiAgICAgICAgY3Vyc29yIHBvaW50ZXIKICAgICAgICAmLmFjdGl2ZQogICAgICAgICAgICBiYWNrZ3JvdW5kICNFRkYwRjEKICAgICAgICAgICAgYm9yZGVyLWxlZnQgM3B4IHNvbGlkIHZhcigtLXByZXYtY29sb3ItcHJpbWFyeSkKICAgICAgICAuYXZhdGFyCiAgICAgICAgICAgIHBvc2l0aW9uIHJlbGF0aXZlCiAgICAgICAgICAgIHdpZHRoIDQwcHgKICAgICAgICAgICAgaGVpZ2h0IDQwcHgKICAgICAgICAgICAgaW1nCiAgICAgICAgICAgICAgICBkaXNwbGF5IGJsb2NrCiAgICAgICAgICAgICAgICB3aWR0aCAxMDAlCiAgICAgICAgICAgICAgICBoZWlnaHQgMTAwJQogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1cyA1MCUKICAgICAgICAgICAgLnN0YXR1cwogICAgICAgICAgICAgICAgcG9zaXRpb24gYWJzb2x1dGUKICAgICAgICAgICAgICAgIHJpZ2h0IDNweAogICAgICAgICAgICAgICAgYm90dG9tIDAKICAgICAgICAgICAgICAgIHdpZHRoIDhweAogICAgICAgICAgICAgICAgaGVpZ2h0IDhweAogICAgICAgICAgICAgICAgYmFja2dyb3VuZCAjNDhENDUyCiAgICAgICAgICAgICAgICBib3JkZXIgMXB4IHNvbGlkICNmZmYKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXMgNTAlCiAgICAgICAgICAgICAgICAmLm9mZgogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQgIzk5OTk5OQogICAgICAgIC51c2VyLWluZm8KICAgICAgICAgICAgd2lkdGggMTU1cHgKICAgICAgICAgICAgbWFyZ2luLWxlZnQgMTJweAogICAgICAgICAgICBtYXJnaW4tdG9wOiA1cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZSAxNnB4CiAgICAgICAgICAgIC5oZAogICAgICAgICAgICAgICAgZGlzcGxheSBmbGV4CiAgICAgICAgICAgICAgICBhbGlnbi1pdGVtcyBjZW50ZXIKICAgICAgICAgICAgICAgIGNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNjUpOwogICAgICAgICAgICAgICAgLm5hbWUKICAgICAgICAgICAgICAgICAgICBtYXgtd2lkdGggNjclCiAgICAgICAgICAgICAgICAubGFiZWwKICAgICAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdCA1cHgKICAgICAgICAgICAgICAgICAgICBjb2xvciAjMzg3NUVBCiAgICAgICAgICAgICAgICAgICAgZm9udC1zaXplIDEycHgKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kICNEOEU1RkYKICAgICAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzIDJweAogICAgICAgICAgICAgICAgICAgIHBhZGRpbmcgMXB4IDVweAogICAgICAgICAgICAgICAgICAgICYuSDUKICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZCAjRkFGMUQwCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yICNEQzlBMDQKICAgICAgICAgICAgICAgICAgICAmLndlY2hhdAogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDY0LCAxOTQsIDczLCAwLjE2KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgIzQwQzI0OQogICAgICAgICAgICAgICAgICAgICYucGMKICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgxMDAsIDY0LCAxOTQsIDAuMTYpOzsKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgIzY0NDBDMgogICAgICAgICAgICAuYmQKICAgICAgICAgICAgICAgIG1hcmdpbi10b3AgM3B4CiAgICAgICAgICAgICAgICBmb250LXNpemUgMTJweAogICAgICAgICAgICAgICAgY29sb3IgIzhFOTU5RQogICAgICAgIC5yaWdodC1ib3gKICAgICAgICAgICAgcG9zaXRpb24gcmVsYXRpdmUKICAgICAgICAgICAgZmxleCAxCiAgICAgICAgICAgIGRpc3BsYXkgZmxleAogICAgICAgICAgICBmbGV4LWRpcmVjdGlvbiBjb2x1bW4KICAgICAgICAgICAgYWxpZ24taXRlbXMgZmxleC1lbmQKICAgICAgICAgICAgY29sb3IgIzhFOTU5RQogICAgICAgICAgICAubnVtCiAgICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQgMTJweAouY2hhcnQtc2Nyb2xsCiAgICBtYXJnaW4tdG9wIC0xMHB4Cg=="},{"version":3,"sources":["chatList.vue"],"names":[],"mappings":";AAsSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"chatList.vue","sourceRoot":"src/pages/kefu/pc/components","sourcesContent":["<template>\n  <div class=\"chatList\">\n    <div class=\"tab-head\">\n      <div\n        class=\"item\"\n        :class=\"{ active: item.key == hdTabCur }\"\n        v-for=\"(item, index) in hdTab\"\n        :key=\"index\"\n        @click=\"changeTab(item)\"\n      >\n        {{ item.title }}\n      </div>\n    </div>\n    <div class=\"scroll-box\">\n      <vue-scroll :ops=\"ops\" @handle-scroll=\"handleScroll\" v-if=\"userList.length > 0\">\n        <div\n          class=\"chat-item\"\n          v-for=\"(item, index) in userList\"\n          :key=\"index\"\n          :class=\"{ active: curId == item.id }\"\n          @click=\"selectUser(item)\"\n        >\n          <div class=\"avatar\">\n            <img v-lazy=\"item.wx_avatar\" alt=\"\" />\n            <div class=\"status\" :class=\"{ off: item.online == 0 }\"></div>\n          </div>\n          <div class=\"user-info\">\n            <div class=\"hd\">\n              <span class=\"name line1\">{{ item.nickname }}</span>\n              <template v-if=\"item.type == 2\">\n                <span class=\"label\">小程序</span>\n              </template>\n              <template v-if=\"item.type == 3\">\n                <span class=\"label H5\">H5</span>\n              </template>\n              <template v-if=\"item.type == 1\">\n                <span class=\"label wechat\">公众号</span>\n              </template>\n              <template v-if=\"item.type == 0\">\n                <span class=\"label pc\">PC端</span>\n              </template>\n            </div>\n            <div class=\"bd line1\">\n              <template v-if=\"item.message_type <= 2\">{{ item.message }}</template>\n              <template v-if=\"item.message_type == 3\">[图片]</template>\n              <template v-if=\"item.message_type == 5\">[商品]</template>\n              <template v-if=\"item.message_type == 6\">[订单]</template>\n            </div>\n          </div>\n          <div class=\"right-box\">\n            <div class=\"time\">{{ item.update_time | toDay }}</div>\n            <div class=\"num\" v-if=\"item.mssage_num > 0\">\n              <el-badge :value=\"item.mssage_num\">\n                <a href=\"#\" class=\"demo-badge\"></a>\n              </el-badge>\n            </div>\n          </div>\n        </div>\n      </vue-scroll>\n      <empty v-else msg=\"暂无用户列表\" status=\"1\"></empty>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { Socket } from '@/libs/socket';\nimport dayjs from 'dayjs';\nimport { record } from '@/api/kefu';\nimport { HappyScroll } from 'vue-happy-scroll';\nimport empty from '../../components/empty';\nimport { forEach } from '../../../../libs/tools';\nexport default {\n  name: 'chatList',\n  props: {\n    userOnline: {\n      type: Object,\n      default: function () {\n        return {};\n      },\n    },\n    newRecored: {\n      type: Object,\n      default: function () {\n        return {};\n      },\n    },\n    searchData: {\n      type: String,\n      default: '',\n    },\n  },\n  components: {\n    HappyScroll,\n    empty,\n  },\n  watch: {\n    userOnline: {\n      handler(nVal, oVal) {\n        if (nVal.hasOwnProperty('to_uid')) {\n          this.userList.forEach((el, index) => {\n            if (el.to_uid == nVal.to_uid) {\n              el.online = nVal.online;\n              if (nVal.online == 1) {\n                this.$notify.info({\n                  title: '上线通知',\n                  message: `${el.nickname}上线`,\n                });\n              }\n            }\n          });\n        }\n      },\n      deep: true,\n    },\n    searchData: {\n      handler(nVal, oVal) {\n        if (nVal != oVal) {\n          this.nickname = nVal;\n          this.page = 1;\n          this.isScroll = true;\n          this.userList = [];\n          this.getList();\n        }\n      },\n      deep: true,\n    },\n  },\n  data() {\n    return {\n      hdTabCur: 0,\n      hdTab: [\n        {\n          key: 0,\n          title: '用户列表',\n        },\n        {\n          key: 1,\n          title: '游客列表',\n        },\n      ],\n      userList: [],\n      curId: '',\n      page: 1,\n      limit: 15,\n      isScroll: true,\n      nickname: '',\n      isSearch: false,\n      ops: {\n        vuescroll: {\n          mode: 'native',\n          enable: false,\n          tips: {\n            deactive: 'Push to Load',\n            active: 'Release to Load',\n            start: 'Loading...',\n            beforeDeactive: 'Load Successfully!',\n          },\n          auto: false,\n          autoLoadDistance: 0,\n          pullRefresh: {\n            enable: false,\n          },\n          pushLoad: {\n            enable: true,\n            auto: true,\n            autoLoadDistance: 10,\n          },\n        },\n        bar: {\n          background: '#393232',\n          opacity: '.5',\n          size: '5px',\n        },\n      },\n    };\n  },\n  filters: {\n    toDay: function (value) {\n      if (!value) return '';\n      return dayjs.unix(value).format('M月D日 HH:mm');\n    },\n  },\n  mounted() {\n    let that = this;\n    Socket.then((ws) => {\n      //用户转接\n      ws.$on('transfer', (data) => {\n        let status = false;\n        that.userList.forEach((el, index, arr) => {\n          if (data.recored.id == el.id) {\n            status = true;\n            if (data.recored.is_tourist == that.hdTabCur) {\n              let oldVal = data.recored;\n              arr.splice(index, 1);\n\n              if (index == 0) {\n                this.$emit('setDataId', oldVal);\n                oldVal.mssage_num = 0;\n              }\n              arr.unshift(oldVal);\n            }\n            this.$notify.info({\n              title: '您有一条转接消息！',\n            });\n          }\n        });\n        if (!status) {\n          if (data.recored.is_tourist == this.hdTabCur) this.userList.unshift(data.recored);\n        }\n      });\n      ws.$on('mssage_num', (data) => {\n        if (data.recored.id) {\n          let status = false;\n          that.userList.forEach((el, index, arr) => {\n            if (data.recored.id == el.id) {\n              status = true;\n              if (data.recored.is_tourist == that.hdTabCur) {\n                let oldVal = data.recored;\n                arr.splice(index, 1);\n                arr.unshift(oldVal);\n              }\n            }\n          });\n          if (!status) {\n            if (data.recored.is_tourist == this.hdTabCur) this.userList.unshift(data.recored);\n          }\n        }\n        if (data.recored.is_tourist != this.hdTabCur && data.recored.id) {\n          this.$notify.info({\n            title: this.hdTabCur ? '用户发来消息啦！' : '游客发来消息啦！',\n          });\n        }\n      });\n    });\n    this.bus.$on('change', (data) => {\n      this.nickname = data;\n    });\n    this.getList();\n  },\n  methods: {\n    //切换\n    changeTab(item) {\n      if (this.hdTabCur == item.key) return;\n      this.hdTabCur = item.key;\n      this.isScroll = true;\n      this.page = 1;\n      this.userList = [];\n      this.$emit('changeType', item.key);\n      this.getList();\n    },\n    getList() {\n      if (!this.isScroll) return;\n      record({\n        nickname: this.nickname,\n        page: this.page,\n        limit: this.limit,\n        is_tourist: this.hdTabCur,\n      }).then((res) => {\n        if (res.data.length > 0) {\n          res.data[0].mssage_num = 0;\n          this.isScroll = res.data.length >= this.limit;\n\n          this.userList = this.userList.concat(res.data);\n\n          if (this.page == 1 && res.data.length > 0 && !this.isSearch) {\n            this.curId = res.data[0].id;\n            this.$emit('setDataId', res.data[0]);\n          }\n          this.page++;\n        } else {\n          this.$emit('setDataId', 0);\n        }\n      });\n    },\n    chartReachBottom() {\n      this.getList();\n    },\n    // 选择用户\n    selectUser(item) {\n      if (this.curId == item.id) return;\n      item.mssage_num = 0;\n      this.curId = item.id;\n      this.$emit('setDataId', item);\n    },\n    handleScroll(vertical, horizontal, nativeEvent) {\n      if (vertical.process == 1) {\n        this.getList();\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"stylus\" scoped>\n.chatList\n    display flex\n    flex-direction column\n    width 320px\n    height 742px\n    border-right 1px solid #ECECEC\n    .tab-head\n        display flex\n        align-items center\n        justify-content space-between\n        height 50px\n        flex-shrink 0\n        padding 0 52px\n        font-size 14px\n        color #000000\n        .item\n            position relative\n            cursor pointer\n            &:after\n                display none\n                content ' '\n                position absolute\n                left 50%\n                bottom -15px\n                transform translateX(-50%)\n                height 2px\n                width 100%\n                background var(--prev-color-primary)\n            &.active\n                color var(--prev-color-primary)\n                &:after\n                    display block\n\n    .scroll-box\n        flex 1\n        height 500px\n        overflow hidden\n    .chat-item\n        display flex\n        align-items center\n        justify-content space-between\n        padding 12px 10px\n        height 74px\n        box-sizing border-box\n        border-left 3px solid transparent\n        cursor pointer\n        &.active\n            background #EFF0F1\n            border-left 3px solid var(--prev-color-primary)\n        .avatar\n            position relative\n            width 40px\n            height 40px\n            img\n                display block\n                width 100%\n                height 100%\n                border-radius 50%\n            .status\n                position absolute\n                right 3px\n                bottom 0\n                width 8px\n                height 8px\n                background #48D452\n                border 1px solid #fff\n                border-radius 50%\n                &.off\n                    background #999999\n        .user-info\n            width 155px\n            margin-left 12px\n            margin-top: 5px;\n            font-size 16px\n            .hd\n                display flex\n                align-items center\n                color: rgba(0, 0, 0, 0.65);\n                .name\n                    max-width 67%\n                .label\n                    margin-left 5px\n                    color #3875EA\n                    font-size 12px\n                    background #D8E5FF\n                    border-radius 2px\n                    padding 1px 5px\n                    &.H5\n                        background #FAF1D0\n                        color #DC9A04\n                    &.wechat\n                        background: rgba(64, 194, 73, 0.16);\n                        color #40C249\n                    &.pc\n                        background: rgba(100, 64, 194, 0.16);;\n                        color #6440C2\n            .bd\n                margin-top 3px\n                font-size 12px\n                color #8E959E\n        .right-box\n            position relative\n            flex 1\n            display flex\n            flex-direction column\n            align-items flex-end\n            color #8E959E\n            .num\n                margin-right 12px\n.chart-scroll\n    margin-top -10px\n</style>\n"]}]}