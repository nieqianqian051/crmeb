{"remainingRequest":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/components/uploadVideo/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/src/components/uploadVideo/index.vue","mtime":1719467759000},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":1746465018509},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/babel-loader/lib/index.js","mtime":1746465024347},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/cache-loader/dist/cjs.js","mtime":1746465018509},{"path":"/Users/nieqianqian/Downloads/xinxiangmu/CRMEB/template/admin/node_modules/vue-loader/lib/index.js","mtime":1746465019530}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IHVwbG9hZEJ5UGllY2VzIH0gZnJvbSAnQC91dGlscy91cGxvYWQnOyAvL+W8leWFpXVwbG9hZEJ5UGllY2Vz5pa55rOVCmltcG9ydCB7IHByb2R1Y3RHZXRUZW1wS2V5c0FwaSwgdXBsb2FkVHlwZSB9IGZyb20gJ0AvYXBpL3Byb2R1Y3QnOwppbXBvcnQgU2V0dGluZyBmcm9tICdAL3NldHRpbmcnOwppbXBvcnQgeyBnZXRDb29raWVzIH0gZnJvbSAnQC9saWJzL3V0aWwnOwppbXBvcnQgeyBpc1ZpZGVvVXBsb2FkIH0gZnJvbSAnQC91dGlscyc7CgovLyBpbXBvcnQgJy4uLy4uLy4uL3B1YmxpYy9VRWRpdG9yL2RpYWxvZ3MvaW50ZXJuYWwnOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ3ZpZGUxMW8nLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBmaWxlVXJsOiBTZXR0aW5nLmFwaUJhc2VVUkwgKyAnL2ZpbGUvdXBsb2FkJywKICAgICAgdXBsb2FkOiB7CiAgICAgICAgdmlkZW9Jbmc6IGZhbHNlLCAvLyDmmK/lkKbmmL7npLrov5vluqbmnaHvvJsKICAgICAgfSwKICAgICAgcHJvZ3Jlc3M6IDAsIC8vIOi/m+W6puadoem7mOiupDAKICAgICAgdmlkZW9MaW5rOiAnJywKICAgICAgZm9ybVZhbGlkYXRlOiB7CiAgICAgICAgdmlkZW9fbGluazogJycsCiAgICAgIH0sCiAgICAgIHVwbG9hZF90eXBlOiAnJywKICAgICAgdXBsb2FkRGF0YToge30sCiAgICAgIGhlYWRlcjoge30sCiAgICB9OwogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMudXBsb2FkVHlwZSgpOwogICAgdGhpcy5nZXRUb2tlbigpOwogIH0sCiAgbWV0aG9kczogewogICAgLy8g5Yig6Zmk6KeG6aKR77ybCiAgICBkZWxWaWRlbygpIHsKICAgICAgbGV0IHRoYXQgPSB0aGlzOwogICAgICB0aGF0LiRzZXQodGhhdC5mb3JtVmFsaWRhdGUsICd2aWRlb19saW5rJywgJycpOwogICAgfSwKICAgIC8v6I635Y+W6KeG6aKR5LiK5Lyg57G75Z6LCiAgICB1cGxvYWRUeXBlKCkgewogICAgICB1cGxvYWRUeXBlKCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgdGhpcy51cGxvYWRfdHlwZSA9IHJlcy5kYXRhLnVwbG9hZF90eXBlOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDkuIrkvKDmiJDlip8KICAgIGhhbmRsZVN1Y2Nlc3MocmVzLCBmaWxlLCBmaWxlTGlzdCkgewogICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUudmlkZW9fbGluayA9IHJlcy5kYXRhLnNyYzsKICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MocmVzLm1zZyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgfQogICAgfSwKICAgIHZpZGVvU2F2ZVRvVXJsKGZpbGUpIHsKICAgICAgaWYgKGlzVmlkZW9VcGxvYWQoZmlsZXgpKQogICAgICAgIHVwbG9hZEJ5UGllY2VzKHsKICAgICAgICAgIGZpbGU6IGZpbGUsIC8vIOinhumikeWunuS9kwogICAgICAgICAgcGllY2VTaXplOiAzLCAvLyDliIbniYflpKflsI8KICAgICAgICAgIHN1Y2Nlc3M6IChkYXRhKSA9PiB7CiAgICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnZpZGVvX2xpbmsgPSBkYXRhLmZpbGVfcGF0aDsKICAgICAgICAgICAgdGhpcy5wcm9ncmVzcyA9IDEwMDsKICAgICAgICAgIH0sCiAgICAgICAgICBlcnJvcjogKGUpID0+IHsKICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihlLm1zZyk7CiAgICAgICAgICB9LAogICAgICAgICAgdXBsb2FkaW5nOiAoY2h1bmssIGFsbENodW5rKSA9PiB7CiAgICAgICAgICAgIHRoaXMudmlkZW9JbmcgPSB0cnVlOwogICAgICAgICAgICBsZXQgc3QgPSBNYXRoLmZsb29yKChjaHVuayAvIGFsbENodW5rKSAqIDEwMCk7CiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MgPSBzdDsKICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICBnZXRUb2tlbigpIHsKICAgICAgdGhpcy5oZWFkZXJbJ0F1dGhvcmktemF0aW9uJ10gPSAnQmVhcmVyICcgKyBnZXRDb29raWVzKCd0b2tlbicpOwogICAgfSwKICAgIGJlZm9yZVVwbG9hZCgpIHsKICAgICAgdGhpcy51cGxvYWREYXRhID0ge307CiAgICAgIGxldCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXNvbHZlKHRydWUpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgcmV0dXJuIHByb21pc2U7CiAgICB9LAogICAgemhfdXBsb2FkRmlsZSgpIHsKICAgICAgaWYgKHRoaXMudmlkZW9MaW5rKSB7CiAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUudmlkZW9fbGluayA9IHRoaXMudmlkZW9MaW5rOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJHJlZnMucmVmaWQuY2xpY2soKTsKICAgICAgfQogICAgfSwKICAgIHpoX3VwbG9hZEZpbGVfY2hhbmdlKGV2ZmlsZSkgewogICAgICBsZXQgdGhhdCA9IHRoaXM7CiAgICAgIGlmIChldmZpbGUudGFyZ2V0LmZpbGVzWzBdLnR5cGUgIT09ICd2aWRlby9tcDQnKSB7CiAgICAgICAgcmV0dXJuIHRoYXQuJG1lc3NhZ2UuZXJyb3IoJ+WPquiDveS4iuS8oG1wNOaWh+S7ticpOwogICAgICB9CiAgICAgIGxldCB0eXBlcyA9IHsKICAgICAgICBrZXk6IGV2ZmlsZS50YXJnZXQuZmlsZXNbMF0ubmFtZSwKICAgICAgICBjb250ZW50VHlwZTogZXZmaWxlLnRhcmdldC5maWxlc1swXS50eXBlLAogICAgICB9OwogICAgICBwcm9kdWN0R2V0VGVtcEtleXNBcGkodHlwZXMpLnRoZW4oKHJlcykgPT4gewogICAgICAgIHRoYXQuJHZpZGVvQ2xvdWQKICAgICAgICAgIC52aWRlb1VwbG9hZCh7CiAgICAgICAgICAgIHR5cGU6IHJlcy5kYXRhLnR5cGUsCiAgICAgICAgICAgIGV2ZmlsZTogZXZmaWxlLAogICAgICAgICAgICByZXM6IHJlcywKICAgICAgICAgICAgdXBsb2FkaW5nKHN0YXR1cywgcHJvZ3Jlc3MpIHsKICAgICAgICAgICAgICB0aGF0LnVwbG9hZC52aWRlb0luZyA9IHN0YXR1czsKICAgICAgICAgICAgfSwKICAgICAgICAgIH0pCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIHRoYXQuZm9ybVZhbGlkYXRlLnZpZGVvX2xpbmsgPSByZXMudXJsOwogICAgICAgICAgICB0aGF0LiRtZXNzYWdlLnN1Y2Nlc3MoJ+inhumikeS4iuS8oOaIkOWKnycpOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgocmVzKSA9PiB7CiAgICAgICAgICAgIHRoYXQuJG1lc3NhZ2UuZXJyb3IocmVzKTsKICAgICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICB1cGxvYWRzKCkgewogICAgICB0aGlzLiRlbWl0KCdnZXR2aWRlbycsIHRoaXMuZm9ybVZhbGlkYXRlLnZpZGVvX2xpbmspOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA+CA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/uploadVideo","sourcesContent":["<template>\n  <div>\n    <div class=\"mt20 ml20\">\n      <el-input class=\"perW35\" v-model=\"videoLink\" placeholder=\"请输入视频链接\" />\n      <input type=\"file\" ref=\"refid\" style=\"display: none\" @change=\"zh_uploadFile_change\" />\n      <el-button\n        v-if=\"upload_type !== '1' || videoLink\"\n        type=\"primary\"\n        icon=\"ios-cloud-upload-outline\"\n        class=\"ml10\"\n        @click=\"zh_uploadFile\"\n        >{{ videoLink ? '确认添加' : '上传视频' }}</el-button\n      >\n      <el-upload\n        v-if=\"upload_type === '1' && !videoLink\"\n        :show-file-list=\"false\"\n        :action=\"fileUrl\"\n        class=\"ml10\"\n        :before-upload=\"videoSaveToUrl\"\n        :data=\"uploadData\"\n        :headers=\"header\"\n        :multiple=\"true\"\n        style=\"display: inline-block\"\n        accept=\".mp4\"\n      >\n        <el-button type=\"primary\" icon=\"ios-cloud-upload-outline\">上传视频</el-button>\n      </el-upload>\n      <Progress :percent=\"progress\" :stroke-width=\"5\" v-if=\"upload.videoIng\" />\n      <div class=\"video-style\" v-if=\"formValidate.video_link\">\n        <video\n          style=\"width: 100%; height: 100% !important; border-radius: 10px\"\n          :src=\"formValidate.video_link\"\n          controls=\"controls\"\n        >\n          您的浏览器不支持 video 标签。\n        </video>\n        <div class=\"mark\"></div>\n        <i class=\"el-icon-delete iconv\" @click=\"delVideo\"></i>\n      </div>\n    </div>\n    <div class=\"mt50 ml20\">\n      <el-button type=\"primary\" @click=\"uploads\">确认</el-button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { uploadByPieces } from '@/utils/upload'; //引入uploadByPieces方法\nimport { productGetTempKeysApi, uploadType } from '@/api/product';\nimport Setting from '@/setting';\nimport { getCookies } from '@/libs/util';\nimport { isVideoUpload } from '@/utils';\n\n// import '../../../public/UEditor/dialogs/internal';\nexport default {\n  name: 'vide11o',\n  data() {\n    return {\n      fileUrl: Setting.apiBaseURL + '/file/upload',\n      upload: {\n        videoIng: false, // 是否显示进度条；\n      },\n      progress: 0, // 进度条默认0\n      videoLink: '',\n      formValidate: {\n        video_link: '',\n      },\n      upload_type: '',\n      uploadData: {},\n      header: {},\n    };\n  },\n  created() {\n    this.uploadType();\n    this.getToken();\n  },\n  methods: {\n    // 删除视频；\n    delVideo() {\n      let that = this;\n      that.$set(that.formValidate, 'video_link', '');\n    },\n    //获取视频上传类型\n    uploadType() {\n      uploadType().then((res) => {\n        this.upload_type = res.data.upload_type;\n      });\n    },\n    // 上传成功\n    handleSuccess(res, file, fileList) {\n      if (res.status === 200) {\n        this.formValidate.video_link = res.data.src;\n        this.$message.success(res.msg);\n      } else {\n        this.$message.error(res.msg);\n      }\n    },\n    videoSaveToUrl(file) {\n      if (isVideoUpload(filex))\n        uploadByPieces({\n          file: file, // 视频实体\n          pieceSize: 3, // 分片大小\n          success: (data) => {\n            this.formValidate.video_link = data.file_path;\n            this.progress = 100;\n          },\n          error: (e) => {\n            this.$message.error(e.msg);\n          },\n          uploading: (chunk, allChunk) => {\n            this.videoIng = true;\n            let st = Math.floor((chunk / allChunk) * 100);\n            this.progress = st;\n          },\n        });\n      return false;\n    },\n    getToken() {\n      this.header['Authori-zation'] = 'Bearer ' + getCookies('token');\n    },\n    beforeUpload() {\n      this.uploadData = {};\n      let promise = new Promise((resolve) => {\n        this.$nextTick(function () {\n          resolve(true);\n        });\n      });\n      return promise;\n    },\n    zh_uploadFile() {\n      if (this.videoLink) {\n        this.formValidate.video_link = this.videoLink;\n      } else {\n        this.$refs.refid.click();\n      }\n    },\n    zh_uploadFile_change(evfile) {\n      let that = this;\n      if (evfile.target.files[0].type !== 'video/mp4') {\n        return that.$message.error('只能上传mp4文件');\n      }\n      let types = {\n        key: evfile.target.files[0].name,\n        contentType: evfile.target.files[0].type,\n      };\n      productGetTempKeysApi(types).then((res) => {\n        that.$videoCloud\n          .videoUpload({\n            type: res.data.type,\n            evfile: evfile,\n            res: res,\n            uploading(status, progress) {\n              that.upload.videoIng = status;\n            },\n          })\n          .then((res) => {\n            that.formValidate.video_link = res.url;\n            that.$message.success('视频上传成功');\n          })\n          .catch((res) => {\n            that.$message.error(res);\n          });\n      });\n    },\n    uploads() {\n      this.$emit('getvideo', this.formValidate.video_link);\n    },\n  },\n};\n</script>\n\n<style scoped>\n.video-style {\n  width: 40%;\n  height: 180px;\n  border-radius: 10px;\n  background-color: #707070;\n  margin-top: 10px;\n  position: relative;\n  overflow: hidden;\n}\n.video-style .iconv {\n  color: #fff;\n  line-height: 180px;\n  width: 50px;\n  height: 50px;\n  display: inherit;\n  font-size: 26px;\n  position: absolute;\n  top: -74px;\n  left: 50%;\n  margin-left: -25px;\n}\n.video-style .mark {\n  position: absolute;\n  width: 100%;\n  height: 30px;\n  top: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  text-align: center;\n}\n</style>\n"]}]}