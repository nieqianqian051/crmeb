"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_dom=_interopRequireDefault(require("../../tools/dom")),_util=require("../../table/src/util"),_utils=require("../../tools/utils"),_vXETable=_interopRequireDefault(require("../../v-x-e-table"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default={methods:{_openFilter:function(e){var t,i,l=(0,_util.handleFieldOrColumn)(this,e);return l&&l.filters?(t=this.elemStore,i=l.fixed,this.scrollToColumn(l).then(function(){var e=t["".concat(i||"main","-header-wrapper")]||t["main-header-wrapper"];e&&(e=e.querySelector(".vxe-header--column.".concat(l.id," .vxe-filter--btn")),_dom.default.triggerEvent(e,"click"))})):this.$nextTick()},_setFilter:function(e,t,i){e=(0,_util.handleFieldOrColumn)(this,e);return e&&e.filters&&(e.filters=(0,_util.toFilters)(t||[])),i?this.updateData():this.$nextTick()},checkFilterOptions:function(){var e=this.filterStore;e.isAllSelected=e.options.every(function(e){return e._checked}),e.isIndeterminate=!e.isAllSelected&&e.options.some(function(e){return e._checked})},triggerFilterEvent:function(e,h,t){var d,p,i,l,r,n,v,m=this,_=this.filterStore;_.column===h&&_.visible?_.visible=!1:(d=e.target,p=e.pageX,i=h.filters,l=h.filterMultiple,r=h.filterRender,r=(0,_utils.isEnableConf)(r)?_vXETable.default.renderer.get(r.name):null,n=h.filterRecoverMethod||(r?r.tableFilterRecoverMethod||r.filterRecoverMethod:null),v=_dom.default.getDomNode().visibleWidth,Object.assign(_,{args:t,multiple:l,options:i,column:h,style:null,visible:!0}),_.options.forEach(function(e){var t=e._checked,i=e.checked;(e._checked=i)||t===i||n&&n({option:e,column:h,$table:m})}),this.checkFilterOptions(),this.initStore.filter=!0,this.$nextTick(function(){var e,t,i,l,r,n,o,s,a,f=m.$refs,u=f.tableHeader,c=f.tableBody,f=f.filterWrapper,c=c.$el,u=u?u.$el:null;c&&(f=f.$el)&&(e=f.offsetWidth,a=f.offsetHeight,t=f.querySelector(".vxe-table--filter-header"),f=f.querySelector(".vxe-table--filter-footer"),i=e/2,l=c.clientWidth-e-10,o={top:"".concat(d.offsetTop+d.offsetParent.offsetTop+d.offsetHeight,"px")},s=null,(u=c.clientHeight-(u?u.clientHeight/2:0))<=a&&(s=Math.max(40,u-(f?f.offsetHeight:0)-(t?t.offsetHeight:0))),"left"===h.fixed?r=d.offsetLeft+d.offsetParent.offsetLeft-i:"right"===h.fixed?n=d.offsetParent.offsetWidth-d.offsetLeft+(d.offsetParent.offsetParent.offsetWidth-d.offsetParent.offsetLeft)-h.renderWidth-i:r=d.offsetLeft+d.offsetParent.offsetLeft-i-c.scrollLeft,r?(0<(a=p+e-i+10-v)&&(r-=a),o.left="".concat(Math.min(l,Math.max(10,r)),"px")):n&&(0<(u=p+e-i+10-v)&&(n+=u),o.right="".concat(Math.max(10,n),"px")),_.style=o,_.maxHeight=s)})),this.emitEvent("filter-visible",{column:h,field:h.field,property:h.field,filterList:this.getCheckedFilters(),visible:_.visible},e)},_getCheckedFilters:function(){var e=this.tableFullColumn,n=[];return e.forEach(function(e){var t=e.field,i=e.filters,l=[],r=[];i&&i.length&&(i.forEach(function(e){e.checked&&(l.push(e.value),r.push(e.data))}),l.length)&&n.push({column:e,field:t,property:t,values:l,datas:r})}),n},confirmFilterEvent:function(e){var i=this,t=this.filterStore,l=this.filterOpts,r=this.scrollXLoad,n=this.scrollYLoad,t=t.column,o=t.field,s=[],a=[],f=(t.filters.forEach(function(e){e.checked&&(s.push(e.value),a.push(e.data))}),this.getCheckedFilters()),t={$table:this,$event:e,column:t,field:o,property:o,values:s,datas:a,filters:f,filterList:f};l.remote||(this.handleTableData(!0),this.checkSelectionStatus()),this.mouseConfig&&this.mouseOpts.area&&this.handleFilterEvent&&this.handleFilterEvent(e,t),this.emitEvent("filter-change",t,e),this.closeFilter(),this.updateFooter().then(function(){var e=i.scrollXLoad,t=i.scrollYLoad;if(r||e||n||t)return(r||e)&&i.updateScrollXSpace(),(n||t)&&i.updateScrollYSpace(),i.refreshScroll()}).then(function(){return i.updateCellAreas(),i.recalculate(!0)}).then(function(){setTimeout(function(){return i.recalculate()},50)})},handleClearFilter:function(e){var t,i,l;e&&(t=e.filters,i=e.filterRender,t)&&(i=(0,_utils.isEnableConf)(i)?_vXETable.default.renderer.get(i.name):null,l=e.filterResetMethod||(i?i.tableFilterResetMethod||i.filterResetMethod:null),t.forEach(function(e){e._checked=!1,e.checked=!1,l||(e.data=_xeUtils.default.clone(e.resetValue,!0))}),l)&&l({options:t,column:e,$table:this})},resetFilterEvent:function(e){this.handleClearFilter(this.filterStore.column),this.confirmFilterEvent(e)},_clearFilter:function(e){var t,i=this.filterStore;return e?(t=(0,_util.handleFieldOrColumn)(this,e))&&this.handleClearFilter(t):this.visibleColumn.forEach(this.handleClearFilter),e&&t===i.column||Object.assign(i,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.updateData()},_updateFilterOptionStatus:function(e,t){return e._checked=t,e.checked=t,this.$nextTick()}}};