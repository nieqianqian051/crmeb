"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=_interopRequireDefault(require("../../mixins/size")),_utils=_interopRequireWildcard(require("../../tools/utils")),_dom=_interopRequireDefault(require("../../tools/dom")),_event=require("../../tools/event");function _getRequireWildcardCache(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(_getRequireWildcardCache=function(e){return e?n:t})(e))}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var n,i,o={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&{}.hasOwnProperty.call(e,n)&&((i=r?Object.getOwnPropertyDescriptor(e,n):null)&&(i.get||i.set)?Object.defineProperty(o,n,i):o[n]=e[n]);return o.default=e,t&&t.set(e,o),o}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var _default2=exports.default={name:"VxeButton",mixins:[_size.default],props:{type:String,mode:String,size:{type:String,default:function(){return _conf.default.button.size||_conf.default.size}},name:[String,Number],content:String,placement:String,status:String,icon:String,round:Boolean,circle:Boolean,title:String,disabled:Boolean,loading:Boolean,trigger:{type:String,default:function(){return _conf.default.button.trigger}},destroyOnClose:Boolean,className:[String,Function],popupClassName:[String,Function],transfer:{type:Boolean,default:function(){return _conf.default.button.transfer}}},inject:{$xebuttonggroup:{default:null}},data:function(){return{inited:!1,visiblePanel:!1,animatVisible:!1,isActivated:!1,panelIndex:0,panelStyle:null,panelPlacement:null}},computed:{isFormBtn:function(){var e=this.type;return!!e&&-1<["submit","reset","button"].indexOf(e)},btnMode:function(){var e=this.$xebuttonggroup,t=this.mode,n=this.type;return"text"===t||"text"===n||e&&"text"===e.mode?"text":"button"},btnStatus:function(){var e=this.$xebuttonggroup,t=this.status;return t||(e?e.status:"")},btnRound:function(){var e=this.$xebuttonggroup,t=this.round;return t||!!e&&e.round},btnCircle:function(){var e=this.$xebuttonggroup,t=this.circle;return t||!!e&&e.circle}},created:function(){_event.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_event.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent)},beforeDestroy:function(){var e=this.$refs.btnPanel;e&&e.parentNode&&e.parentNode.removeChild(e)},destroyed:function(){_event.GlobalEvent.off(this,"mousewheel"),_event.GlobalEvent.off(this,"mousedown")},render:function(e){var t=this.$scopedSlots,n=this.className,i=this.popupClassName,o=this.trigger,r=this.title,s=this.inited,a=this.type,l=this.destroyOnClose,u=this.isFormBtn,c=this.btnMode,d=this.btnStatus,f=this.btnRound,p=this.btnCircle,h=this.vSize,v=this.name,b=this.disabled,m=this.loading,g=this.visiblePanel,y=this.animatVisible,_=this.panelPlacement,t=t.dropdowns,P={},x={};return t&&"hover"===o&&(P.mouseenter=this.mouseenterTargetEvent,P.mouseleave=this.mouseleaveTargetEvent,x.mouseenter=this.mouseenterDropdownEvent,x.mouseleave=this.mouseleaveDropdownEvent),t?e("div",{class:["vxe-button--dropdown",n?_xeUtils.default.isFunction(n)?n({$button:this}):n:"",_defineProperty(_defineProperty({},"size--".concat(h),h),"is--active",g)]},[e("button",{ref:"xBtn",class:["vxe-button","type--".concat(c),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat(h),h),"theme--".concat(d),d),"is--round",f),"is--circle",p),"is--disabled",b||m),"is--loading",m)],attrs:{name:v,title:r,type:u?a:"button",disabled:b||m},on:_objectSpread({click:this.clickTargetEvent},P)},this.renderContent(e).concat([e("i",{class:"vxe-button--dropdown-arrow ".concat(_conf.default.icon.BUTTON_DROPDOWN)})])),e("div",{ref:"btnPanel",class:["vxe-button--dropdown-panel",i?_xeUtils.default.isFunction(i)?i({$button:this}):i:"",_defineProperty(_defineProperty(_defineProperty({},"size--".concat(h),h),"animat--leave",y),"animat--enter",g)],attrs:{placement:_},style:this.panelStyle,on:x},s?[e("div",{class:"vxe-button--dropdown-wrapper",on:{mousedown:this.mousedownDropdownEvent,click:this.clickDropdownEvent}},l&&!g?[]:t.call(this,{},e))]:null)]):e("button",{ref:"xBtn",class:["vxe-button","type--".concat(c),n?_xeUtils.default.isFunction(n)?n({$button:this}):n:"",_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat(h),h),"theme--".concat(d),d),"is--round",f),"is--circle",p),"is--disabled",b||m),"is--loading",m)],attrs:{name:v,title:r,type:u?a:"button",disabled:b||m},on:{click:this.clickEvent,onMouseenter:this.mouseenterEvent,onMouseleave:this.mouseleaveEvent}},this.renderContent(e))},methods:{renderContent:function(e){var t=this.$scopedSlots,n=this.content,i=this.icon,o=[];return this.loading?o.push(e("i",{class:["vxe-button--loading-icon",_conf.default.icon.BUTTON_LOADING]})):t.icon?o.push(e("span",{class:"vxe-button--custom-icon"},t.icon.call(this,{}))):i&&o.push(e("i",{class:["vxe-button--icon",i]})),t.default?o.push(e("span",{class:"vxe-button--content"},t.default.call(this,{}))):n&&o.push(e("span",{class:"vxe-button--content"},[(0,_utils.getFuncText)(n)])),o},handleGlobalMousewheelEvent:function(e){this.visiblePanel&&!_dom.default.getEventTargetNode(e,this.$refs.btnPanel).flag&&this.closePanel()},handleGlobalMousedownEvent:function(e){var t,n=this.disabled,i=this.visiblePanel;n||(n=this.$refs.$el,t=this.$refs.btnPanel,this.isActivated=_dom.default.getEventTargetNode(e,n).flag||_dom.default.getEventTargetNode(e,t).flag,i&&!this.isActivated&&this.closePanel())},updateZindex:function(){this.panelIndex<_utils.default.getLastZIndex()&&(this.panelIndex=_utils.default.nextZIndex())},mousedownDropdownEvent:function(e){0===e.button&&e.stopPropagation()},clickEvent:function(e){var t=this.$xebuttonggroup;t?t.handleClick({name:this.name},e):this.$emit("click",{$event:e})},clickDropdownEvent:function(e){var t=this,n=e.currentTarget,i=this.$refs.btnPanel,n=_dom.default.getEventTargetNode(e,n,"vxe-button"),o=n.flag,n=n.targetElem;o&&(i&&(i.dataset.active="N"),this.visiblePanel=!1,setTimeout(function(){i&&"Y"===i.dataset.active||(t.animatVisible=!1)},350),this.$emit("dropdown-click",{name:n.getAttribute("name"),$event:e}))},mouseleaveTargetEvent:function(e){this.closePanel(),this.mouseleaveEvent(e)},mouseenterEvent:function(e){this.$emit("mouseenter",{$event:e})},mouseleaveEvent:function(e){this.$emit("mouseleave",{$event:e})},mouseenterTargetEvent:function(e){this.openPanel(),this.$emit("mouseenter",{$event:e})},mouseenterDropdownEvent:function(){var e=this,t=this.$refs.btnPanel;t&&(t.dataset.active="Y",this.animatVisible=!0,setTimeout(function(){"Y"===t.dataset.active&&(e.visiblePanel=!0,e.updateZindex(),e.updatePlacement(),setTimeout(function(){e.visiblePanel&&e.updatePlacement()},50))},20))},mouseleaveDropdownEvent:function(){this.closePanel()},clickTargetEvent:function(e){"click"===this.trigger&&(this.visiblePanel?this.closePanel():this.openPanel()),this.clickEvent(e)},openPanel:function(){var e=this,t=this.trigger,n=this.$refs.btnPanel;return n&&(n.dataset.active="Y",this.inited||(this.inited=!0,this.transfer&&document.body.appendChild(n)),this.showTime=setTimeout(function(){"Y"===n.dataset.active?e.mouseenterDropdownEvent():e.animatVisible=!1},"click"===t?50:250)),this.$nextTick()},closePanel:function(){var e=this,t=this.$refs.btnPanel;return clearTimeout(this.showTime),t?(t.dataset.active="N",setTimeout(function(){"Y"!==t.dataset.active&&(e.visiblePanel=!1,setTimeout(function(){"Y"!==t.dataset.active&&(e.animatVisible=!1)},350))},100)):(this.animatVisible=!1,this.visiblePanel=!1),this.$nextTick()},updatePlacement:function(){var p=this;return this.$nextTick().then(function(){var e,t,n,i,o,r,s,a,l=p.$refs,u=p.transfer,c=p.placement,d=p.panelIndex,f=l.xBtn,l=l.btnPanel;if(l&&f)return e=f.offsetHeight,t=f.offsetWidth,n=l.offsetHeight,l=l.offsetWidth,d={zIndex:d},a=(f=_dom.default.getAbsolutePos(f)).top,i=f.left,o=f.boundingTop,r=f.visibleHeight,f=f.visibleWidth,s="bottom",u?(u=a+e,"top"===c?(s="top",u=a-n):c||(r<o+e+n+5&&(s="top",u=a-n),u<5&&(s="bottom",u=a+e)),f<(a=i+t-l)+l+5&&(a-=a+l+5-f),a<5&&(a=5),Object.assign(d,{left:"".concat(a,"px"),right:"auto",top:"".concat(u,"px"),minWidth:"".concat(t,"px")})):"top"===c?(s="top",d.bottom="".concat(e,"px")):c||r<o+e+n&&5<o-e-n&&(s="top",d.bottom="".concat(e,"px")),p.panelStyle=d,p.panelPlacement=s,p.$nextTick()})},focus:function(){return this.$el.focus(),this.$nextTick()},blur:function(){return this.$el.blur(),this.$nextTick()}}};