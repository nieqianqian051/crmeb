"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=_interopRequireDefault(require("../../mixins/size")),_utils=_interopRequireDefault(require("../../tools/utils")),_dom=_interopRequireDefault(require("../../tools/dom")),_event=require("../../tools/event"),_xeUtils=_interopRequireDefault(require("xe-utils"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var _default2=exports.default={name:"VxePulldown",mixins:[_size.default],props:{value:Boolean,disabled:Boolean,placement:String,size:{type:String,default:function(){return _conf.default.size}},className:[String,Function],popupClassName:[String,Function],destroyOnClose:Boolean,transfer:Boolean},data:function(){return{inited:!1,panelIndex:0,panelStyle:null,panelPlacement:null,currentValue:null,visiblePanel:!1,animatVisible:!1,isActivated:!1}},watch:{value:function(e){e?this.showPanel():this.hidePanel()}},created:function(){_event.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_event.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_event.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent)},beforeDestroy:function(){var e=this.$refs.panel;e&&e.parentNode&&e.parentNode.removeChild(e)},destroyed:function(){_event.GlobalEvent.off(this,"mousewheel"),_event.GlobalEvent.off(this,"mousedown"),_event.GlobalEvent.off(this,"blur")},render:function(e){var t=this._e,i=this.$scopedSlots,n=this.inited,l=this.className,o=this.popupClassName,a=this.vSize,s=this.destroyOnClose,r=this.transfer,u=this.isActivated,d=this.disabled,f=this.animatVisible,p=this.visiblePanel,h=this.panelStyle,c=this.panelPlacement,v=i.default,m=i.header,b=i.footer,i=i.dropdown;return e("div",{class:["vxe-pulldown",l?_xeUtils.default.isFunction(l)?l({$pulldown:this}):l:"",_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat(a),a),"is--visivle",p),"is--disabled",d),"is--active",u)]},[e("div",{ref:"content",class:"vxe-pulldown--content"},v?v.call(this,{$pulldown:this},e):[]),e("div",{ref:"panel",class:["vxe-table--ignore-clear vxe-pulldown--panel",o?_xeUtils.default.isFunction(o)?o({$pulldown:this}):o:"",_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat(a),a),"is--transfer",r),"animat--leave",f),"animat--enter",p)],attrs:{placement:c},style:h},[e("div",{class:"vxe-pulldown--panel-wrapper"},!n||s&&!p&&!f?[]:[m?e("div",{class:"vxe-pulldown--panel-header"},m.call(this,{$pulldown:this})):t(),e("div",{class:"vxe-pulldown--panel-body"},i?i.call(this,{$pulldown:this},e):[]),b?e("div",{class:"vxe-pulldown--panel-footer"},b.call(this,{$pulldown:this})):t()])])])},methods:{handleGlobalMousewheelEvent:function(e){var t=this.$refs,i=this.disabled,n=this.visiblePanel;i||n&&(_dom.default.getEventTargetNode(e,t.panel).flag?this.updatePlacement():(this.hidePanel(),this.$emit("hide-panel",{$event:e})))},handleGlobalMousedownEvent:function(e){var t=this.$refs,i=this.$el,n=this.disabled,l=this.visiblePanel;n||(this.isActivated=_dom.default.getEventTargetNode(e,i).flag||_dom.default.getEventTargetNode(e,t.panel).flag,l&&!this.isActivated&&(this.hidePanel(),this.$emit("hide-panel",{$event:e})))},handleGlobalBlurEvent:function(e){this.visiblePanel&&(this.isActivated=!1,this.hidePanel(),this.$emit("hide-panel",{$event:e}))},updateZindex:function(){this.panelIndex<_utils.default.getLastZIndex()&&(this.panelIndex=_utils.default.nextZIndex())},isPanelVisible:function(){return this.visiblePanel},togglePanel:function(){return this.visiblePanel?this.hidePanel():this.showPanel()},showPanel:function(){var t=this;return this.inited||(this.inited=!0,this.transfer&&document.body.appendChild(this.$refs.panel)),new Promise(function(e){t.disabled?e(t.$nextTick()):(clearTimeout(t.hidePanelTimeout),t.isActivated=!0,t.animatVisible=!0,setTimeout(function(){t.visiblePanel=!0,t.$emit("update:input",!0),t.updatePlacement(),setTimeout(function(){e(t.updatePlacement())},40)},10),t.updateZindex())})},hidePanel:function(){var t=this;return this.visiblePanel=!1,this.$emit("update:input",!1),new Promise(function(e){t.animatVisible?t.hidePanelTimeout=setTimeout(function(){t.animatVisible=!1,e(t.$nextTick())},350):e(t.$nextTick())})},updatePlacement:function(){var p=this;return this.$nextTick().then(function(){var e,t,i,n,l,o,a,s,r=p.$refs,u=p.transfer,d=p.placement,f=p.panelIndex;return p.visiblePanel&&(n=r.panel,r=r.content,n)&&r&&(e=r.offsetHeight,t=r.offsetWidth,i=n.offsetHeight,n=n.offsetWidth,f={zIndex:f},l=(r=_dom.default.getAbsolutePos(r)).boundingTop,s=r.boundingLeft,o=r.visibleHeight,r=r.visibleWidth,a="bottom",u?(u=l+e,"top"===d?(a="top",u=l-i):d||(o<u+i+5&&(a="top",u=l-i),u<5&&(a="bottom",u=l+e)),r<(s=s)+n+5&&(s-=s+n+5-r),s<5&&(s=5),Object.assign(f,{left:"".concat(s,"px"),top:"".concat(u,"px"),minWidth:"".concat(t,"px")})):"top"===d?(a="top",f.bottom="".concat(e,"px")):d||o<l+e+i&&5<l-e-i&&(a="top",f.bottom="".concat(e,"px")),p.panelStyle=f,p.panelPlacement=a),p.$nextTick()})}}};