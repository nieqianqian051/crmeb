"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_utils=_interopRequireWildcard(require("../../tools/utils")),_dom=_interopRequireDefault(require("../../tools/dom")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_log=require("../../tools/log");function _getRequireWildcardCache(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(_getRequireWildcardCache=function(e){return e?n:t})(e))}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var n,i,o={__proto__:null},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&{}.hasOwnProperty.call(e,n)&&((i=l?Object.getOwnPropertyDescriptor(e,n):null)&&(i.get||i.set)?Object.defineProperty(o,n,i):o[n]=e[n]);return o.default=e,t&&t.set(e,o),o}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default={methods:{_closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,selectChild:null,showChild:!1}),this.$nextTick()},moveCtxMenu:function(e,t,n,i,o,l,r){var s,u=_xeUtils.default.findIndexOf(r,function(e){return n[i]===e});if(t===o)l&&_utils.default.hasChildrenList(n.selected)?n.showChild=!0:(n.showChild=!1,n.selectChild=null);else if(38===t){for(var c=u-1;0<=c;c--)if(!1!==r[c].visible){s=r[c];break}n[i]=s||r[r.length-1]}else if(40===t){for(var a=u+1;a<r.length;a++)if(!1!==r[a].visible){s=r[a];break}n[i]=s||r[0]}else!n[i]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,n[i])},handleGlobalContextmenuEvent:function(e){var t=this.$refs,n=this.tId,i=this.editStore,o=this.menuConfig,l=this.contextMenu,r=this.ctxMenuStore,s=this.ctxMenuOpts,u=this.mouseConfig,c=this.mouseOpts,i=i.selected,a=["header","body","footer"];if((0,_utils.isEnableConf)(o)||l){if(r.visible&&t.ctxWrapper&&_dom.default.getEventTargetNode(e,t.ctxWrapper.$el).flag)return void e.preventDefault();if(this._keyCtx){o="body",l={type:o,$grid:this.$xegrid,$table:this,keyboard:!0,columns:this.visibleColumn.slice(0),$event:e};if(u&&c.area){r=this.getActiveCellArea();if(r&&r.row&&r.column)return l.row=r.row,l.column=r.column,void this.handleOpenMenuEvent(e,o,l)}else if(u&&c.selected&&i.row&&i.column)return l.row=i.row,l.column=i.column,void this.handleOpenMenuEvent(e,o,l)}for(var d=0;d<a.length;d++){var f,h,p=a[d],v=_dom.default.getEventTargetNode(e,this.$el,"vxe-".concat(p,"--column"),function(e){return e.parentNode.parentNode.parentNode.getAttribute("xid")===n}),g={type:p,$grid:this.$xegrid,$table:this,columns:this.visibleColumn.slice(0),$event:e};if(v.flag)return v=v.targetElem,f=this.getColumnNode(v).item,h="".concat(p,"-"),Object.assign(g,{column:f,columnIndex:this.getColumnIndex(f),cell:v}),"body"===p&&(f=this.getRowNode(v.parentNode).item,h="",g.row=f,g.rowIndex=this.getRowIndex(f)),this.handleOpenMenuEvent(e,p,g),void(this.$listeners["".concat(h,"cell-context-menu")]?("development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delEvent",["".concat(h,"cell-context-menu"),"".concat(h,"cell-menu")]),this.emitEvent("".concat(h,"cell-context-menu"),g,e)):this.emitEvent("".concat(h,"cell-menu"),g,e));if(_dom.default.getEventTargetNode(e,this.$el,"vxe-table--".concat(p,"-wrapper"),function(e){return e.getAttribute("xid")===n}).flag)return void("cell"===s.trigger?e.preventDefault():this.handleOpenMenuEvent(e,p,g))}}t.filterWrapper&&!_dom.default.getEventTargetNode(e,t.filterWrapper.$el).flag&&this.closeFilter(),this.closeMenu()},handleOpenMenuEvent:function(t,e,n){var f,h=this,i=this.isCtxMenu,p=this.ctxMenuStore,o=this.ctxMenuOpts,e=o[e],v=o.visibleMethod;e&&(f=e.options,e.disabled?t.preventDefault():i&&f&&f.length&&(n.options=f,this.preventEvent(t,"event.showMenu",n,function(){var o,l,r,s,u,c,i,e,a,d;!v||v(n)?(t.preventDefault(),h.updateZindex(),e=_dom.default.getDomNode(),o=e.scrollTop,l=e.scrollLeft,r=e.visibleHeight,s=e.visibleWidth,u=t.clientY+o,c=t.clientX+l,i=function(){Object.assign(p,{args:n,visible:!0,list:f,selected:null,selectChild:null,showChild:!1,style:{zIndex:h.tZindex,top:"".concat(u,"px"),left:"".concat(c,"px")}}),h.$nextTick(function(){var e=h.$refs.ctxWrapper.$el,t=e.clientHeight,n=e.clientWidth,e=_dom.default.getAbsolutePos(e),i=e.boundingTop,e=e.boundingLeft+n-s;-10<i+t-r&&(p.style.top="".concat(Math.max(o+2,u-t-2),"px")),-10<e&&(p.style.left="".concat(Math.max(l+2,c-n-2),"px"))})},e=n.keyboard,a=n.row,d=n.column,e&&a&&d?h.scrollToRow(a,d).then(function(){var e=h.getCellElement(a,d),t=_dom.default.getAbsolutePos(e),n=t.boundingTop,t=t.boundingLeft;u=n+o+Math.floor(e.offsetHeight/2),c=t+l+Math.floor(e.offsetWidth/2),i()}):i()):h.closeMenu()}))),this.closeFilter()},ctxMenuMouseoverEvent:function(e,t,n){var s=e.currentTarget,i=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),i.selected=t,(i.selectChild=n)||(i.showChild=_utils.default.hasChildrenList(t),i.showChild&&this.$nextTick(function(){var e,t,n,i,o,l,r=s.nextElementSibling;r&&(t=(l=_dom.default.getAbsolutePos(s)).boundingTop,o=l.boundingLeft,e=l.visibleHeight,l=l.visibleWidth,t=t+s.offsetHeight,i=n="",o+s.offsetWidth+r.offsetWidth>l-10&&(n="auto",i="".concat(s.offsetWidth,"px")),l=o="",t+r.offsetHeight>e-10&&(o="auto",l="0"),r.style.left=n,r.style.right=i,r.style.top=o,r.style.bottom=l)}))},ctxMenuMouseoutEvent:function(e,t){var n=this.ctxMenuStore;t.children||(n.selected=null),n.selectChild=null},ctxMenuLinkEvent:function(e,t){var n;t.disabled||!t.code&&t.children&&t.children.length||(n=_vXETable.default.menus.get(t.code),t=Object.assign({menu:t,$grid:this.$xegrid,$table:this,$event:e},this.ctxMenuStore.args),n&&n.menuMethod&&n.menuMethod(t,e),this.$listeners["context-menu-click"]?("development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delEvent",["context-menu-click","menu-click"]),this.emitEvent("context-menu-click",t,e)):this.emitEvent("menu-click",t,e),this.closeMenu())}}};