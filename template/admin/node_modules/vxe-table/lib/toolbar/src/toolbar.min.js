"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_size=_interopRequireDefault(require("../../mixins/size")),_vn=require("../../tools/vn"),_log=require("../../tools/log");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}var renderDropdowns=function(e,o,t,r){var n=o._e,t=t.dropdowns;return t?t.map(function(t){return!1===t.visible?n():e("vxe-button",{on:{click:function(e){return r?o.btnEvent(e,t):o.tolEvent(e,t)}},props:{disabled:t.disabled,loading:t.loading,type:t.type,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name}})}):[]};function renderBtns(l,s){var a=s._e,e=s.$scopedSlots,c=s.$xegrid,u=s.$xetable,t=s.buttons,t=void 0===t?[]:t,e=e.buttons;return e?e.call(s,{$grid:c,$table:u},l):t.map(function(t){var e=t.dropdowns,o=t.buttonRender,r=o?_vXETable.default.renderer.get(o.name):null;if(!1===t.visible)return a();if(r){var n=r.renderToolbarButton||r.renderButton,r=r.toolbarButtonClassName,i={$grid:c,$table:u,button:t};if(n)return l("span",{class:["vxe-button--item",r?_xeUtils.default.isFunction(r)?r(i):r:""]},(0,_vn.getSlotVNs)(n.call(s,l,o,i)))}return l("vxe-button",{on:{click:function(e){return s.btnEvent(e,t)}},props:{disabled:t.disabled,loading:t.loading,type:t.type,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,destroyOnClose:t.destroyOnClose,placement:t.placement,transfer:t.transfer},scopedSlots:e&&e.length?{dropdowns:function(){return renderDropdowns(l,s,t,!0)}}:null})})}function renderRightTools(l,s){var a=s._e,e=s.$scopedSlots,c=s.$xetable,u=s.$xegrid,t=s.tools,t=void 0===t?[]:t,e=e.tools;return e?e.call(s,{$table:c,$grid:u},l):t.map(function(t){var e=t.dropdowns,o=t.toolRender,r=o?_vXETable.default.renderer.get(o.name):null;if(!1===t.visible)return a();if(r){var n,i=r.renderToolbarTool;if(i)return r=r.toolbarToolClassName,n={$table:c,$grid:u,tool:t},l("span",{class:["vxe-tool--item",r?_xeUtils.default.isFunction(r)?r(n):r:""]},(0,_vn.getSlotVNs)(i.call(s,l,o,n)))}return l("vxe-button",{on:{click:function(e){return s.tolEvent(e,t)}},props:{disabled:t.disabled,loading:t.loading,type:t.type,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,destroyOnClose:t.destroyOnClose,placement:t.placement,transfer:t.transfer},scopedSlots:e&&e.length?{dropdowns:function(){return renderDropdowns(l,s,t,!1)}}:null})})}function renderToolImport(e,t){var o=t.importOpts;return e("vxe-button",{props:{circle:!0,title:_conf.default.i18n("vxe.toolbar.import"),icon:o.icon||_conf.default.icon.TOOLBAR_TOOLS_IMPORT},on:{click:t.importEvent}})}function renderToolExport(e,t){var o=t.exportOpts;return e("vxe-button",{props:{circle:!0,title:_conf.default.i18n("vxe.toolbar.export"),icon:o.icon||_conf.default.icon.TOOLBAR_TOOLS_EXPORT},on:{click:t.exportEvent}})}function renderToolPrint(e,t){var o=t.printOpts;return e("vxe-button",{props:{circle:!0,title:_conf.default.i18n("vxe.toolbar.print"),icon:o.icon||_conf.default.icon.TOOLBAR_TOOLS_PRINT},on:{click:t.printEvent}})}function renderToolRefresh(e,t){var o=t.refreshOpts,r=t.isRefresh;return e("vxe-button",{props:{circle:!0,title:_conf.default.i18n("vxe.toolbar.refresh"),icon:r?o.iconLoading||_conf.default.icon.TOOLBAR_TOOLS_REFRESH_LOADING:o.icon||_conf.default.icon.TOOLBAR_TOOLS_REFRESH},on:{click:t.refreshEvent}})}function renderToolZoom(e,t){var o=t._e,r=t.$xegrid,t=t.zoomOpts;return r?e("vxe-button",{props:{circle:!0,title:_conf.default.i18n("vxe.toolbar.zoom".concat(r.isMaximized()?"Out":"In")),icon:r.isMaximized()?t.iconOut||_conf.default.icon.TOOLBAR_TOOLS_MINIMIZE:t.iconIn||_conf.default.icon.TOOLBAR_TOOLS_FULLSCREEN},on:{click:r.triggerZoomEvent}}):o()}function renderToolCustom(e,t){var o=t.customOpts,r={};return"manual"!==o.trigger&&("hover"===o.trigger?(r.mouseenter=t.handleMouseenterSettingEvent,r.mouseleave=t.handleMouseleaveSettingEvent):r.click=t.handleClickSettingEvent),e("vxe-button",{props:{circle:!0,title:_conf.default.i18n("vxe.toolbar.custom"),icon:o.icon||_conf.default.icon.TOOLBAR_TOOLS_CUSTOM},on:r})}var _default2=exports.default={name:"VxeToolbar",mixins:[_size.default],props:{loading:Boolean,refresh:[Boolean,Object],import:[Boolean,Object],export:[Boolean,Object],print:[Boolean,Object],zoom:[Boolean,Object],custom:[Boolean,Object],buttons:{type:Array,default:function(){return _conf.default.toolbar.buttons}},tools:{type:Array,default:function(){return _conf.default.toolbar.tools}},perfect:{type:Boolean,default:function(){return _conf.default.toolbar.perfect}},size:{type:String,default:function(){return _conf.default.toolbar.size||_conf.default.size}},className:[String,Function]},inject:{$xegrid:{default:null}},data:function(){return{$xetable:null,isRefresh:!1,columns:[],customStore:{isAll:!1,isIndeterminate:!1,visible:!1}}},computed:{refreshOpts:function(){return Object.assign({},_conf.default.toolbar.refresh,this.refresh)},importOpts:function(){return Object.assign({},_conf.default.toolbar.import,this.import)},exportOpts:function(){return Object.assign({},_conf.default.toolbar.export,this.export)},printOpts:function(){return Object.assign({},_conf.default.toolbar.print,this.print)},zoomOpts:function(){return Object.assign({},_conf.default.toolbar.zoom,this.zoom)},customOpts:function(){return Object.assign({},_conf.default.toolbar.custom,this.custom)}},created:function(){var o=this,r=this.refresh,n=this.refreshOpts,i=this.customOpts;this.$nextTick(function(){var e=o.fintTable(),t=n.queryMethod||n.query;!r||o.$xegrid||t||(0,_log.warnLog)("vxe.error.notFunc",["queryMethod"]),e&&e.connect(o),"development"===process.env.NODE_ENV&&(i.isFooter&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.isFooter","table.custom-config.showFooter"]),i.showFooter&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.showFooter","table.custom-config.showFooter"]),i.immediate&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.immediate","table.custom-config.immediate"]),i.trigger&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.trigger","table.custom-config.trigger"]),o.buttons)&&o.buttons.forEach(function(e){e=e.buttonRender,e=e?_vXETable.default.renderer.get(e.name):null;e&&e.renderButton&&(0,_log.warnLog)("vxe.error.delFunc",["renderButton","renderToolbarButton"])})})},render:function(e){var t=this._e,o=this.$xegrid,r=this.perfect,n=this.loading,i=this.refresh,l=this.zoom,s=this.custom,a=this.vSize,c=this.className;return e("div",{class:["vxe-toolbar",c?_xeUtils.default.isFunction(c)?c({$toolbar:this}):c:"",_defineProperty(_defineProperty(_defineProperty({},"size--".concat(a),a),"is--perfect",r),"is--loading",n)]},[e("div",{class:"vxe-buttons--wrapper"},renderBtns(e,this)),e("div",{class:"vxe-tools--wrapper"},renderRightTools(e,this)),e("div",{class:"vxe-tools--operate"},[this.import?renderToolImport(e,this):t(),this.export?renderToolExport(e,this):t(),this.print?renderToolPrint(e,this):t(),i?renderToolRefresh(e,this):t(),l&&o?renderToolZoom(e,this):t(),s?renderToolCustom(e,this):t()])])},methods:{syncUpdate:function(e){var t=e.collectColumn,e=e.$table;this.$xetable=e,this.columns=t},fintTable:function(){var e=this.$parent.$children,o=e.indexOf(this);return _xeUtils.default.find(e,function(e,t){return e&&e.loadData&&o<t&&"vxe-table"===e.$vnode.componentOptions.tag})},checkTable:function(){if(this.$xetable)return!0;(0,_log.errLog)("vxe.error.barUnableLink")},handleClickSettingEvent:function(e){var e=e.$event,t=this.$xetable;t?t.triggerCustomEvent(e):(0,_log.errLog)("vxe.error.reqModule",["VxeTableCustomModule"])},handleMouseenterSettingEvent:function(e){var e=e.$event,t=this.$xetable;t?t.customOpenEvent(e):(0,_log.errLog)("vxe.error.reqModule",["VxeTableCustomModule"])},handleMouseleaveSettingEvent:function(e){var t=e.$event,o=this.$xetable,r=this.customStore;r.activeBtn=!1,setTimeout(function(){r.activeBtn||r.activeWrapper||o.customColseEvent(t)},350)},refreshEvent:function(e){var t=this,o=this.$xegrid,r=this.refreshOpts;if(!this.isRefresh){var n=r.queryMethod||r.query;if(n){this.isRefresh=!0;try{Promise.resolve(n({})).catch(function(e){return e}).then(function(){t.isRefresh=!1})}catch(e){this.isRefresh=!1}}else o&&(this.isRefresh=!0,o.triggerToolbarCommitEvent({code:r.code||"reload"},e).catch(function(e){return e}).then(function(){t.isRefresh=!1}))}},btnEvent:function(e,t){var o=this.$xegrid,r=this.$xetable,n=t.code;n&&(o?o.triggerToolbarBtnEvent(t,e):(t={code:n,button:t,$table:r,$grid:o,$event:e},(r=_vXETable.default.commands.get(n))&&(r.commandMethod?r.commandMethod(t):"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notCommands",[n])),this.$emit("button-click",t)))},tolEvent:function(e,t){var o=this.$xegrid,r=this.$xetable,n=t.code;n&&(o?o.triggerToolbarTolEvent(t,e):(t={code:n,tool:t,$xegrid:o,$table:r,$event:e},(o=_vXETable.default.commands.get(n))&&(o.commandMethod?o.commandMethod(t):"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notCommands",[n])),this.$emit("tool-click",t)))},importEvent:function(){this.checkTable()&&this.$xetable.openImport(this.importOpts)},exportEvent:function(){this.checkTable()&&this.$xetable.openExport(this.exportOpts)},printEvent:function(){this.checkTable()&&this.$xetable.openPrint(this.printOpts)}}};