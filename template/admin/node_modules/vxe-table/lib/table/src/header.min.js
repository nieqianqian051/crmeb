"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_utils=_interopRequireDefault(require("../../tools/utils")),_dom=_interopRequireDefault(require("../../tools/dom")),_util=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var cellType="header",_default=exports.default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,tableGroupColumn:Array,fixedColumn:Array,size:String,fixedType:String},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,t=this.$el,r=this.$refs,o=this.fixedType,e=e.elemStore,o="".concat(o||"main","-header-");e["".concat(o,"wrapper")]=t,e["".concat(o,"table")]=r.table,e["".concat(o,"colgroup")]=r.colgroup,e["".concat(o,"list")]=r.thead,e["".concat(o,"xSpace")]=r.xSpace,e["".concat(o,"repair")]=r.repair},destroyed:function(){var e=this.$parent,t=this.fixedType,e=e.elemStore,t="".concat(t||"main","-header-");e["".concat(t,"wrapper")]=null,e["".concat(t,"table")]=null,e["".concat(t,"colgroup")]=null,e["".concat(t,"list")]=null,e["".concat(t,"xSpace")]=null,e["".concat(t,"repair")]=null},render:function(g){var _=this,e=this._e,x=this.$parent,v=this.fixedType,t=this.headerColumn,r=this.tableColumn,o=this.fixedColumn,C=x.$listeners,l=x.tId,n=x.isGroup,i=x.visibleColumn,w=x.resizable,P=x.border,S=x.columnKey,a=x.headerRowClassName,O=x.headerCellClassName,c=x.headerRowStyle,$=x.headerCellStyle,j=x.showHeaderOverflow,z=x.headerAlign,T=x.align,D=x.highlightCurrentColumn,M=x.currentColumn,W=x.scrollXLoad,k=x.overflowX,s=x.scrollbarWidth,R=x.sortOpts,E=x.mouseConfig,H=x.columnOpts;return n?r=i:t=[r=v&&(W||j)?o:r],g("div",{class:["vxe-table--header-wrapper",v?"fixed-".concat(v,"--wrapper"):"body--wrapper"],attrs:{xid:l}},[v?e():g("div",{class:"vxe-body--x-space",ref:"xSpace"}),g("table",{class:"vxe-table--header",attrs:{xid:l,cellspacing:0,cellpadding:0,border:0},ref:"table"},[g("colgroup",{ref:"colgroup"},r.map(function(e,t){return g("col",{attrs:{name:e.id},key:t})}).concat(s?[g("col",{attrs:{name:"col_gutter"}})]:[])),g("thead",{ref:"thead"},t.map(function(y,b){return g("tr",{class:["vxe-header--row",a?_xeUtils.default.isFunction(a)?a({$table:x,$rowIndex:b,fixed:v,type:cellType}):a:""],style:c?_xeUtils.default.isFunction(c)?c({$table:x,$rowIndex:b,fixed:v,type:cellType}):c:null},y.map(function(e,t){var r=e.type,o=e.showHeaderOverflow,l=e.headerAlign,n=e.align,i=e.headerClassName,a=e.children&&e.children.length,c=v?e.fixed!==v&&!a:e.fixed&&k,o=_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?j:o,l=l||n||z||T,n="ellipsis"===o,s="title"===o,o=!0===o||"tooltip"===o,u=s||o||n,d={},f=e.filters&&e.filters.some(function(e){return e.checked}),p=x.getColumnIndex(e),m=x.getVTColumnIndex(e),h={$table:x,$grid:x.xegrid,$rowIndex:b,column:e,columnIndex:p,$columnIndex:t,_columnIndex:m,fixed:v,type:cellType,isHidden:c,hasFilter:f};return W&&!u&&(n=u=!0),(H.isCurrent||D||C["header-cell-click"]||"cell"===R.trigger)&&(d.click=function(e){return x.triggerHeaderCellClickEvent(e,h)}),C["header-cell-dblclick"]&&(d.dblclick=function(e){return x.triggerHeaderCellDblclickEvent(e,h)}),E&&(d.mousedown=function(e){return x.triggerHeaderCellMousedownEvent(e,h)}),g("th",{class:["vxe-header--column",e.id,(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(p={},"col--".concat(l),l),"col--".concat(r),r),"col--last",t===y.length-1),"col--fixed",e.fixed),"col--group",a),"col--ellipsis",u),"fixed--hidden",c),"is--sortable",e.sortable),"col--filter",!!e.filters),"is--filter-active",f),_defineProperty(p,"col--current",M===e)),_utils.default.getClass(i,h),_utils.default.getClass(O,h)],attrs:{colid:e.id,colspan:1<e.colSpan?e.colSpan:null,rowspan:1<e.rowSpan?e.rowSpan:null},style:$?_xeUtils.default.isFunction($)?$(h):$:null,on:d,key:S||H.useKey||a?e.id:t},[g("div",{class:["vxe-cell",{"c--title":s,"c--tooltip":o,"c--ellipsis":n}]},e.renderHeader(g,h)),c||a||!(_xeUtils.default.isBoolean(e.resizable)?e.resizable:H.resizable||w)?null:g("div",{class:["vxe-resizable",{"is--line":!P||"none"===P}],on:{mousedown:function(e){return _.resizeMousedown(e,h)}}})])}).concat(s?[g("th",{class:"vxe-header--gutter col--gutter"})]:[]))}))]),g("div",{class:"vxe-table--header-border-line",ref:"repair"})])},methods:{uploadColumn:function(){var e=this.$parent;this.headerColumn=e.isGroup?(0,_util.convertHeaderColumnToRows)(this.tableGroupColumn):[]},resizeMousedown:function(e,r){var o=r.column,l=this.$parent,t=this.$el,n=this.fixedType,i=l.$refs,a=i.tableBody,c=i.leftContainer,s=i.rightContainer,u=i.resizeBar,i=e.target,d=e.clientX,f=r.cell=i.parentNode,p=0,m=a.$el,a=_dom.default.getOffsetPos(i,t),t=i.clientWidth,i=Math.floor(t/2),h=(0,_util.getColReMinWidth)(r)-i,y=a.left-f.clientWidth+t+h,b=a.left+i,g=document.onmousemove,_=document.onmouseup,x="left"===n,v="right"===n,C=0;if(x||v){for(var w=x?"nextElementSibling":"previousElementSibling",P=f[w];P&&!_dom.default.hasClass(P,"fixed--hidden");)_dom.default.hasClass(P,"col--group")||(C+=P.offsetWidth),P=P[w];v&&s&&(b=s.offsetLeft+C)}function S(e){e.stopPropagation(),e.preventDefault();var e=e.clientX-d,e=b+e,t=n?0:m.scrollLeft;x?e=Math.min(e,(s?s.offsetLeft:m.clientWidth)-C-h):v?(y=(c?c.clientWidth:0)+C+h,e=Math.min(e,b+f.clientWidth-h)):y=Math.max(m.scrollLeft,y),p=Math.max(e,y),u.style.left="".concat(p-t,"px")}l._isResize=!0,_dom.default.addClass(l.$el,"drag--resize"),u.style.display="block",document.onmousemove=S,document.onmouseup=function(e){document.onmousemove=g,document.onmouseup=_;var t=o.renderWidth+(v?b-p:p-b);o.resizeWidth=t,u.style.display="none",l._isResize=!1,l._lastResizeTime=Date.now(),l.analyColumnWidth(),l.recalculate(!0).then(function(){l.saveCustomStore("update:visible"),l.updateCellAreas(),l.emitEvent("resizable-change",_objectSpread(_objectSpread({},r),{},{resizeWidth:t}),e),setTimeout(function(){return l.recalculate(!0)},300)}),_dom.default.removeClass(l.$el,"drag--resize")},S(e),l.closeMenu()}}};