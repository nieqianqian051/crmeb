(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-63e41061"],{"192c":function(e,t,a){a.d(t,"h",(function(){return i})),a.d(t,"c",(function(){return n})),a.d(t,"f",(function(){return o})),a.d(t,"e",(function(){return s})),a.d(t,"i",(function(){return c})),a.d(t,"a",(function(){return l})),a.d(t,"d",(function(){return d})),a.d(t,"g",(function(){return u})),a.d(t,"b",(function(){return p}));var r=a("6b6c");function i(e){return Object(r.a)({url:"/recipe/recipe",method:"get",params:e})}function n(e){return Object(r.a)({url:"/recipe/recipe/".concat(e),method:"get"})}function o(e){return Object(r.a)({url:"/recipe/recipe/findAllLabelsBySource",method:"post",data:e})}function s(e){return Object(r.a)({url:"/recipe/recipe/findAllFoodTypes",method:"post",params:e})}function c(e){return Object(r.a)({url:"/recipe/recipe/uploadRecipeImages",method:"post",file:!0,data:e})}function l(e){return Object(r.a)({url:"/recipe/recipe/add",method:"post",data:e})}function d(e){return Object(r.a)({url:"/recipe/recipe/edit",method:"post",data:e})}function u(e){return Object(r.a)({url:"/recipe/recipe/remove",method:"post",params:e})}function p(e){return Object(r.a)({url:"/recipe/recipe/cancelRecommend",method:"post",params:e})}},2545:function(e,t,a){a.r(t),a("14d9"),a("a434"),a("b0c0");var r=a("2909"),i=a("c7eb"),n=a("1da1"),o=(a("99af"),a("4de4"),a("c740"),a("caad"),a("a15b"),a("d81d"),a("4e82"),a("e9c4"),a("d3b7"),a("2532"),a("159b"),a("a069")),s=a("192c"),c=a("ed08");o={name:"recipeAdd",components:{WangEditor:o.a},data:function(){return{spinShow:!1,foodTypes:[],foodAreaLabels:[],rateColors:["#F7DB4D","#F7DB4D"],rateColorss:["#F7DB4D","#F7DB4D","#F7DB4D"],threeMeals:["早餐","午餐","晚餐"],options:[{value:1,label:"不辣"},{value:2,label:"辣"}],options1:[{value:1,label:"易"},{value:2,label:"难"}],recipe:{difficultyLevel:0,name:"",alias:"",mainImageId:"",mainFoodId:"",mainFoodConsumption:"",foodId:"",labels:[],foodConsumption:"",detailsText:"",note:"",maijiStageLabelIds:[],areaLabelIds:[],recipeLabelIds:[],spicy:0,economy:0,threeMeal:[],gear:0},aliases:[""],mainFoods:[{foodId:"",foodName:"",consumption:"",main:!0,cascaderStr:"",cascader:[]}],foods:[{foodId:"",foodName:"",consumption:"",main:!1,cascaderStr:"",cascader:[]}],allMaijiStageLabels:[],foodLabels:[],recipeMainImage:null,content:"",rules:{name:[{required:!0,message:"食谱名称不能为空",trigger:"blur"}],mainImageId:[{required:!0,message:"食谱主图不能为空",trigger:"change"}],mainFoodId:[{required:!0,message:"请选择主料食材",trigger:"change"}],spicy:[{required:!0,message:"请选择辣度",trigger:"change"}],difficultyLevel:[{required:!0,message:"请选择难易程度",trigger:"change"}],gear:[{required:!0,message:"请选择搭配情况",trigger:"change"}],threeMeal:[{type:"array",required:!0,message:"请至少选择一个三餐归属",trigger:"change"}],maijiStageLabelIds:[{type:"array",required:!0,message:"请至少选择一个食谱麦吉阶段",trigger:"change"}],detailsText:[{required:!0,message:"食谱详情不能为空",trigger:"blur"}]}}},created:function(){var e=this;Object(s.f)({source:"食谱"}).then(function(){var t=Object(n.a)(Object(i.a)().mark((function t(a){return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:200===a.code&&(e.foodAreaLabels=a.data.filter((function(e){return 2==e.listShow})).sort((function(e,t){return e.name.length-t.name.length})),e.allMaijiStageLabels=a.data.filter((function(e){return 1==e.listShow})).sort((function(e,t){return e.orderNo-t.orderNo})),e.foodLabels=a.data.filter((function(e){return 0==e.listShow})).sort((function(e,t){return e.orderNo-t.orderNo})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){e.$message({type:"error",message:t,duration:1e3})})),Object(s.e)({isFindFoods:!0}).then(function(){var t=Object(n.a)(Object(i.a)().mark((function t(a){return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:200===a.code&&(e.foodTypes=a.data.map((function(e){return e.children&&1<e.children.length&&e.children.sort((function(e,t){return e.label.length-t.label.length})),e})).sort((function(e,t){return e.label.length-t.label.length})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){e.$message({type:"error",message:t,duration:1e3})}))},mounted:function(){this.draChange(),this.$refs.recipeFrom.resetFields()},methods:{draChange:function(){this.recipe={name:"",alias:"",mainImageId:"",mainFoodId:"",mainFoodConsumption:"",foodId:"",labels:[],foodConsumption:"",detailsText:"",note:"",maijiStageLabelIds:[],areaLabelIds:[],recipeLabelIds:[],spicy:0,economy:0,threeMeal:[],difficultyLevel:0,gear:0},this.aliases=[""],this.recipeMainImage=null,this.mainFoods=[{foodId:"",foodName:"",consumption:"",main:!0,cascaderStr:"",cascader:[]}],this.foods=[{foodId:"",foodName:"",consumption:"",main:!1,cascaderStr:"",cascader:[]}],this.content=""},getEditorContent:function(e){this.content=e},querySearch:function(e,t){var a=[{value:"若干"},{value:"适量"},{value:"少许"},{value:"或输入具体数值(克)"}];t(e?a.filter((function(t){return t.value.includes(e)})):a)},addRecipeImage:function(e){var t=this;return Object(n.a)(Object(i.a)().mark((function a(){var r;return Object(i.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(r=new FormData).append("uploadFiles",e.file),a.next=4,Object(s.i)(r);case 4:200!=(r=a.sent).code&&t.$message.error("上传食谱主图失败，请稍后重试！"),t.recipeMainImage=Object.assign(r.data[0],{isMain:1}),t.recipe.mainImageId=t.recipeMainImage.uuId;case 8:case"end":return a.stop()}}),a)})))()},ElCascaderChange:function(e,t,a){a?(this.mainFoods[t].foodId=e[2],this.mainFoods[t].cascaderStr=e.join(","),this.recipe.mainFoodId=e[2]):(this.foods[t].foodId=e[2],this.foods[t].cascaderStr=e.join(","),this.recipe.foodId=e[2])},handleFilterMethod:function(e,t){return-1!==e.label.indexOf(t)},handleFilterMethod1:function(e,t){return-1!==e.label.indexOf(t)},handleSubmit:function(e){var t=this;this.recipe.detailsText=this.content,this.$refs.recipeFrom.validate(function(){var e=Object(n.a)(Object(i.a)().mark((function e(a){var o;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(t.recipe.maijiStageLabelIds&&0<t.recipe.maijiStageLabelIds.length&&t.recipe.maijiStageLabelIds.forEach((function(e){t.recipe.labels.push({labelId:e})})),t.recipe.areaLabelIds&&0<t.recipe.areaLabelIds.length&&t.recipe.areaLabelIds.forEach((function(e){t.recipe.labels.push({labelId:e})})),t.recipe.recipeLabelIds&&0<t.recipe.recipeLabelIds.length&&t.recipe.recipeLabelIds.forEach((function(e){t.recipe.labels.push({labelId:e})})),null!=t.aliases&&(t.recipe.alias=t.aliases.join("、")),t.recipe.foods=[].concat(Object(r.a)(t.mainFoods),Object(r.a)(t.foods)),o=t.recipe.foods.findIndex((function(e){return""===e.foodId})),t.recipe.foods.splice(o,1),t.recipe.detailsText=Object(c.a)(t.recipe.detailsText),t.recipe.threeMeal=JSON.stringify(t.recipe.threeMeal),Object(s.a)(t.recipe).then(function(){var e=Object(n.a)(Object(i.a)().mark((function e(a){return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:200==a.code?setTimeout((function(){t.spinShow=!1,t.$router.push({path:t.$routeProStr+"/recipe/list"})}),500):(setTimeout((function(e){t.spinShow=!1}),1e3),t.$message.error(a.msg));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){setTimeout((function(e){t.spinShow=!1}),1e3),t.$message.error("保存失败")})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}},a("5fe8"),a=a("2877"),a=Object(a.a)(o,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.spinShow,expression:"spinShow"}],staticStyle:{width:"100%",padding:"25px"}},[t("pages-header",{ref:"pageHeader",attrs:{title:e.$route.params.recipeId?"编辑食谱":"添加食谱",backUrl:e.$routeProStr+"/recipe/list"}}),t("el-card",{staticClass:"mt16",attrs:{bordered:!1,shadow:"never","body-style":{padding:"0 20px 20px"}}},[t("el-form",{ref:"recipeFrom",staticStyle:{padding:"20px"},attrs:{rules:e.rules,model:e.recipe,"label-width":"100px","label-position":"right"}},[t("el-form-item",{attrs:{label:"食谱名称",prop:"name"}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入食谱名称"},model:{value:e.recipe.name,callback:function(t){e.$set(e.recipe,"name",t)},expression:"recipe.name"}})],1),e._l(e.aliases,(function(a,r){return t("el-form-item",{attrs:{label:"食谱别名"}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入食谱别名"},model:{value:e.aliases[r],callback:function(t){e.$set(e.aliases,r,t)},expression:"aliases[index]"}},[t("template",{slot:"append"},[t("el-tooltip",{attrs:{content:"增加别名",placement:"top",effect:"light"}},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.aliases.push("")}}},[t("i",{staticClass:"el-icon-plus"})])],1),t("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:1<e.aliases.length,expression:"aliases.length > 1"}],attrs:{content:"减少别名",placement:"top",effect:"light"}},[t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.aliases.splice(r,1)}}},[t("i",{staticClass:"el-icon-minus"})])],1)],1)],2)],1)})),t("el-form-item",{attrs:{label:"食谱主图",prop:"mainImageId"}},[t("span",{staticStyle:{color:"gray"}},[e._v("建议图片尺寸：345 * 345")]),t("el-upload",{attrs:{size:"mini",action:"","list-type":"picture-card",limit:1,accept:"jpg","http-request":e.addRecipeImage,"file-list":e.recipeMainImage?[e.recipeMainImage]:[],"on-exceed":function(){return e.$message.warning("只能上传1张食谱主图")}}},[t("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("点击上传")])],1)],1),e._l(e.mainFoods,(function(a,r){return t("div",[t("el-form-item",{attrs:{label:"食谱主料",size:"mini",prop:"mainFoodId",required:""}},[t("el-cascader",{ref:"myMainElCascader",refInFor:!0,staticStyle:{width:"80%"},attrs:{options:e.foodTypes,placeholder:"试试搜索: 请选择食谱主料",filterable:!0,"filter-method":e.handleFilterMethod},on:{change:function(t){return e.ElCascaderChange(t,r,!0)}},model:{value:a.cascader,callback:function(t){e.$set(a,"cascader",t)},expression:"food.cascader"}}),t("el-tooltip",{attrs:{content:"增加主料",placement:"top",effect:"light"}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.mainFoods.push({foodId:"",consumption:"",main:!0,cascader:[]})}}},[t("i",{staticClass:"el-icon-plus"})])],1),t("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:1<e.mainFoods.length,expression:"mainFoods.length > 1"}],attrs:{content:"减少主料",placement:"top",effect:"light"}},[t("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.mainFoods.splice(r,1)}}},[t("i",{staticClass:"el-icon-minus"})])],1)],1),t("el-form-item",{attrs:{label:"主料用量",size:"mini"}},[t("el-autocomplete",{staticStyle:{width:"80%"},attrs:{"fetch-suggestions":e.querySearch,placeholder:"请输入主料用量"},model:{value:e.mainFoods[r].consumption,callback:function(t){e.$set(e.mainFoods[r],"consumption",t)},expression:"mainFoods[index].consumption"}})],1)],1)})),e._l(e.foods,(function(a,r){return t("div",[t("el-form-item",{attrs:{label:"食谱配料"}},[t("el-cascader",{ref:"myElCascader",refInFor:!0,staticStyle:{width:"80%"},attrs:{size:"mini",options:e.foodTypes,placeholder:"试试搜索: 请选择食谱配料",filterable:!0,"filter-method":e.handleFilterMethod1},on:{change:function(t){return e.ElCascaderChange(t,r,!1)}},model:{value:a.cascader,callback:function(t){e.$set(a,"cascader",t)},expression:"food.cascader"}}),t("el-tooltip",{attrs:{size:"mini",content:"增加配料",placement:"top",effect:"light"}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.foods.push({foodId:"",consumption:"",main:!1,cascader:[]})}}},[t("i",{staticClass:"el-icon-plus"})])],1),t("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:1<e.foods.length,expression:"foods.length > 1"}],attrs:{size:"mini",content:"减少配料",placement:"top",effect:"light"}},[t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.foods.splice(r,1)}}},[t("i",{staticClass:"el-icon-minus"})])],1)],1),t("el-form-item",{attrs:{label:"配料用量"}},[t("el-autocomplete",{staticStyle:{width:"80%"},attrs:{size:"mini","fetch-suggestions":e.querySearch,placeholder:"请输入配料用量"},model:{value:e.foods[r].consumption,callback:function(t){e.$set(e.foods[r],"consumption",t)},expression:"foods[index].consumption"}})],1)],1)})),t("el-form-item",{attrs:{label:"食谱地区"}},[t("el-select",{staticStyle:{width:"80%"},attrs:{multiple:"",placeholder:"全国范围",size:"mini"},model:{value:e.recipe.areaLabelIds,callback:function(t){e.$set(e.recipe,"areaLabelIds",t)},expression:"recipe.areaLabelIds"}},e._l(e.foodAreaLabels,(function(e,a){return t("el-option",{key:a,attrs:{label:e.name,value:e.uuId}})})),1)],1),t("el-form-item",{attrs:{label:"辣度",prop:"spicy"}},[t("el-radio-group",{model:{value:e.recipe.spicy,callback:function(t){e.$set(e.recipe,"spicy",t)},expression:"recipe.spicy"}},e._l(e.options,(function(a){return t("el-radio",{key:a.value,attrs:{value:a.value,label:a.value}},[e._v(e._s(a.label))])})),1)],1),t("el-form-item",{attrs:{label:"难易程度",prop:"difficultyLevel"}},[t("el-radio-group",{model:{value:e.recipe.difficultyLevel,callback:function(t){e.$set(e.recipe,"difficultyLevel",t)},expression:"recipe.difficultyLevel"}},e._l(e.options1,(function(a){return t("el-radio",{key:a.value,attrs:{value:a.value,label:a.value}},[e._v(e._s(a.label))])})),1)],1),t("el-form-item",{attrs:{label:"搭配情况",prop:"gear"}},[t("el-rate",{attrs:{texts:["纯素","纯荤","荤素搭配"],"show-text":"",max:3,"text-color":"#666666",colors:e.rateColorss},model:{value:e.recipe.gear,callback:function(t){e.$set(e.recipe,"gear",t)},expression:"recipe.gear"}})],1),t("el-form-item",{attrs:{label:"三餐归属",prop:"threeMeal"}},[t("el-checkbox-group",{staticStyle:{width:"350px"},attrs:{size:"mini"},model:{value:e.recipe.threeMeal,callback:function(t){e.$set(e.recipe,"threeMeal",t)},expression:"recipe.threeMeal"}},e._l(e.threeMeals,(function(a,r){return t("el-checkbox",{key:r,attrs:{label:a}},[e._v(e._s(a))])})),1)],1),t("el-form-item",{attrs:{label:"麦吉阶段",prop:"maijiStageLabelIds"}},[t("el-checkbox-group",{staticStyle:{width:"350px"},attrs:{size:"mini"},model:{value:e.recipe.maijiStageLabelIds,callback:function(t){e.$set(e.recipe,"maijiStageLabelIds",t)},expression:"recipe.maijiStageLabelIds"}},e._l(e.allMaijiStageLabels,(function(a,r){return t("el-checkbox",{attrs:{label:a.uuId}},[e._v(e._s(a.name))])})),1)],1),t("el-form-item",{attrs:{label:"食谱标签"}},[t("el-checkbox-group",{staticStyle:{width:"350px"},attrs:{size:"mini"},model:{value:e.recipe.recipeLabelIds,callback:function(t){e.$set(e.recipe,"recipeLabelIds",t)},expression:"recipe.recipeLabelIds"}},[e._l(e.foodLabels,(function(a,r){return t("el-checkbox",{key:r,attrs:{label:a.uuId}},[e._v(e._s(a.name))])})),t("el-button",{staticStyle:{"margin-left":"20px"},attrs:{icon:"el-icon-plus",circle:"",size:"mini"},on:{click:function(t){return e.addLabelShow(!0)}}})],2)],1),t("el-form-item",{attrs:{label:"注意事项"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入食谱的注意事项"},model:{value:e.recipe.note,callback:function(t){e.$set(e.recipe,"note",t)},expression:"recipe.note"}})],1),t("el-form-item",{attrs:{label:"食谱详情",prop:"detailsText","label-position":"top"}},[t("WangEditor",{staticStyle:{width:"100%"},attrs:{content:e.recipe.detailsText},on:{editorContent:e.getEditorContent}})],1),t("el-form-item",[t("el-button",{staticClass:"submission",attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("recipeFrom")}}},[e._v("保存")])],1)],2)],1)],1)}),[],!1,null,"3d1d7804",null);t.default=a.exports},"4e82":function(e,t,a){var r=a("23e7"),i=a("e330"),n=a("59ed"),o=a("7b0b"),s=a("07fa"),c=a("083a"),l=a("577e"),d=a("d039"),u=a("addb"),p=a("a640"),f=a("04d1"),m=a("d998"),h=a("2d00"),b=a("512ce"),g=[],v=i(g.sort),y=i(g.push),I=(a=d((function(){g.sort(void 0)})),i=d((function(){g.sort(null)})),p=p("sort"),!d((function(){if(h)return h<70;if(!(f&&3<f)){if(m)return!0;if(b)return b<603;for(var e,t,a,r="",i=65;i<76;i++){switch(e=String.fromCharCode(i),i){case 66:case 69:case 70:case 72:t=3;break;case 68:case 71:t=4;break;default:t=2}for(a=0;a<47;a++)g.push({k:e+a,v:t})}for(g.sort((function(e,t){return t.v-e.v})),a=0;a<g.length;a++)e=g[a].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return"DGBEFHACIJK"!==r}})));r({target:"Array",proto:!0,forced:a||!i||!p||!I},{sort:function(e){void 0!==e&&n(e);var t=o(this);if(I)return void 0===e?v(t):v(t,e);for(var a,r,i=[],d=s(t),p=0;p<d;p++)p in t&&y(i,t[p]);for(u(i,(r=e,function(e,t){return void 0===t?-1:void 0===e?1:void 0!==r?+r(e,t)||0:l(e)>l(t)?1:-1})),a=s(i),p=0;p<a;)t[p]=i[p++];for(;p<d;)c(t,p++);return t}})},"5d14":function(e,t,a){},"5fe8":function(e,t,a){a("5d14")}}]);