(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7790592a"],{"4b73":function(t,e,a){},"4d2a":function(t,e,a){a("4b73")},f164:function(t,e,a){a.r(e);var i=a("c7eb"),r=a("1da1"),n=a("5530"),s=(a("d9e2"),a("4de4"),a("d81d"),a("14d9"),a("b0c0"),a("d3b7"),a("2f62")),l=a("b0e7"),o=a("a069"),c=a("1336");l={name:"addArticle",components:{uploadPictures:l.a,WangEditor:o.a},data:function(){var t=this;return{dialog:{},isChoice:"单选",grid:{xl:8,lg:8,md:12,sm:24,xs:24},gridPic:{xl:6,lg:8,md:12,sm:12,xs:12},gridBtn:{xl:4,lg:8,md:8,sm:8,xs:8},loading:!1,formValidate:{id:void 0,title:"",imageId:"",content:"",desc:"",labelIds:[]},maijiArticleImages:[],content:"",ruleValidate:{title:[{required:!0,message:"请输入标题",trigger:"blur"}],labelIds:[{required:!0,validator:function(e,a,i){0===t.formValidate.labelIds.length?i(new Error("请选择文章分类")):i()},trigger:"change",type:"number"}],imageId:[{required:!0,validator:function(e,a,i){t.formValidate.imageId?i():i(new Error("请上传图文封面"))},trigger:"change"}],content:[{required:!0,message:"请输入文章内容",trigger:"change"}]},value:"",modalPic:!1,template:!1,treeData:[],formValidate2:{type:1},myConfig:{autoHeightEnabled:!1,initialFrameHeight:500,initialFrameWidth:"100%",UEDITOR_HOME_URL:"/UEditor/",serverUrl:""}}},computed:Object(n.a)(Object(n.a)({},Object(s.e)("media",["isMobile"])),{},{labelWidth:function(){return this.isMobile?void 0:"100px"},labelPosition:function(){return this.isMobile?"top":"right"}}),watch:{$route:function(t,e){this.$route.params.id?this.getDetails():this.formValidate={id:void 0,title:"",imageId:"",img:"",content:"",desc:"",labelIds:[]}}},methods:{getEditorContent:function(t){this.content=t},modalPicTap:function(){this.modalPic=!0},getPic:function(t){this.formValidate.img=t.att_dir,this.modalPic=!1},getClass:function(){var t=this;Object(c.k)({source:"麦吉简介"}).then((function(e){t.treeData=e.data.filter((function(t){return 3==t.listShow})).map((function(t){var a={value:t.uuId,label:t.name};return a.children=e.data.filter((function(e){return e.orderNo==t.orderNo})).map((function(e){return"置顶推荐"==e.name?e.name+="（封面700*275）":e.name+="（封面378*278）",Object.assign({value:e.uuId,label:e.name==t.name?"普通文章（封面280*176）":e.name})})),a}))}))},onsubmit:function(t){var e=this;this.formValidate.content=this.content,this.$refs[t].validate((function(t){if(!t)return!1;Object(c.e)(e.formValidate).then(function(){var t=Object(r.a)(Object(i.a)().mark((function t(a){return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.$message.success(a.msg),setTimeout((function(){e.$router.push({path:e.$routeProStr+"/cms/article/index"})}),500);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){e.$message.error(t.msg)}))}))},addMaijiArticleImage:function(t){var e=this;return Object(r.a)(Object(i.a)().mark((function a(){var r;return Object(i.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(r=new FormData).append("uploadFiles",t.file),a.next=4,Object(c.n)(r);case 4:200!=(r=a.sent).code&&e.$message.error("上传文章封面失败，请稍后重试！"),e.maijiArticleImages=[Object.assign(r.data[0],{isMain:1})],e.formValidate.imageId=r.data[0].uuId;case 8:case"end":return a.stop()}}),a)})))()},getDetails:function(){var t=this;Object(c.g)(this.$route.params.id||void 0).then(function(){var e=Object(r.a)(Object(i.a)().mark((function e(a){var r;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=a.data,t.formValidate=r,t.formValidate.imageId=r.img.uuId,t.maijiArticleImages=[Object.assign(r.img,{isMain:1})];case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.loading=!1,t.$message.error(e.msg)}))}},mounted:function(){this.$route.params.id&&this.getDetails()},created:function(){this.getClass()}},a("4d2a"),o=a("2877"),n=Object(o.a)(l,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-manager"},[e("pages-header",{ref:"pageHeader",attrs:{title:t.$route.params.id?"编辑文章":"添加文章",backUrl:t.$routeProStr+"/cms/article/index"}}),e("el-card",{staticClass:"mt16",attrs:{bordered:!1,shadow:"never"}},[e("el-form",{ref:"formValidate",staticClass:"form",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-width":t.labelWidth,"label-position":t.labelPosition},nativeOn:{submit:function(t){t.preventDefault()}}},[e("div",{staticClass:"goodsTitle acea-row"},[e("div",{staticClass:"title"},[t._v("文章信息")])]),e("div",{staticClass:"grid_box"},[e("el-form-item",{attrs:{label:"标题：",prop:"title","label-for":"title"}},[e("el-input",{staticClass:"content_width",attrs:{placeholder:"请输入"},model:{value:t.formValidate.title,callback:function(e){t.$set(t.formValidate,"title",e)},expression:"formValidate.title"}})],1),e("el-form-item",{attrs:{label:"文章标签：","label-for":"labelIds",prop:"labelIds"}},[e("el-cascader",{staticClass:"content_width",attrs:{size:"small",options:t.treeData,placeholder:"请选择文章标签"},model:{value:t.formValidate.labelIds,callback:function(e){t.$set(t.formValidate,"labelIds",e)},expression:"formValidate.labelIds"}})],1),e("el-form-item",{attrs:{label:"文章描述：",prop:"desc","label-for":"desc"}},[e("el-input",{staticClass:"content_width",attrs:{type:"textarea",rows:8,placeholder:"请输入文章描述"},model:{value:t.formValidate.desc,callback:function(e){t.$set(t.formValidate,"desc",e)},expression:"formValidate.desc"}})],1),e("el-form-item",{attrs:{label:"文章封面",prop:"imageId"}},[e("div",{staticClass:"picBox"},[e("el-upload",{attrs:{action:"","list-type":"picture-card",limit:1,"http-request":t.addMaijiArticleImage,"file-list":t.maijiArticleImages,"on-exceed":function(){return t.$message.warning("只能上传1张文章封面")}}},[e("div",{staticClass:"upLoad acea-row row-center-wrapper"},[e("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"24px"}})])])],1),e("div",{staticClass:"tip"},[t._v("建议尺寸：230 x 160 ")])])],1),e("div",{staticClass:"goodsTitle acea-row"},[e("div",{staticClass:"title"},[t._v("文章内容")])]),e("el-form-item",{attrs:{label:"文章内容：",prop:"content"}},[e("WangEditor",{staticStyle:{width:"90%"},attrs:{content:t.formValidate.content},on:{editorContent:t.getEditorContent}})],1),e("el-button",{staticClass:"submission",attrs:{type:"primary"},on:{click:function(e){return t.onsubmit("formValidate")}}},[t._v("提交")])],1),e("el-dialog",{attrs:{visible:t.modalPic,width:"950px",title:"上传商品图","close-on-click-modal":!1},on:{"update:visible":function(e){t.modalPic=e}}},[t.modalPic?e("uploadPictures",{attrs:{isChoice:t.isChoice,gridBtn:t.gridBtn,gridPic:t.gridPic},on:{getPic:t.getPic}}):t._e()],1)],1)],1)}),[],!1,null,"139aad46",null);e.default=n.exports}}]);